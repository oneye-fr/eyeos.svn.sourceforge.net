var SlimeyNavigation=function(f){this.slimey=f;this.slimey.editor.addEventListener("actionPerformed",this.saveCurrentSlide,this);this.container=document.createElement("div");this.container.className="slimeyNavigation";this.container.style.position="absolute";this.container.style.left="0px";this.container.style.top="59px";this.container.style.width="195px";this.container.style.cssFloat="left";this.slides=new Array();this.doms=new Array();this.divSlides=new Array();this.divSpacers=new Array();var e=unescapeSLIM(this.slimey.slimContent);var b=e.split('<div class="slide">');this.slides[0]="";for(var d=1;d<b.length;d++){this.slides[d]=b[d].substr(0,b[d].lastIndexOf("</div>"))}var c=this.createSpacerDiv(1);this.container.appendChild(c);for(d=1;d<this.slides.length;d++){var a=this.createSlideDiv(d);this.container.appendChild(a);var c=this.createSpacerDiv(d+1);this.container.appendChild(c)}this.currentSlide=0;if(this.slides.length>1){this.getSlide(1)}};SlimeyNavigation.prototype.getContainer=function(){return this.container};SlimeyNavigation.prototype.getSlide=function(a){if(a==this.currentSlide){return}if(this.currentSlide!=0){var b=this.slimey.editor.getHTML();this.divSlides[this.currentSlide].className="slidePreview";this.divSlides[this.currentSlide].parentNode.className="slideBorder";this.slides[this.currentSlide]=b;this.doms[this.currentSlide]=document.createElement("div");this.slimey.editor.getDOM(this.doms[this.currentSlide]);this.divSlides[this.currentSlide].innerHTML=b}if(this.doms[a]){this.slimey.editor.setDOM(this.doms[a])}else{this.slimey.editor.setHTML(this.slides[a])}this.currentSlide=a;this.divSlides[this.currentSlide].className="slidePreviewSel";this.divSlides[this.currentSlide].parentNode.className="slideBorderSel";return false};SlimeyNavigation.prototype.saveCurrentSlide=function(){var a=this.slimey.editor.getHTML();this.slides[this.currentSlide]=a;var b=this.divSlides[this.currentSlide];if(b){b.innerHTML=a}};SlimeyNavigation.prototype.insertNewSlide=function(c,e,g){if(!e){e='<div style="font-size: 200%; font-weight: bold; font-family: sans-serif; position: absolute; left: 33%; top: 0%;">Edit Me!</div>'}var b=this.divSpacers[c];for(i=this.divSlides.length-1;i>=c;i--){this.divSlides[i+1]=this.divSlides[i];this.divSlides[i+1].title="Slide "+(i+1);this.divSlides[i+1].slideNumber=i+1}for(i=this.divSpacers.length-1;i>=c;i--){this.divSpacers[i+1]=this.divSpacers[i];this.divSpacers[i+1].spacerNumber=i+1}for(i=this.slides.length-1;i>=c;i--){this.slides[i+1]=this.slides[i];this.doms[i+1]=this.doms[i]}this.slides[c]=e;this.doms[c]=g;var f=b.parentNode;var d=this.createSpacerDiv(c);f.insertBefore(d,b);var a=this.createSlideDiv(c);f.insertBefore(a,b);if(this.currentSlide>=c){this.currentSlide++}this.getSlide(c)};SlimeyNavigation.prototype.deleteSlide=function(d){if(d<1||d>this.slides.length){alert("No slide to delete!");return}var b=this.divSpacers[d];var a=this.divSlides[d];a.parentNode.parentNode.removeChild(a.parentNode);var c=this.divSpacers[d];c.parentNode.removeChild(c);for(i=d;i<this.divSlides.length-1;i++){this.divSlides[i]=this.divSlides[i+1];this.divSlides[i].slideNumber=i;this.divSlides[i].title="Slide"+i}this.divSlides.length--;for(i=d;i<this.divSpacers.length-1;i++){this.divSpacers[i]=this.divSpacers[i+1];this.divSpacers[i].spacerNumber=i}this.divSpacers.length--;for(i=d;i<this.slides.length-1;i++){this.slides[i]=this.slides[i+1];this.doms[i]=this.doms[i+1]}this.slides.length--;this.doms.length--;this.currentSlide=0;if(d<this.slides.length&&d>0){this.getSlide(d)}else{if(this.slides.length>1){this.getSlide(this.slides.length-1)}else{this.slimey.editor.setHTML('<h1 align="center" style="color: #999999"><i>Click "Add New" to add a slide.</i><h1>')}}};SlimeyNavigation.prototype.moveSlide=function(c,g){if(c<1||c>this.slides.length||c==g){alert("No slide to move!");return}var h=(g>c?1:-1);var d=this.divSlides[c];var j=d.parentNode.parentNode;j.removeChild(d.parentNode);var e=this.divSpacers[c];j.removeChild(e);if(c<g){j.insertBefore(e,this.divSlides[g].parentNode.nextSibling)}else{j.insertBefore(e,this.divSlides[g].parentNode.previousSibling)}j.insertBefore(d.parentNode,e.nextSibling);var a=this.divSlides[c];for(i=c;i!=g;i+=h){this.divSlides[i]=this.divSlides[i+h];this.divSlides[i].slideNumber=i;this.divSlides[i].title="Slide"+i}this.divSlides[g]=a;a.slideNumber=g;a.title="Slide"+g;var a=this.divSpacers[c];for(i=c;i!=g;i+=h){this.divSpacers[i]=this.divSpacers[i+h];this.divSpacers[i].spacerNumber=i}this.divSpacers[g]=a;a.spacerNumber=g;var f=this.slides[c];var b=this.doms[c];for(i=c;i!=g;i+=h){this.slides[i]=this.slides[i+h];this.doms[i]=this.doms[i+h]}this.slides[g]=f;this.doms[g]=b;this.currentSlide=g};SlimeyNavigation.prototype.getSLIMContent=function(){var a=this.slimey.editor.getHTML();this.slides[this.currentSlide]=a;var b="";for(i=1;i<this.slides.length;i++){b+='<div class="slide">'+this.slides[i]+"</div>"}return b};SlimeyNavigation.prototype.createSlideDiv=function(c){var a=document.createElement("div");a.slideNumber=c;a.slimey=this.slimey;a.className="slidePreview";a.title="Slide "+c;a.style.position="relative";a.innerHTML=this.slides[c];setEventHandler(a,"click",function(){var d=this.slideNumber;var e=new SlimeyChangeSlideAction(this.slimey,d);this.slimey.editor.performAction(e)});setEventHandler(a,"mouseover",function(){this.className="slidePreviewH";this.parentNode.className="slideBorderH"});setEventHandler(a,"mouseout",function(){var d=this.slideNumber;var e=(d==this.slimey.navigation.currentSlide?"Sel":"");this.className="slidePreview"+e;this.parentNode.className="slideBorder"+e});var b=document.createElement("div");b.className="slideBorder";b.appendChild(a);this.divSlides[c]=a;return b};SlimeyNavigation.prototype.createSpacerDiv=function(b){var a=document.createElement("div");a.spacerNumber=b;a.slimey=this.slimey;a.className="previewSpacer";a.title="Click to insert a new slide";setEventHandler(a,"click",function(){var c=new SlimeyInsertSlideAction(this.slimey,this.spacerNumber);this.slimey.editor.performAction(c);this.className="previewSpacer"});setEventHandler(a,"mouseover",function(){this.className="previewSpacerH"});setEventHandler(a,"mouseout",function(){this.className="previewSpacer"});this.divSpacers[b]=a;return a};SlimeyNavigation.prototype.addNewSlide=function(){var a=new SlimeyInsertSlideAction(this.slimey,this.currentSlide+1);this.slimey.editor.performAction(a)};SlimeyNavigation.prototype.deleteCurrentSlide=function(){if(this.currentSlide>0){var a=new SlimeyDeleteSlideAction(this.slimey,this.currentSlide);this.slimey.editor.performAction(a)}};SlimeyNavigation.prototype.moveSlideDown=function(){if(this.currentSlide<this.slides.length-1){var a=new SlimeyMoveSlideAction(this.slimey,this.currentSlide,this.currentSlide+1);this.slimey.editor.performAction(a)}};SlimeyNavigation.prototype.moveSlideUp=function(){if(this.currentSlide>1){var a=new SlimeyMoveSlideAction(this.slimey,this.currentSlide,this.currentSlide-1);this.slimey.editor.performAction(a)}};