CodePress={scrolling:false,autocomplete:true,initialize:function(a){if(!(typeof editor=="undefined"&&!a)){chars="|32|46|62|";cc="\u2009";editor=document.getElementsByTagName("pre")[0];editor.contentEditable="true";document.getElementsByTagName("body")[0].onfocus=function(){editor.focus()};document.attachEvent("onkeydown",this.metaHandler);document.attachEvent("onkeypress",this.keyHandler);window.attachEvent("onscroll",function(){CodePress.scrolling||setTimeout(function(){CodePress.syntaxHighlight("scroll")},
1)});completeChars=this.getCompleteChars();completeEndingChars=this.getCompleteEndingChars();setTimeout(function(){window.scroll(0,0)},50)}},keyHandler:function(a){charCode=a.keyCode;fromChar=String.fromCharCode(charCode);if((completeEndingChars.indexOf("|"+fromChar+"|")!=-1||completeChars.indexOf("|"+fromChar+"|")!=-1)&&CodePress.autocomplete)CodePress.completeEnding(fromChar)||CodePress.complete(fromChar);else if(chars.indexOf("|"+charCode+"|")!=-1||charCode==13)CodePress.syntaxHighlight("generic")},
metaHandler:function(a){keyCode=a.keyCode;if(keyCode==9||a.tabKey)CodePress.snippets();else if((keyCode==122||keyCode==121||keyCode==90)&&a.ctrlKey){keyCode==121||a.shiftKey?CodePress.actions.redo():CodePress.actions.undo();a.returnValue=false}else if(keyCode==34||keyCode==33){self.scrollBy(0,keyCode==34?200:-200);a.returnValue=false}else if(keyCode==46||keyCode==8)CodePress.actions.history[CodePress.actions.next()]=editor.innerHTML;else if((a.ctrlKey||a.metaKey)&&a.shiftKey&&keyCode!=90){CodePress.shortcuts(keyCode);
a.returnValue=false}else if(keyCode==86&&a.ctrlKey){window.clipboardData.setData("Text",window.clipboardData.getData("Text").replace(/\t/g,"\u2008"));top.setTimeout(function(){CodePress.syntaxHighlight("paste")},10)}},findString:function(){range=self.document.body.createTextRange();if(range.findText(cc)){range.select();range.text=""}},split:function(a,b){if(b=="scroll"){this.scrolling=true;return a}else{this.scrolling=false;mid=a.indexOf(cc);if(mid-2E3<0){ini=0;end=4E3}else if(mid+2E3>a.length){ini=
a.length-4E3;end=a.length}else{ini=mid-2E3;end=mid+2E3}a=a.substring(ini,end);return a.substring(a.indexOf("<P>"),a.lastIndexOf("</P>")+4)}},syntaxHighlight:function(a,b,d){if(a!="init")document.selection.createRange().text=cc;o=editor.innerHTML;if(a=="paste"){o=o.replace(/<BR>/g,"\r\n");o=o.replace(/\u2008/g,"\t")}o=o.replace(/<P>/g,"\n");o=o.replace(/<\/P>/g,"\r");o=o.replace(/<.*?>/g,"");o=o.replace(/&nbsp;/g,"");o="<PRE><P>"+o+"</P></PRE>";o=o.replace(/\n\r/g,"<P></P>");o=o.replace(/\n/g,"<P>");
o=o.replace(/\r/g,"</P>");o=o.replace(/<P>(<P>)+/,"<P>");o=o.replace(/<\/P>(<\/P>)+/,"</P>");o=o.replace(/<P><\/P>/g,"<P><BR/></P>");x=z=this.split(o,a);if(b&&d)x=x.replace(b,d);for(i=0;i<Language.syntax.length;i++)x=x.replace(Language.syntax[i].input,Language.syntax[i].output);editor.innerHTML=this.actions.history[this.actions.next()]=a=="scroll"?x:o.replace(z,x);a!="init"&&this.findString()},snippets:function(){for(var a=Language.snippets,b=this.getLastWord(),d=0;d<a.length;d++)if(a[d].input==b){var c=
a[d].output.replace(/</g,"&lt;");c=c.replace(/>/g,"&gt;");if(c.indexOf("$0")<0)c+=cc;else c=c.replace(/\$0/,cc);c=c.replace(/\n/g,"</P><P>");this.syntaxHighlight("snippets",new RegExp(b+cc,"gi"),c)}},readOnly:function(a){editor.contentEditable=a?"false":"true"},complete:function(a){for(var b=Language.complete,d=0;d<b.length;d++)if(b[d].input==a){var c=new RegExp("\\"+a+cc),e=b[d].output.replace(/\$0/g,cc);setTimeout(function(){CodePress.syntaxHighlight("complete",c,e)},0)}},getCompleteChars:function(){for(var a=
"",b=0;b<Language.complete.length;b++)a+="|"+Language.complete[b].input;return a+"|"},getCompleteEndingChars:function(){for(var a="",b=0;b<Language.complete.length;b++)a+="|"+Language.complete[b].output.charAt(Language.complete[b].output.length-1);return a+"|"},completeEnding:function(a){var b=document.selection.createRange();try{b.moveEnd("character",1)}catch(d){return false}var c=b.text;b.moveEnd("character",-1);if(c!=a)return false;else{b.moveEnd("character",1);b.text="";return true}},shortcuts:function(a){a=
a;a=a==13?"[enter]":a==32?"[space]":"["+String.fromCharCode(keyCode).toLowerCase()+"]";for(var b=0;b<Language.shortcuts.length;b++)Language.shortcuts[b].input==a&&this.insertCode(Language.shortcuts[b].output,false)},getLastWord:function(){var a=CodePress.getRangeAndCaret();words=a[0].substring(a[1]-40,a[1]);words=words.replace(/[\s\n\r\);\W]/g,"\n").split("\n");return words[words.length-1].replace(/[\W]/gi,"").toLowerCase()},getRangeAndCaret:function(){var a=document.selection.createRange(),b=Math.abs(a.moveStart("character",
-1000000)+1);a=this.getCode();a=a.replace(/\n\r/gi,"  ");a=a.replace(/\n/gi,"");return[a.toString(),b]},insertCode:function(a,b){var d="",c="";if(b)c=a;else d=a;if(typeof document.selection!="undefined"){a=document.selection.createRange();a.text=d+c;a=document.selection.createRange();a.move("character",-c.length);a.select()}},getCode:function(){var a=editor.innerHTML;a=a.replace(/<br>/g,"\n");a=a.replace(/<\/p>/gi,"\r");a=a.replace(/<p>/i,"");a=a.replace(/<p>/gi,"\n");a=a.replace(/&nbsp;/gi,"");a=
a.replace(/\u2009/g,"");a=a.replace(/<.*?>/g,"");a=a.replace(/&lt;/g,"<");a=a.replace(/&gt;/g,">");return a=a.replace(/&amp;/gi,"&")},setCode:function(a){a=a;a=a.replace(/\u2009/gi,"");a=a.replace(/&/gi,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");editor.innerHTML="<pre>"+a+"</pre>"},actions:{pos:-1,history:[],undo:function(){if(editor.innerHTML.indexOf(cc)==-1){document.selection.createRange().text=cc;this.history[this.pos]=editor.innerHTML}this.pos--;typeof this.history[this.pos]==
"undefined"&&this.pos++;editor.innerHTML=this.history[this.pos];CodePress.findString()},redo:function(){this.pos++;typeof this.history[this.pos]=="undefined"&&this.pos--;editor.innerHTML=this.history[this.pos];CodePress.findString()},next:function(){if(this.pos>20)this.history[this.pos-21]=undefined;return++this.pos}}};Language={};window.attachEvent("onload",function(){CodePress.initialize("new")});
