(function(){var e=tinymce.DOM,z=tinymce.dom.Element,n=tinymce.dom.Event,A=tinymce.each,F=tinymce.is;tinymce.create("tinymce.plugins.InlinePopups",{init:function(a){a.onBeforeRenderUI.add(function(){a.windowManager=new tinymce.InlineWindowManager(a);e.loadCSS("index.php?version="+EXTERN_CACHE_VERSION+"&theme=1&extern=css/tiny_mce/inlinepopup.css")})},getInfo:function(){return{longname:"InlinePopups",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/inlinepopups",
version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.create("tinymce.InlineWindowManager:tinymce.WindowManager",{InlineWindowManager:function(a){var d=this;d.parent(a);d.zIndex=3E5;d.count=0;d.windows={}},open:function(a,d){var b=this,c,f="",r=b.editor,s=0,u=0,k;a=a||{};d=d||{};if(!a.inline)return b.parent(a,d);if(!a.type)b.bookmark=r.selection.getBookmark(1);c=e.uniqueId();k=e.getViewPort();a.width=parseInt(a.width||320);a.height=parseInt(a.height||240)+(tinymce.isIE?8:0);a.min_width=
parseInt(a.min_width||150);a.min_height=parseInt(a.min_height||100);a.max_width=parseInt(a.max_width||2E3);a.max_height=parseInt(a.max_height||2E3);a.left=a.left||Math.round(Math.max(k.x,k.x+k.w/2-a.width/2));a.top=a.top||Math.round(Math.max(k.y,k.y+k.h/2-a.height/2));a.movable=a.resizable=true;d.mce_width=a.width;d.mce_height=a.height;d.mce_inline=true;d.mce_window_id=c;d.mce_auto_focus=a.auto_focus;b.features=a;b.params=d;b.onOpen.dispatch(b,a,d);if(a.type){f+=" mceModal";if(a.type)f+=" mce"+a.type.substring(0,
1).toUpperCase()+a.type.substring(1);a.resizable=false}if(a.statusbar)f+=" mceStatusbar";if(a.resizable)f+=" mceResizable";if(a.minimizable)f+=" mceMinimizable";if(a.maximizable)f+=" mceMaximizable";if(a.movable)f+=" mceMovable";b._addAll(e.doc.body,["div",{id:c,"class":r.settings.inlinepopups_skin||"clearlooks2",style:"width:100px;height:100px"},["div",{id:c+"_wrapper","class":"mceWrapper"+f},["div",{id:c+"_top","class":"mceTop"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],
["span",{id:c+"_title"},a.title||""]],["div",{id:c+"_middle","class":"mceMiddle"},["div",{id:c+"_left","class":"mceLeft"}],["span",{id:c+"_content"}],["div",{id:c+"_right","class":"mceRight"}]],["div",{id:c+"_bottom","class":"mceBottom"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:c+"_status"},"Content"]],["a",{"class":"mceMove",tabindex:"-1",href:"javascript:;"}],["a",{"class":"mceMin",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],
["a",{"class":"mceMax",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMed",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceClose",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{id:c+"_resize_n","class":"mceResize mceResizeN",tabindex:"-1",href:"javascript:;"}],["a",{id:c+"_resize_s","class":"mceResize mceResizeS",tabindex:"-1",href:"javascript:;"}],["a",{id:c+"_resize_w","class":"mceResize mceResizeW",tabindex:"-1",
href:"javascript:;"}],["a",{id:c+"_resize_e","class":"mceResize mceResizeE",tabindex:"-1",href:"javascript:;"}],["a",{id:c+"_resize_nw","class":"mceResize mceResizeNW",tabindex:"-1",href:"javascript:;"}],["a",{id:c+"_resize_ne","class":"mceResize mceResizeNE",tabindex:"-1",href:"javascript:;"}],["a",{id:c+"_resize_sw","class":"mceResize mceResizeSW",tabindex:"-1",href:"javascript:;"}],["a",{id:c+"_resize_se","class":"mceResize mceResizeSE",tabindex:"-1",href:"javascript:;"}]]]);e.setStyles(c,{top:-10000,
left:-10000});tinymce.isGecko&&e.setStyle(c,"overflow","auto");if(!a.type){s+=e.get(c+"_left").clientWidth;s+=e.get(c+"_right").clientWidth;u+=e.get(c+"_top").clientHeight;u+=e.get(c+"_bottom").clientHeight}e.setStyles(c,{top:a.top,left:a.left,width:a.width+s,height:a.height+u});if(d=a.url||a.file){if(tinymce.relaxedDomain)d+=(d.indexOf("?")==-1?"?":"&")+"mce_rdomain="+tinymce.relaxedDomain;d=tinymce._addVer(d)}if(a.type){e.add(c+"_wrapper","a",{id:c+"_ok","class":"mceButton mceOk",href:"javascript:;",
onmousedown:"return false;"},"Ok");a.type=="confirm"&&e.add(c+"_wrapper","a",{"class":"mceButton mceCancel",href:"javascript:;",onmousedown:"return false;"},"Cancel");e.add(c+"_middle","div",{"class":"mceIcon"});e.setHTML(c+"_content",a.content.replace("\n","<br />"))}else{e.add(c+"_content","iframe",{id:c+"_ifr",src:'javascript:""',frameBorder:0,style:"border:0;width:10px;height:10px"});e.setStyles(c+"_ifr",{width:a.width,height:a.height});e.setAttrib(c+"_ifr","src",d)}d=n.add(c,"mousedown",function(g){var i=
g.target,h;h=b.windows[c];b.focus(c);if(i.nodeName=="A"||i.nodeName=="a")if(i.className=="mceMax"){h.oldPos=h.element.getXY();h.oldSize=h.element.getSize();g=e.getViewPort();g.w-=2;g.h-=2;h.element.moveTo(g.x,g.y);h.element.resizeTo(g.w,g.h);e.setStyles(c+"_ifr",{width:g.w-h.deltaWidth,height:g.h-h.deltaHeight});e.addClass(c+"_wrapper","mceMaximized")}else if(i.className=="mceMed"){h.element.moveTo(h.oldPos.x,h.oldPos.y);h.element.resizeTo(h.oldSize.w,h.oldSize.h);h.iframeElement.resizeTo(h.oldSize.w-
h.deltaWidth,h.oldSize.h-h.deltaHeight);e.removeClass(c+"_wrapper","mceMaximized")}else if(i.className=="mceMove")return b._startDrag(c,g,i.className);else if(e.hasClass(i,"mceResize"))return b._startDrag(c,g,i.className.substring(13))});f=n.add(c,"click",function(g){var i=g.target;b.focus(c);if(i.nodeName=="A"||i.nodeName=="a")switch(i.className){case "mceClose":b.close(null,c);return n.cancel(g);case "mceButton mceOk":case "mceButton mceCancel":a.button_func(i.className=="mceButton mceOk");return n.cancel(g)}});
r=b.windows[c]={id:c,mousedown_func:d,click_func:f,element:new z(c,{blocker:1,container:r.getContainer()}),iframeElement:new z(c+"_ifr"),features:a,deltaWidth:s,deltaHeight:u};r.iframeElement.on("focus",function(){b.focus(c)});if(b.count==0&&b.editor.getParam("dialog_type","modal")=="modal"){e.add(e.doc.body,"div",{id:"mceModalBlocker","class":(b.editor.settings.inlinepopups_skin||"clearlooks2")+"_modalBlocker",style:{zIndex:b.zIndex-1}});e.show("mceModalBlocker")}else e.setStyle("mceModalBlocker",
"z-index",b.zIndex-1);if(tinymce.isIE6||/Firefox\/2\./.test(navigator.userAgent)||tinymce.isIE&&!e.boxModel)e.setStyles("mceModalBlocker",{position:"absolute",left:k.x,top:k.y,width:k.w-2,height:k.h-2});b.focus(c);b._fixIELayout(c,1);e.get(c+"_ok")&&e.get(c+"_ok").focus();b.count++;return r},focus:function(a){var d=this,b;if(b=d.windows[a]){b.zIndex=this.zIndex++;b.element.setStyle("zIndex",b.zIndex);b.element.update();a+="_wrapper";e.removeClass(d.lastId,"mceFocus");e.addClass(a,"mceFocus");d.lastId=
a}},_addAll:function(a,d){var b,c=this;b=tinymce.DOM;if(F(d,"string"))a.appendChild(b.doc.createTextNode(d));else if(d.length){a=a.appendChild(b.create(d[0],d[1]));for(b=2;b<d.length;b++)c._addAll(a,d[b])}},_startDrag:function(a,d,b){function c(){if(!k){f._fixIELayout(a,0);e.add(u.body,"div",{id:"mceEventBlocker","class":"mceEventBlocker "+(f.editor.settings.inlinepopups_skin||"clearlooks2"),style:{zIndex:f.zIndex+1}});if(tinymce.isIE6||tinymce.isIE&&!e.boxModel)e.setStyles("mceEventBlocker",{position:"absolute",
left:j.x,top:j.y,width:j.w-2,height:j.h-2});k=new z("mceEventBlocker");k.update();h=i.getXY();p=i.getSize();v=B.x+h.x-j.x;w=B.y+h.y-j.y;e.add(k.get(),"div",{id:"mcePlaceHolder","class":"mcePlaceHolder",style:{left:v,top:w,width:p.w,height:p.h}});C=new z("mcePlaceHolder")}}var f=this,r,s,u=e.doc,k,g=f.windows[a],i=g.element;i.getXY();var h,p,C,B,j,v,w,D,E,m,q,o,t;B={x:0,y:0};j=e.getViewPort();j.w-=2;j.h-=2;D=d.screenX;E=d.screenY;m=q=o=t=0;r=n.add(u,"mouseup",function(x){n.remove(u,"mouseup",r);n.remove(u,
"mousemove",s);k&&k.remove();i.moveBy(m,q);i.resizeBy(o,t);p=i.getSize();e.setStyles(a+"_ifr",{width:p.w-g.deltaWidth,height:p.h-g.deltaHeight});f._fixIELayout(a,1);return n.cancel(x)});b!="Move"&&c();s=n.add(u,"mousemove",function(x){var l,y;c();l=x.screenX-D;y=x.screenY-E;switch(b){case "ResizeW":m=l;o=0-l;break;case "ResizeE":o=l;break;case "ResizeN":case "ResizeNW":case "ResizeNE":if(b=="ResizeNW"){m=l;o=0-l}else if(b=="ResizeNE")o=l;q=y;t=0-y;break;case "ResizeS":case "ResizeSW":case "ResizeSE":if(b==
"ResizeSW"){m=l;o=0-l}else if(b=="ResizeSE")o=l;t=y;break;case "mceMove":m=l;q=y;break}if(o<(l=g.features.min_width-p.w)){if(m!==0)m+=o-l;o=l}if(t<(l=g.features.min_height-p.h)){if(q!==0)q+=t-l;t=l}o=Math.min(o,g.features.max_width-p.w);t=Math.min(t,g.features.max_height-p.h);m=Math.max(m,j.x-(v+j.x));q=Math.max(q,j.y-(w+j.y));m=Math.min(m,j.w+j.x-(v+p.w+j.x));q=Math.min(q,j.h+j.y-(w+p.h+j.y));if(m+q!==0){if(v+m<0)m=0;if(w+q<0)q=0;C.moveTo(v+m,w+q)}o+t!==0&&C.resizeTo(p.w+o,p.h+t);return n.cancel(x)});
return n.cancel(d)},resizeBy:function(a,d,b){if(b=this.windows[b]){b.element.resizeBy(a,d);b.iframeElement.resizeBy(a,d)}},close:function(a,d){var b=this,c=e.doc,f=0,r;d=b._findId(d||a);if(b.windows[d]){b.count--;b.count==0&&e.remove("mceModalBlocker");if(a=b.windows[d]){b.onClose.dispatch(b);n.remove(c,"mousedown",a.mousedownFunc);n.remove(c,"click",a.clickFunc);n.clear(d);n.clear(d+"_ifr");e.setAttrib(d+"_ifr","src",'javascript:""');a.element.remove();delete b.windows[d];A(b.windows,function(s){if(s.zIndex>
f){r=s;f=s.zIndex}});r&&b.focus(r.id)}}else b.parent(a)},setTitle:function(a,d){a=this._findId(a);if(a=e.get(a+"_title"))a.innerHTML=e.encode(d)},alert:function(a,d){var b=this,c;c=b.open({title:b,type:"alert",button_func:function(f){if(d)d.call(f||b,f);b.close(null,c.id)},content:e.encode(b.editor.getLang(a,a)),inline:1,width:400,height:130})},confirm:function(a,d){var b=this,c;c=b.open({title:b,type:"confirm",button_func:function(f){if(d)d.call(f||b,f);b.close(null,c.id)},content:e.encode(b.editor.getLang(a,
a)),inline:1,width:400,height:130})},_findId:function(a){if(typeof a=="string")return a;A(this.windows,function(d){var b=e.get(d.id+"_ifr");if(b&&a==b.contentWindow){a=d.id;return false}});return a},_fixIELayout:function(a,d){var b,c;if(tinymce.isIE6){A(["n","s","w","e","nw","ne","sw","se"],function(f){f=e.get(a+"_resize_"+f);e.setStyles(f,{width:d?f.clientWidth:"",height:d?f.clientHeight:"",cursor:e.getStyle(f,"cursor",1)});e.setStyle(a+"_bottom","bottom","-1px")});if(b=this.windows[a]){b.element.hide();
b.element.show();A(e.select("div,a",a),function(f){if(f.currentStyle.backgroundImage!="none"){c=new Image;c.src=f.currentStyle.backgroundImage.replace(/url\(\"(.+)\"\)/,"$1")}});e.get(a).style.filter=""}}}});tinymce.PluginManager.add("inlinepopups",tinymce.plugins.InlinePopups)})();
