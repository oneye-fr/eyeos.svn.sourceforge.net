CodePress={scrolling:false,autocomplete:true,initialize:function(a){if(!(typeof editor=="undefined"&&!a)){chars="|32|46|62|";cc="\u2009";editor=document.getElementsByTagName("body")[0];document.designMode="on";document.addEventListener("keyup",this.keyHandler,true);window.addEventListener("scroll",function(){CodePress.scrolling||CodePress.syntaxHighlight("scroll")},false);completeChars=this.getCompleteChars()}},keyHandler:function(a){keyCode=a.keyCode;charCode=a.charCode;if((a.ctrlKey||a.metaKey)&&
a.shiftKey&&charCode!=90)CodePress.shortcuts(charCode?charCode:keyCode);else if(completeChars.indexOf("|"+String.fromCharCode(charCode)+"|")!=-1&&CodePress.autocomplete)CodePress.complete(String.fromCharCode(charCode));else if(chars.indexOf("|"+charCode+"|")!=-1||keyCode==13)CodePress.syntaxHighlight("generic");else if(keyCode==9||a.tabKey)CodePress.snippets(a);else if(keyCode==46||keyCode==8)CodePress.actions.history[CodePress.actions.next()]=editor.innerHTML;else if((charCode==122||charCode==121||
charCode==90)&&a.ctrlKey){charCode==121||a.shiftKey?CodePress.actions.redo():CodePress.actions.undo();a.preventDefault()}},findString:function(){var a=window.getSelection(),b=window.document.createRange(),c=window.document.getElementsByTagName("span")[0];b.selectNode(c);a.removeAllRanges();a.addRange(b);c.parentNode.removeChild(c)},split:function(a,b){if(b=="scroll")this.scrolling=true;else{this.scrolling=false;mid=a.indexOf("<SPAN>");if(mid-2E3<0){ini=0;end=4E3}else if(mid+2E3>a.length){ini=a.length-
4E3;end=a.length}else{ini=mid-2E3;end=mid+2E3}a=a.substring(ini,end)}return a},syntaxHighlight:function(a,b,c){if(a!="init"){var e=document.createElement("span");window.getSelection().getRangeAt(0).insertNode(e)}o=editor.innerHTML;o=o.replace(/<(?!span|\/span|br).*?>/gi,"");x=z=this.split(o,a);x=x.replace(/\t/g,"        ");if(b&&c)x=x.replace(b,c);for(i=0;i<Language.syntax.length;i++)x=x.replace(Language.syntax[i].input,Language.syntax[i].output);editor.innerHTML=this.actions.history[this.actions.next()]=
a=="scroll"?x:o.split(z).join(x);a!="init"&&this.findString()},getLastWord:function(){var a=CodePress.getRangeAndCaret();words=a[0].substring(a[1]-40,a[1]);words=words.replace(/[\s\n\r\);\W]/g,"\n").split("\n");return words[words.length-1].replace(/[\W]/gi,"").toLowerCase()},snippets:function(a){for(var b=Language.snippets,c=this.getLastWord(),e=0;e<b.length;e++)if(b[e].input==c){var d=b[e].output.replace(/</g,"&lt;");d=d.replace(/>/g,"&gt;");if(d.indexOf("$0")<0)d+=cc;else d=d.replace(/\$0/,cc);
d=d.replace(/\n/g,"<br>");var f=new RegExp(c+cc,"gi");a.preventDefault();this.syntaxHighlight("snippets",f,d)}},readOnly:function(a){document.designMode=a?"off":"on"},complete:function(a){window.getSelection().getRangeAt(0).deleteContents();for(var b=Language.complete,c=0;c<b.length;c++)if(b[c].input==a){var e=new RegExp("\\"+a+cc),d=b[c].output.replace(/\$0/g,cc);parent.setTimeout(function(){CodePress.syntaxHighlight("complete",e,d)},0)}},getCompleteChars:function(){for(var a="",b=0;b<Language.complete.length;b++)a+=
"|"+Language.complete[b].input;return a+"|"},shortcuts:function(a){a=a;a=a==13?"[enter]":a==32?"[space]":"["+String.fromCharCode(charCode).toLowerCase()+"]";for(var b=0;b<Language.shortcuts.length;b++)Language.shortcuts[b].input==a&&this.insertCode(Language.shortcuts[b].output,false)},getRangeAndCaret:function(){var a=window.getSelection().getRangeAt(0),b=a.cloneRange(),c=a.endOffset;b.selectNode(a.endContainer);return[b.toString(),c]},insertCode:function(a,b){var c=window.getSelection().getRangeAt(0);
a=window.document.createTextNode(a);var e=window.getSelection(),d=c.cloneRange();e.removeAllRanges();c.deleteContents();c.insertNode(a);d.selectNode(a);d.collapse(b);e.removeAllRanges();e.addRange(d)},getCode:function(){var a=editor.innerHTML;a=a.replace(/<br>/g,"\n");a=a.replace(/\u2009/g,"");a=a.replace(/<.*?>/g,"");a=a.replace(/&lt;/g,"<");a=a.replace(/&gt;/g,">");return a=a.replace(/&amp;/gi,"&")},setCode:function(a){a=a;a=a.replace(/\u2009/gi,"");a=a.replace(/&/gi,"&amp;");a=a.replace(/</g,"&lt;");
a=a.replace(/>/g,"&gt;");editor.innerHTML=a},actions:{pos:-1,history:[],undo:function(){if(editor.innerHTML.indexOf(cc)==-1){window.getSelection().getRangeAt(0).insertNode(document.createTextNode(cc));this.history[this.pos]=editor.innerHTML}this.pos--;typeof this.history[this.pos]=="undefined"&&this.pos++;editor.innerHTML=this.history[this.pos];CodePress.findString()},redo:function(){this.pos++;typeof this.history[this.pos]=="undefined"&&this.pos--;editor.innerHTML=this.history[this.pos];CodePress.findString()},
next:function(){if(this.pos>20)this.history[this.pos-21]=undefined;return++this.pos}}};Language={};window.addEventListener("load",function(){CodePress.initialize("new")},true);
