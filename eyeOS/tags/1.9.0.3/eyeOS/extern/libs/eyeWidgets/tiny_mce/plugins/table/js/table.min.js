tinyMCEPopup.requireLangPack();var action,orgTableWidth,orgTableHeight,dom=tinyMCEPopup.editor.dom;
function insertTable(){var b=document.forms[0],a=tinyMCEPopup.editor,c=a.dom,k=2,m=2,j=0,n=-1,o=-1,p,i,l,u,q,v,w,e="",d,r,s,t;tinyMCEPopup.restoreSelection();if(!AutoValidator.validate(b)){tinyMCEPopup.alert(a.getLang("invalid_data"));return false}d=c.getParent(a.selection.getNode(),"table");k=b.elements.cols.value;m=b.elements.rows.value;j=b.elements.border.value!=""?b.elements.border.value:0;n=b.elements.cellpadding.value!=""?b.elements.cellpadding.value:"";o=b.elements.cellspacing.value!=""?b.elements.cellspacing.value:
"";p=getSelectValue(b,"align");v=getSelectValue(b,"tframe");w=getSelectValue(b,"rules");i=b.elements.width.value;l=b.elements.height.value;bordercolor=b.elements.bordercolor.value;bgcolor=b.elements.bgcolor.value;u=getSelectValue(b,"class");id=b.elements.id.value;summary=b.elements.summary.value;style=b.elements.style.value;dir=b.elements.dir.value;lang=b.elements.lang.value;background=b.elements.backgroundimage.value;q=b.elements.caption.checked;r=tinyMCEPopup.getParam("table_cell_limit",false);
s=tinyMCEPopup.getParam("table_row_limit",false);if((t=tinyMCEPopup.getParam("table_col_limit",false))&&k>t){tinyMCEPopup.alert(a.getLang("table_dlg.col_limit").replace(/\{\$cols\}/g,t));return false}else if(s&&m>s){tinyMCEPopup.alert(a.getLang("table_dlg.row_limit").replace(/\{\$rows\}/g,s));return false}else if(r&&k*m>r){tinyMCEPopup.alert(a.getLang("table_dlg.cell_limit").replace(/\{\$cells\}/g,r));return false}if(action=="update"){a.execCommand("mceBeginUndoLevel");c.setAttrib(d,"cellPadding",
n,true);c.setAttrib(d,"cellSpacing",o,true);c.setAttrib(d,"border",j);c.setAttrib(d,"align",p);c.setAttrib(d,"frame",v);c.setAttrib(d,"rules",w);c.setAttrib(d,"class",u);c.setAttrib(d,"style",style);c.setAttrib(d,"id",id);c.setAttrib(d,"summary",summary);c.setAttrib(d,"dir",dir);c.setAttrib(d,"lang",lang);(e=a.dom.select("caption",d)[0])&&!q&&e.parentNode.removeChild(e);if(!e&&q){e=d.ownerDocument.createElement("caption");if(!tinymce.isIE)e.innerHTML='<br mce_bogus="1"/>';d.insertBefore(e,d.firstChild)}if(i&&
a.settings.inline_styles){c.setStyle(d,"width",i);c.setAttrib(d,"width","")}else{c.setAttrib(d,"width",i,true);c.setStyle(d,"width","")}c.setAttrib(d,"borderColor","");c.setAttrib(d,"bgColor","");c.setAttrib(d,"background","");if(l&&a.settings.inline_styles){c.setStyle(d,"height",l);c.setAttrib(d,"height","")}else{c.setAttrib(d,"height",l,true);c.setStyle(d,"height","")}d.style.backgroundImage=background!=""?"url('"+background+"')":"";if(bordercolor!=""){d.style.borderColor=bordercolor;d.style.borderStyle=
d.style.borderStyle==""?"solid":d.style.borderStyle;d.style.borderWidth=j==""?"1px":j}else d.style.borderColor="";d.style.backgroundColor=bgcolor;d.style.height=getCSSSize(l);a.addVisual();a.nodeChanged();a.execCommand("mceEndUndoLevel");if(b.width.value!=orgTableWidth||b.height.value!=orgTableHeight)a.execCommand("mceRepaint");tinyMCEPopup.close();return true}e+="<table";e+=makeAttrib("id",id);e+=makeAttrib("border",j);e+=makeAttrib("cellpadding",n);e+=makeAttrib("cellspacing",o);if(i&&a.settings.inline_styles){if(style)style+=
"; ";if(/^[0-9\.]+$/.test(i))i+="px";style+="width: "+i}else e+=makeAttrib("width",i);e+=makeAttrib("align",p);e+=makeAttrib("frame",v);e+=makeAttrib("rules",w);e+=makeAttrib("class",u);e+=makeAttrib("style",style);e+=makeAttrib("summary",summary);e+=makeAttrib("dir",dir);e+=makeAttrib("lang",lang);e+=">";if(q)e+=tinymce.isIE?"<caption></caption>":'<caption><br mce_bogus="1"/></caption>';for(b=0;b<m;b++){e+="<tr>";for(j=0;j<k;j++)e+=tinymce.isIE?"<td></td>":'<td><br mce_bogus="1"/></td>';e+="</tr>"}e+=
"</table>";a.execCommand("mceBeginUndoLevel");if(a.settings.fix_table_elements){k=a.selection.getBookmark();var h="";a.execCommand("mceInsertContent",false,'<br class="_mce_marker" />');tinymce.each("h1,h2,h3,h4,h5,h6,p".split(","),function(f){if(h)h+=",";h+=f+" ._mce_marker"});tinymce.each(a.dom.select(h),function(f){a.dom.split(a.dom.getParent(f,"h1,h2,h3,h4,h5,h6,p"),f)});c.setOuterHTML(c.select("._mce_marker")[0],e);a.selection.moveToBookmark(k)}else a.execCommand("mceInsertContent",false,e);
a.addVisual();a.execCommand("mceEndUndoLevel");tinyMCEPopup.close()}function makeAttrib(b,a){var c=document.forms[0].elements[b];if(typeof a=="undefined"||a==null){a="";if(c)a=c.value}if(a=="")return"";a=a.replace(/&/g,"&amp;");a=a.replace(/\"/g,"&quot;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");return" "+b+'="'+a+'"'}
function init(){tinyMCEPopup.resizeToInnerSize();document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table");document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table");document.getElementById("bordercolor_pickcontainer").innerHTML=getColorPickerHTML("bordercolor_pick","bordercolor");document.getElementById("bgcolor_pickcontainer").innerHTML=
getColorPickerHTML("bgcolor_pick","bgcolor");var b=2,a=2,c=tinyMCEPopup.getParam("table_default_border","0"),k=tinyMCEPopup.getParam("table_default_cellpadding",""),m=tinyMCEPopup.getParam("table_default_cellspacing",""),j="",n="",o="",p="",i="",l="",u="",q="",v="",w="",e="",d="";p=i="";var r,s,t=tinyMCEPopup.editor,h=t.dom,f=document.forms[0],g=h.getParent(t.selection.getNode(),"table");(action=tinyMCEPopup.getWindowArg("action"))||(action=g?"update":"insert");if(g&&action!="insert"){a=g.rows;for(c=
b=0;c<a.length;c++)if(a[c].cells.length>b)b=a[c].cells.length;b=b;a=a.length;st=h.parseStyle(h.getAttrib(g,"style"));c=trimSize(getStyle(g,"border","borderWidth"));k=h.getAttrib(g,"cellpadding","");m=h.getAttrib(g,"cellspacing","");n=trimSize(getStyle(g,"width","width"));o=trimSize(getStyle(g,"height","height"));p=convertRGBToHex(getStyle(g,"bordercolor","borderLeftColor"));i=convertRGBToHex(getStyle(g,"bgcolor","backgroundColor"));j=h.getAttrib(g,"align",j);s=h.getAttrib(g,"frame");r=h.getAttrib(g,
"rules");l=tinymce.trim(h.getAttrib(g,"class").replace(/mceItem.+/g,""));u=h.getAttrib(g,"id");q=h.getAttrib(g,"summary");v=h.serializeStyle(st);w=h.getAttrib(g,"dir");e=h.getAttrib(g,"lang");d=getStyle(g,"background","backgroundImage").replace(new RegExp("url\\('?([^']*)'?\\)","gi"),"$1");f.caption.checked=g.getElementsByTagName("caption").length>0;orgTableWidth=n;orgTableHeight=o;action="update";f.insert.value=t.getLang("update")}addClassesToList("class","table_styles");TinyMCE_EditableSelects.init();
selectByValue(f,"align",j);selectByValue(f,"tframe",s);selectByValue(f,"rules",r);selectByValue(f,"class",l,true,true);f.cols.value=b;f.rows.value=a;f.border.value=c;f.cellpadding.value=k;f.cellspacing.value=m;f.width.value=n;f.height.value=o;f.bordercolor.value=p;f.bgcolor.value=i;f.id.value=u;f.summary.value=q;f.style.value=v;f.dir.value=w;f.lang.value=e;f.backgroundimage.value=d;updateColor("bordercolor_pick","bordercolor");updateColor("bgcolor_pick","bgcolor");if(isVisible("backgroundimagebrowser"))document.getElementById("backgroundimage").style.width=
"180px";if(action=="update"){f.cols.disabled=true;f.rows.disabled=true}}function changedSize(){var b=document.forms[0],a=dom.parseStyle(b.style.value),c=b.height.value;a.height=c!=""?getCSSSize(c):"";b.style.value=dom.serializeStyle(a)}function changedBackgroundImage(){var b=document.forms[0],a=dom.parseStyle(b.style.value);a["background-image"]="url('"+b.backgroundimage.value+"')";b.style.value=dom.serializeStyle(a)}
function changedBorder(){var b=document.forms[0],a=dom.parseStyle(b.style.value);if(b.border.value!=""&&b.bordercolor.value!="")a["border-width"]=b.border.value+"px";b.style.value=dom.serializeStyle(a)}
function changedColor(){var b=document.forms[0],a=dom.parseStyle(b.style.value);a["background-color"]=b.bgcolor.value;if(b.bordercolor.value!=""){a["border-color"]=b.bordercolor.value;a["border-width"]||(a["border-width"]=b.border.value==""?"1px":b.border.value+"px")}b.style.value=dom.serializeStyle(a)}
function changedStyle(){var b=document.forms[0],a=dom.parseStyle(b.style.value);b.backgroundimage.value=a["background-image"]?a["background-image"].replace(new RegExp("url\\('?([^']*)'?\\)","gi"),"$1"):"";if(a.width)b.width.value=trimSize(a.width);if(a.height)b.height.value=trimSize(a.height);if(a["background-color"]){b.bgcolor.value=a["background-color"];updateColor("bgcolor_pick","bgcolor")}if(a["border-color"]){b.bordercolor.value=a["border-color"];updateColor("bordercolor_pick","bordercolor")}}
tinyMCEPopup.onInit.add(init);
