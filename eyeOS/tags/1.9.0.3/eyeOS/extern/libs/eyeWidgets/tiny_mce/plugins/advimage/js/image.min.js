var ImageDialog={preInit:function(){var b;tinyMCEPopup.requireLangPack();if(b=tinyMCEPopup.getParam("external_image_list_url"))document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(b)+'"><\/script>')},init:function(b){var c=document.forms[0],a=c.elements;b=tinyMCEPopup.editor;var e=b.dom,d=b.selection.getNode();tinyMCEPopup.resizeToInnerSize();this.fillClassList("class_list");this.fillFileList("src_list","tinyMCEImageList");this.fillFileList("over_list",
"tinyMCEImageList");this.fillFileList("out_list","tinyMCEImageList");TinyMCE_EditableSelects.init();if(d.nodeName=="IMG"){a.src.value=e.getAttrib(d,"src");a.width.value=e.getAttrib(d,"width");a.height.value=e.getAttrib(d,"height");a.alt.value=e.getAttrib(d,"alt");a.title.value=e.getAttrib(d,"title");a.vspace.value=this.getAttrib(d,"vspace");a.hspace.value=this.getAttrib(d,"hspace");a.border.value=this.getAttrib(d,"border");selectByValue(c,"align",this.getAttrib(d,"align"));selectByValue(c,"class_list",
e.getAttrib(d,"class"),true,true);a.style.value=e.getAttrib(d,"style");a.id.value=e.getAttrib(d,"id");a.dir.value=e.getAttrib(d,"dir");a.lang.value=e.getAttrib(d,"lang");a.usemap.value=e.getAttrib(d,"usemap");a.longdesc.value=e.getAttrib(d,"longdesc");a.insert.value=b.getLang("update");if(/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/.test(e.getAttrib(d,"onmouseover")))a.onmouseoversrc.value=e.getAttrib(d,"onmouseover").replace(/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/,"$1");if(/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/.test(e.getAttrib(d,
"onmouseout")))a.onmouseoutsrc.value=e.getAttrib(d,"onmouseout").replace(/^\s*this.src\s*=\s*\'([^\']+)\';?\s*$/,"$1");if(b.settings.inline_styles){e.getAttrib(d,"align")&&this.updateStyle("align");e.getAttrib(d,"hspace")&&this.updateStyle("hspace");e.getAttrib(d,"border")&&this.updateStyle("border");e.getAttrib(d,"vspace")&&this.updateStyle("vspace")}}document.getElementById("srcbrowsercontainer").innerHTML=getBrowserHTML("srcbrowser","src","image","theme_advanced_image");if(isVisible("srcbrowser"))document.getElementById("src").style.width=
"260px";document.getElementById("onmouseoversrccontainer").innerHTML=getBrowserHTML("overbrowser","onmouseoversrc","image","theme_advanced_image");if(isVisible("overbrowser"))document.getElementById("onmouseoversrc").style.width="260px";document.getElementById("onmouseoutsrccontainer").innerHTML=getBrowserHTML("outbrowser","onmouseoutsrc","image","theme_advanced_image");if(isVisible("outbrowser"))document.getElementById("onmouseoutsrc").style.width="260px";if(b.getParam("advimage_constrain_proportions",
true))c.constrain.checked=true;a.onmouseoversrc.value||a.onmouseoutsrc.value?this.setSwapImage(true):this.setSwapImage(false);this.changeAppearance();this.showPreviewImage(a.src.value,1)},insert:function(){var b=tinyMCEPopup.editor,c=this,a=document.forms[0];if(a.src.value===""){if(b.selection.getNode().nodeName=="IMG"){b.dom.remove(b.selection.getNode());b.execCommand("mceRepaint")}tinyMCEPopup.close()}else{if(tinyMCEPopup.getParam("accessibility_warnings",1))if(!a.alt.value){tinyMCEPopup.confirm(tinyMCEPopup.getLang("advimage_dlg.missing_alt"),
function(e){e&&c.insertAndClose()});return}c.insertAndClose()}},insertAndClose:function(){var b=tinyMCEPopup.editor,c=document.forms[0],a=c.elements,e={};tinyMCEPopup.restoreSelection();tinymce.isWebKit&&b.getWin().focus();e=b.settings.inline_styles?{vspace:"",hspace:"",border:"",align:""}:{vspace:a.vspace.value,hspace:a.hspace.value,border:a.border.value,align:getSelectValue(c,"align")};tinymce.extend(e,{src:a.src.value,width:a.width.value,height:a.height.value,alt:a.alt.value,title:a.title.value,
"class":getSelectValue(c,"class_list"),style:a.style.value,id:a.id.value,dir:a.dir.value,lang:a.lang.value,usemap:a.usemap.value,longdesc:a.longdesc.value});e.onmouseover=e.onmouseout="";if(c.onmousemovecheck.checked){if(a.onmouseoversrc.value)e.onmouseover="this.src='"+a.onmouseoversrc.value+"';";if(a.onmouseoutsrc.value)e.onmouseout="this.src='"+a.onmouseoutsrc.value+"';"}if((c=b.selection.getNode())&&c.nodeName=="IMG")b.dom.setAttribs(c,e);else{b.execCommand("mceInsertContent",false,'<img id="__mce_tmp" />',
{skip_undo:1});b.dom.setAttribs("__mce_tmp",e);b.dom.setAttrib("__mce_tmp","id","");b.undoManager.add()}tinyMCEPopup.close()},getAttrib:function(b,c){var a=tinyMCEPopup.editor,e=a.dom,d;if(a.settings.inline_styles)switch(c){case "align":if(d=e.getStyle(b,"float"))return d;if(d=e.getStyle(b,"vertical-align"))return d;break;case "hspace":d=e.getStyle(b,"margin-left");a=e.getStyle(b,"margin-right");if(d&&d==a)return parseInt(d.replace(/[^0-9]/g,""));break;case "vspace":d=e.getStyle(b,"margin-top");a=
e.getStyle(b,"margin-bottom");if(d&&d==a)return parseInt(d.replace(/[^0-9]/g,""));break;case "border":d=0;tinymce.each(["top","right","bottom","left"],function(f){f=e.getStyle(b,"border-"+f+"-width");if(!f||f!=d&&d!==0){d=0;return false}if(f)d=f});if(d)return parseInt(d.replace(/[^0-9]/g,""));break}if(d=e.getAttrib(b,c))return d;return""},setSwapImage:function(b){var c=document.forms[0];c.onmousemovecheck.checked=b;setBrowserDisabled("overbrowser",!b);setBrowserDisabled("outbrowser",!b);if(c.over_list)c.over_list.disabled=
!b;if(c.out_list)c.out_list.disabled=!b;c.onmouseoversrc.disabled=!b;c.onmouseoutsrc.disabled=!b},fillClassList:function(b){var c=tinyMCEPopup.dom,a=c.get(b),e,d;if(e=tinyMCEPopup.getParam("theme_advanced_styles")){d=[];tinymce.each(e.split(";"),function(f){f=f.split("=");d.push({title:f[0],"class":f[1]})})}else d=tinyMCEPopup.editor.dom.getClasses();if(d.length>0){a.options.length=0;a.options[a.options.length]=new Option(tinyMCEPopup.getLang("not_set"),"");tinymce.each(d,function(f){a.options[a.options.length]=
new Option(f.title||f["class"],f["class"])})}else c.remove(c.getParent(b,"tr"))},fillFileList:function(b,c){var a=tinyMCEPopup.dom,e=a.get(b);c=window[c];e.options.length=0;if(c&&c.length>0){e.options[e.options.length]=new Option("","");tinymce.each(c,function(d){e.options[e.options.length]=new Option(d[0],d[1])})}else a.remove(a.getParent(b,"tr"))},resetImageData:function(){var b=document.forms[0];b.elements.width.value=b.elements.height.value=""},updateImageData:function(b,c){var a=document.forms[0];
if(!c){a.elements.width.value=b.width;a.elements.height.value=b.height}this.preloadImg=b},changeAppearance:function(){var b=tinyMCEPopup.editor,c=document.forms[0],a=document.getElementById("alignSampleImg");if(a)if(b.getParam("inline_styles"))b.dom.setAttrib(a,"style",c.style.value);else{a.align=c.align.value;a.border=c.border.value;a.hspace=c.hspace.value;a.vspace=c.vspace.value}},changeHeight:function(){var b=document.forms[0],c;c=this;if(b.constrain.checked&&c.preloadImg)if(!(b.width.value==""||
b.height.value=="")){c=parseInt(b.width.value)/parseInt(c.preloadImg.width)*c.preloadImg.height;b.height.value=c.toFixed(0)}},changeWidth:function(){var b=document.forms[0],c;c=this;if(b.constrain.checked&&c.preloadImg)if(!(b.width.value==""||b.height.value=="")){c=parseInt(b.height.value)/parseInt(c.preloadImg.height)*c.preloadImg.width;b.width.value=c.toFixed(0)}},updateStyle:function(b){var c=tinyMCEPopup.dom,a,e=document.forms[0],d=c.create("img",{style:c.get("style").value});if(tinyMCEPopup.editor.settings.inline_styles){if(b==
"align"){c.setStyle(d,"float","");c.setStyle(d,"vertical-align","");if(a=getSelectValue(e,"align"))if(a=="left"||a=="right")c.setStyle(d,"float",a);else d.style.verticalAlign=a}if(b=="border"){c.setStyle(d,"border","");if((a=e.border.value)||a=="0")d.style.border=a=="0"?"0":a+"px solid black"}if(b=="hspace"){c.setStyle(d,"marginLeft","");c.setStyle(d,"marginRight","");if(a=e.hspace.value){d.style.marginLeft=a+"px";d.style.marginRight=a+"px"}}if(b=="vspace"){c.setStyle(d,"marginTop","");c.setStyle(d,
"marginBottom","");if(a=e.vspace.value){d.style.marginTop=a+"px";d.style.marginBottom=a+"px"}}c.get("style").value=c.serializeStyle(c.parseStyle(d.style.cssText))}},changeMouseMove:function(){},showPreviewImage:function(b,c){if(b){!c&&tinyMCEPopup.getParam("advimage_update_dimensions_onchange",true)&&this.resetImageData();b=tinyMCEPopup.editor.documentBaseURI.toAbsolute(b);c?tinyMCEPopup.dom.setHTML("prev",'<img id="previewImg" src="'+b+'" border="0" onload="ImageDialog.updateImageData(this, 1);" />'):
tinyMCEPopup.dom.setHTML("prev",'<img id="previewImg" src="'+b+'" border="0" onload="ImageDialog.updateImageData(this);" onerror="ImageDialog.resetImageData();" />')}else tinyMCEPopup.dom.setHTML("prev","")}};ImageDialog.preInit();tinyMCEPopup.onInit.add(ImageDialog.init,ImageDialog);
