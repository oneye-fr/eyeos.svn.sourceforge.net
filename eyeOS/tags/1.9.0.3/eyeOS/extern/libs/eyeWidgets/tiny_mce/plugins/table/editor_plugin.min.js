(function(){function O(b,m){var c=m.ownerDocument,p=c.createRange();p.setStartBefore(m);p.setEnd(b.endContainer,b.endOffset);b=c.createElement("body");b.appendChild(p.cloneContents());return b.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi,"-").replace(/<[^>]+>/g,"").length==0}var H=tinymce.each;tinymce.create("tinymce.plugins.TablePlugin",{init:function(b,m){var c=this;c.editor=b;c.url=m;H([["table","table.desc","mceInsertTable",true],["delete_table","table.del","mceTableDelete"],
["delete_col","table.delete_col_desc","mceTableDeleteCol"],["delete_row","table.delete_row_desc","mceTableDeleteRow"],["col_after","table.col_after_desc","mceTableInsertColAfter"],["col_before","table.col_before_desc","mceTableInsertColBefore"],["row_after","table.row_after_desc","mceTableInsertRowAfter"],["row_before","table.row_before_desc","mceTableInsertRowBefore"],["row_props","table.row_desc","mceTableRowProps",true],["cell_props","table.cell_desc","mceTableCellProps",true],["split_cells","table.split_cells_desc",
"mceTableSplitCells",true],["merge_cells","table.merge_cells_desc","mceTableMergeCells",true]],function(p){b.addButton(p[0],{title:p[1],cmd:p[2],ui:p[3]})});b.getParam("inline_styles")&&b.onPreProcess.add(function(p,i){var j=p.dom;H(j.select("table",i.node),function(g){var u;if(u=j.getAttrib(g,"width")){j.setStyle(g,"width",u);j.setAttrib(g,"width")}if(u=j.getAttrib(g,"height")){j.setStyle(g,"height",u);j.setAttrib(g,"height")}})});b.onInit.add(function(){if(!tinymce.isIE&&b.getParam("forced_root_block")){function p(){var i=
b.getBody().lastChild;i&&i.nodeName=="TABLE"&&b.dom.add(b.getBody(),"p",null,'<br mce_bogus="1" />')}tinymce.isGecko&&b.onKeyDown.add(function(i,j){var g,u,G=i.dom;if(j.keyCode==37||j.keyCode==38){g=i.selection.getRng();if((u=G.getParent(g.startContainer,"table"))&&i.getBody().firstChild==u)if(O(g,u)){g=G.createRng();g.setStartBefore(u);g.setEndBefore(u);i.selection.setRng(g);j.preventDefault()}}});b.onKeyUp.add(p);b.onSetContent.add(p);b.onVisualAid.add(p);b.onPreProcess.add(function(i,j){(j=j.node.lastChild)&&
j.childNodes.length==1&&j.firstChild.nodeName=="BR"&&i.dom.remove(j)});p()}b&&b.plugins.contextmenu&&b.plugins.contextmenu.onContextMenu.add(function(i,j,g){i=b.selection.getNode()||b.getBody();if(b.dom.getParent(g,"td")||b.dom.getParent(g,"th")){j.removeAll();if(i.nodeName=="A"&&!b.dom.getAttrib(i,"name")){j.add({title:"advanced.link_desc",icon:"link",cmd:b.plugins.advlink?"mceAdvLink":"mceLink",ui:true});j.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"});j.addSeparator()}if(i.nodeName==
"IMG"&&i.className.indexOf("mceItem")==-1){j.add({title:"advanced.image_desc",icon:"image",cmd:b.plugins.advimage?"mceAdvImage":"mceImage",ui:true});j.addSeparator()}j.add({title:"table.desc",icon:"table",cmd:"mceInsertTable",ui:true,value:{action:"insert"}});j.add({title:"table.props_desc",icon:"table_props",cmd:"mceInsertTable",ui:true});j.add({title:"table.del",icon:"delete_table",cmd:"mceTableDelete",ui:true});j.addSeparator();g=j.addMenu({title:"table.cell"});g.add({title:"table.cell_desc",icon:"cell_props",
cmd:"mceTableCellProps",ui:true});g.add({title:"table.split_cells_desc",icon:"split_cells",cmd:"mceTableSplitCells",ui:true});g.add({title:"table.merge_cells_desc",icon:"merge_cells",cmd:"mceTableMergeCells",ui:true});g=j.addMenu({title:"table.row"});g.add({title:"table.row_desc",icon:"row_props",cmd:"mceTableRowProps",ui:true});g.add({title:"table.row_before_desc",icon:"row_before",cmd:"mceTableInsertRowBefore"});g.add({title:"table.row_after_desc",icon:"row_after",cmd:"mceTableInsertRowAfter"});
g.add({title:"table.delete_row_desc",icon:"delete_row",cmd:"mceTableDeleteRow"});g.addSeparator();g.add({title:"table.cut_row_desc",icon:"cut",cmd:"mceTableCutRow"});g.add({title:"table.copy_row_desc",icon:"copy",cmd:"mceTableCopyRow"});g.add({title:"table.paste_row_before_desc",icon:"paste",cmd:"mceTablePasteRowBefore"});g.add({title:"table.paste_row_after_desc",icon:"paste",cmd:"mceTablePasteRowAfter"});g=j.addMenu({title:"table.col"});g.add({title:"table.col_before_desc",icon:"col_before",cmd:"mceTableInsertColBefore"});
g.add({title:"table.col_after_desc",icon:"col_after",cmd:"mceTableInsertColAfter"});g.add({title:"table.delete_col_desc",icon:"delete_col",cmd:"mceTableDeleteCol"})}else j.add({title:"table.desc",icon:"table",cmd:"mceInsertTable",ui:true})})});b.onKeyDown.add(function(p,i){if(i.keyCode==9&&p.dom.getParent(p.selection.getNode(),"TABLE")){if(!tinymce.isGecko&&!tinymce.isOpera){tinyMCE.execInstanceCommand(p.editorId,"mceTableMoveToNextRow",true);return tinymce.dom.Event.cancel(i)}p.undoManager.add()}});
tinymce.isIE||b.getParam("table_selection",true)&&b.onClick.add(function(p,i){i=i.target;i.nodeName==="TABLE"&&p.selection.select(i)});b.onNodeChange.add(function(p,i,j){var g=p.dom.getParent(j,"td,th,caption");i.setActive("table",j.nodeName==="TABLE"||!!g);if(g&&g.nodeName==="CAPTION")g=null;i.setDisabled("delete_table",!g);i.setDisabled("delete_col",!g);i.setDisabled("delete_table",!g);i.setDisabled("delete_row",!g);i.setDisabled("col_after",!g);i.setDisabled("col_before",!g);i.setDisabled("row_after",
!g);i.setDisabled("row_before",!g);i.setDisabled("row_props",!g);i.setDisabled("cell_props",!g);i.setDisabled("split_cells",!g||parseInt(p.dom.getAttrib(g,"colspan","1"))<2&&parseInt(p.dom.getAttrib(g,"rowspan","1"))<2);i.setDisabled("merge_cells",!g)});tinymce.isIE||b.onBeforeSetContent.add(function(p,i){if(i.initial)i.content=i.content.replace(/<(td|th)([^>]+|)>\s*<\/(td|th)>/g,tinymce.isOpera?"<$1$2>&nbsp;</$1>":'<$1$2><br mce_bogus="1" /></$1>')})},execCommand:function(b,m,c){var p=this.editor;
switch(b){case "mceTableMoveToNextRow":case "mceInsertTable":case "mceTableRowProps":case "mceTableCellProps":case "mceTableSplitCells":case "mceTableMergeCells":case "mceTableInsertRowBefore":case "mceTableInsertRowAfter":case "mceTableDeleteRow":case "mceTableInsertColBefore":case "mceTableInsertColAfter":case "mceTableDeleteCol":case "mceTableCutRow":case "mceTableCopyRow":case "mceTablePasteRowBefore":case "mceTablePasteRowAfter":case "mceTableDelete":p.execCommand("mceBeginUndoLevel");this._doExecCommand(b,
m,c);p.execCommand("mceEndUndoLevel");return true}return false},getInfo:function(){return{longname:"Tables",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/table",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_doExecCommand:function(b,m,c){function p(e,d){for(var l=0;l<e.length;l++){if(e[l].length>0&&p(e[l],d))return true;if(e[l]==d)return true}return false}function i(e,d){o=A(q);e=e||0;d=d||0;e=Math.max(t.cellindex+
e,0);d=Math.max(t.rowindex+d,0);k.execCommand("mceRepaint");if(e=u(o,d,e)){k.selection.select(e.firstChild||e);k.selection.collapse(1)}}function j(e){var d=k.dom.getAttrib(e,"colspan");e=k.dom.getAttrib(e,"rowspan");d=d==""?1:parseInt(d);e=e==""?1:parseInt(e);return{colspan:d,rowspan:e}}function g(e,d){var l,r;for(r=0;r<e.length;r++)for(l=0;l<e[r].length;l++)if(e[r][l]==d)return{cellindex:l,rowindex:r};return null}function u(e,d,l){if(e[d]&&e[d][l])return e[d][l];return null}function G(e,d){var l=
[],r=0,v,y;for(v=0;v<e.rows.length;v++)for(y=0;y<e.rows[v].cells.length;y++,r++)l[r]=e.rows[v].cells[y];for(v=0;v<l.length;v++)if(l[v]==d)if(e=l[v+1])return e}function A(e){var d=[];e=e.rows;var l,r,v,y,w,z,x;for(r=0;r<e.length;r++)for(l=0;l<e[r].cells.length;l++){v=e[r].cells[l];y=j(v);for(w=l;d[r]&&d[r][w];w++);for(x=r;x<r+y.rowspan;x++){d[x]||(d[x]=[]);for(z=w;z<w+y.colspan;z++)d[x][z]=v}}return d}function J(e,d,l,r){e=A(e);var v=g(e,l),y;if(r.cells.length!=d.childNodes.length){d=d.childNodes;
y=null;for(var w=0;l=u(e,v.rowindex,w);w++){var z=j(l);if(p(d,l))r.childNodes[w]._delete=true;else if((y==null||l!=y)&&z.colspan>1)for(var x=w;x<w+l.colSpan;x++)r.childNodes[x]._delete=true;if((y==null||l!=y)&&z.rowspan>1)l.rowSpan=z.rowspan+1;y=l}K(q)}}function P(e,d){for(;(e=e.previousSibling)!=null;)if(e.nodeName==d)return e;return null}function D(e,d){for(d=d.split(",");(e=e.nextSibling)!=null;)for(var l=0;l<d.length;l++)if(e.nodeName.toLowerCase()==d[l].toLowerCase())return e;return null}function K(e){if(e.rows!=
0){var d=e.rows[0];do{e=D(d,"TR");if(d._delete)d.parentNode.removeChild(d);else{d=d.cells[0];if(d.cells>1){do{var l=D(d,"TD,TH");d._delete&&d.parentNode.removeChild(d)}while((d=l)!=null)}}}while((d=e)!=null)}}function L(e,d,l){e.rowSpan=1;d=D(d,"TR");for(var r=1;r<l&&d;r++){var v=B.createElement("td");if(!tinymce.isIE)v.innerHTML='<br mce_bogus="1"/>';tinymce.isIE?d.insertBefore(v,d.cells(e.cellIndex)):d.insertBefore(v,d.cells[e.cellIndex]);d=D(d,"TR")}}function M(e,d,l){var r=A(d),v=l.cloneNode(false),
y=g(r,l.cells[0]),w=null;k.dom.getAttrib(d,"border");d=null;for(var z=0;d=u(r,y.rowindex,z);z++){var x=null;if(w!=d)for(w=0;w<l.cells.length;w++)if(d==l.cells[w]){x=d.cloneNode(true);break}if(x==null){x=e.createElement("td");if(!tinymce.isIE)x.innerHTML='<br mce_bogus="1"/>'}x.colSpan=1;x.rowSpan=1;v.appendChild(x);w=d}return v}var k=this.editor,F=k,s=this.url,E=k.selection.getNode(),f=k.dom.getParent(E,"tr"),a=k.dom.getParent(E,"td,th"),q=k.dom.getParent(E,"table"),B=k.contentWindow.document;q&&
q.getAttribute("border");if(f&&a==null)a=f.cells[0];switch(b){case "mceTableMoveToNextRow":f=G(q,a);if(!f){k.execCommand("mceTableInsertRowAfter",a);f=G(q,a)}k.selection.select(f);k.selection.collapse(true);return true;case "mceTableRowProps":if(f==null)return true;m&&k.windowManager.open({url:s+"/row.htm",width:400+parseInt(k.getLang("table.rowprops_delta_width",0)),height:295+parseInt(k.getLang("table.rowprops_delta_height",0)),inline:1},{plugin_url:s});return true;case "mceTableCellProps":if(a==
null)return true;m&&k.windowManager.open({url:s+"/cell.htm",width:400+parseInt(k.getLang("table.cellprops_delta_width",0)),height:295+parseInt(k.getLang("table.cellprops_delta_height",0)),inline:1},{plugin_url:s});return true;case "mceInsertTable":if(m)k.windowManager.open({url:s+"/table.htm",width:400+parseInt(k.getLang("table.table_delta_width",0)),height:320+parseInt(k.getLang("table.table_delta_height",0)),inline:1},{plugin_url:s,action:c?c.action:0});return true;case "mceTableDelete":if(a=k.dom.getParent(k.selection.getNode(),
"table")){a.parentNode.removeChild(a);k.execCommand("mceRepaint")}return true;case "mceTableSplitCells":case "mceTableMergeCells":case "mceTableInsertRowBefore":case "mceTableInsertRowAfter":case "mceTableDeleteRow":case "mceTableInsertColBefore":case "mceTableInsertColAfter":case "mceTableDeleteCol":case "mceTableCutRow":case "mceTableCopyRow":case "mceTablePasteRowBefore":case "mceTablePasteRowAfter":if(!q)return true;if(f&&q!=f.parentNode)q=f.parentNode;if(q&&f){switch(b){case "mceTableCutRow":if(!f||
!a)return true;k.tableRowClipboard=M(B,q,f);k.execCommand("mceTableDeleteRow");break;case "mceTableCopyRow":if(!f||!a)return true;k.tableRowClipboard=M(B,q,f);break;case "mceTablePasteRowBefore":if(!f||!a)return true;c=k.tableRowClipboard.cloneNode(true);a=P(f,"TR");a!=null&&J(q,a,a.cells[0],c);f.parentNode.insertBefore(c,f);break;case "mceTablePasteRowAfter":if(!f||!a)return true;m=D(f,"TR");c=k.tableRowClipboard.cloneNode(true);J(q,f,a,c);m==null?f.parentNode.appendChild(c):m.parentNode.insertBefore(c,
m);break;case "mceTableInsertRowBefore":if(!f||!a)return true;var o=A(q),t=g(o,a);c=B.createElement("tr");var h=null;t.rowindex--;if(t.rowindex<0)t.rowindex=0;for(b=0;a=u(o,t.rowindex,b);b++)if(a!=h){h=j(a);if(h.rowspan==1){var n=B.createElement("td");if(!tinymce.isIE)n.innerHTML='<br mce_bogus="1"/>';n.colSpan=a.colSpan;c.appendChild(n)}else a.rowSpan=h.rowspan+1;h=a}f.parentNode.insertBefore(c,f);i(0,1);break;case "mceTableInsertRowAfter":if(!f||!a)return true;o=A(q);t=g(o,a);c=B.createElement("tr");
h=null;for(b=0;a=u(o,t.rowindex,b);b++)if(a!=h){h=j(a);if(h.rowspan==1){n=B.createElement("td");if(!tinymce.isIE)n.innerHTML='<br mce_bogus="1"/>';n.colSpan=a.colSpan;c.appendChild(n)}else a.rowSpan=h.rowspan+1;h=a}if(c.hasChildNodes())(m=D(f,"TR"))?m.parentNode.insertBefore(c,m):q.appendChild(c);i(0,1);break;case "mceTableDeleteRow":if(!f||!a)return true;o=A(q);t=g(o,a);if(o.length==1&&q.nodeName=="TBODY"){k.dom.remove(k.dom.getParent(q,"table"));return true}s=f.cells;m=D(f,"TR");for(b=0;b<s.length;b++)if(s[b].rowSpan>
1){n=s[b].cloneNode(true);h=j(s[b]);n.rowSpan=h.rowspan-1;f=m.cells[b];f==null?m.appendChild(n):m.insertBefore(n,f)}h=null;for(b=0;a=u(o,t.rowindex,b);b++)if(a!=h){h=j(a);if(h.rowspan>1)a.rowSpan=h.rowspan-1;else{f=a.parentNode;if(f.parentNode)f._delete=true}h=a}K(q);i(0,-1);break;case "mceTableInsertColBefore":if(!f||!a)return true;o=A(k.dom.getParent(q,"table"));t=g(o,a);h=null;for(c=0;a=u(o,c,t.cellindex);c++)if(a!=h){h=j(a);if(h.colspan==1){n=B.createElement(a.nodeName);if(!tinymce.isIE)n.innerHTML=
'<br mce_bogus="1"/>';n.rowSpan=a.rowSpan;a.parentNode.insertBefore(n,a)}else a.colSpan++;h=a}i();break;case "mceTableInsertColAfter":if(!f||!a)return true;o=A(k.dom.getParent(q,"table"));t=g(o,a);h=null;for(c=0;a=u(o,c,t.cellindex);c++)if(a!=h){h=j(a);if(h.colspan==1){n=B.createElement(a.nodeName);if(!tinymce.isIE)n.innerHTML='<br mce_bogus="1"/>';n.rowSpan=a.rowSpan;f=D(a,"TD,TH");f==null?a.parentNode.appendChild(n):f.parentNode.insertBefore(n,f)}else a.colSpan++;h=a}i(1);break;case "mceTableDeleteCol":if(!f||
!a)return true;o=A(q);t=g(o,a);h=null;if(o.length>1&&o[0].length<=1&&q.nodeName=="TBODY"){k.dom.remove(k.dom.getParent(q,"table"));return true}for(c=0;a=u(o,c,t.cellindex);c++)if(a!=h){h=j(a);if(h.colspan>1)a.colSpan=h.colspan-1;else a.parentNode&&a.parentNode.removeChild(a);h=a}i(-1);break;case "mceTableSplitCells":if(!f||!a)return true;c=j(a);b=c.colspan;c=c.rowspan;if(b>1||c>1){for(m=a.colSpan=1;m<b;m++){n=B.createElement("td");if(!tinymce.isIE)n.innerHTML='<br mce_bogus="1"/>';f.insertBefore(n,
D(a,"TD,TH"));c>1&&L(n,f,c)}L(a,f,c)}q=k.dom.getParent(k.selection.getNode(),"table");break;case "mceTableMergeCells":f=[];b=k.selection.getSel();o=A(q);if(tinymce.isIE||b.rangeCount==1)if(m){a=j(a);k.windowManager.open({url:s+"/merge_cells.htm",width:240+parseInt(k.getLang("table.merge_cells_delta_width",0)),height:110+parseInt(k.getLang("table.merge_cells_delta_height",0)),inline:1},{action:"update",numcols:a.colspan,numrows:a.rowspan,plugin_url:s});return true}else{h=parseInt(c.numrows);n=parseInt(c.numcols);
t=g(o,a);if(""+h=="NaN")h=1;if(""+n=="NaN")n=1;var I=q.rows;for(c=t.rowindex;c<o.length;c++){a=[];for(b=t.cellindex;b<o[c].length;b++){var C=u(o,c,b);if(C&&!p(f,C)&&!p(a,C)){s=g(o,C);if(s.cellindex<t.cellindex+n&&s.rowindex<t.rowindex+h)a[a.length]=C}}if(a.length>0)f[f.length]=a;C=u(o,t.rowindex,t.cellindex);H(F.dom.select("br",C),function(e,d){d>0&&F.dom.getAttrib("mce_bogus")&&F.dom.remove(e)})}}else{s=[];b=k.selection.getSel();a=a=null;var N=E=-1;if(b.rangeCount<2)return true;for(m=0;m<b.rangeCount;m++){a=
b.getRangeAt(m);a=a.startContainer.childNodes[a.startOffset];if(!a)break;if(a.nodeName=="TD"||a.nodeName=="TH")s[s.length]=a}I=q.rows;for(c=0;c<I.length;c++){a=[];for(b=0;b<I[c].cells.length;b++){C=I[c].cells[b];for(m=0;m<s.length;m++)if(C==s[m])a[a.length]=C}if(a.length>0)f[f.length]=a}a=[];a=null;for(c=0;c<o.length;c++)for(b=0;b<o[c].length;b++){o[c][b]._selected=false;for(m=0;m<s.length;m++)if(o[c][b]==s[m]){if(E==-1){E=b;N=c}h=b;n=c;o[c][b]._selected=true}}for(c=N;c<=n;c++)for(b=E;b<=h;b++)if(!o[c][b]._selected){alert("Invalid selection for merge.");
return true}}s=n=1;a=-1;for(c=0;c<f.length;c++){for(b=m=0;b<f[c].length;b++){h=j(f[c][b]);m+=h.colspan;if(a!=-1&&h.rowspan!=a){alert("Invalid selection for merge.");return true}a=h.rowspan}if(m>s)s=m;a=-1}a=-1;for(b=0;b<f[0].length;b++){for(c=m=0;c<f.length;c++){h=j(f[c][b]);m+=h.rowspan;if(a!=-1&&h.colspan!=a){alert("Invalid selection for merge.");return true}a=h.colspan}if(m>n)n=m;a=-1}a=f[0][0];a.rowSpan=n;a.colSpan=s;for(c=0;c<f.length;c++)for(b=0;b<f[c].length;b++){h=f[c][b].innerHTML;n=h.replace(/[ \t\r\n]/g,
"");if(n!="<br/>"&&n!="<br>"&&n!='<br mce_bogus="1"/>'&&b+c>0)a.innerHTML+=h;if(f[c][b]!=a&&!f[c][b]._deleted){t=g(o,f[c][b]);h=f[c][b].parentNode;h.removeChild(f[c][b]);f[c][b]._deleted=true;if(!h.hasChildNodes()){h.parentNode.removeChild(h);h=null;for(b=0;cellElm=u(o,t.rowindex,b);b++){cellElm!=h&&cellElm.rowSpan>1&&cellElm.rowSpan--;h=cellElm}a.rowSpan>1&&a.rowSpan--}}}H(F.dom.select("br",a),function(e,d){d>0&&F.dom.getAttrib(e,"mce_bogus")&&F.dom.remove(e)});break}q=k.dom.getParent(k.selection.getNode(),
"table");k.addVisual(q);k.nodeChanged()}return true}return false}});tinymce.PluginManager.add("table",tinymce.plugins.TablePlugin)})();
