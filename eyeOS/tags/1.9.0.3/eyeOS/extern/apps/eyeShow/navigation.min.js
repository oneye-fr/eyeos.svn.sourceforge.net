var a,SlimeyNavigation=function(b){this.slimey=b;this.slimey.editor.addEventListener("actionPerformed",this.saveCurrentSlide,this);this.container=document.createElement("div");this.container.className="slimeyNavigation";this.container.style.position="absolute";this.container.style.left="0px";this.container.style.top="59px";this.container.style.width="195px";this.container.style.cssFloat="left";this.slides=[];this.doms=[];this.divSlides=[];this.divSpacers=[];var c=unescapeSLIM(this.slimey.slimContent).split('<div class="slide">');
this.slides[0]="";for(b=1;b<c.length;b++)this.slides[b]=c[b].substr(0,c[b].lastIndexOf("</div>"));c=this.createSpacerDiv(1);this.container.appendChild(c);for(b=1;b<this.slides.length;b++){this.container.appendChild(this.createSlideDiv(b));c=this.createSpacerDiv(b+1);this.container.appendChild(c)}this.currentSlide=0;this.slides.length>1&&this.getSlide(1)};a=SlimeyNavigation.prototype;a.getContainer=function(){return this.container};
a.getSlide=function(b){if(b!=this.currentSlide){if(this.currentSlide!=0){var c=this.slimey.editor.getHTML();this.divSlides[this.currentSlide].className="slidePreview";this.divSlides[this.currentSlide].parentNode.className="slideBorder";this.slides[this.currentSlide]=c;this.doms[this.currentSlide]=document.createElement("div");this.slimey.editor.getDOM(this.doms[this.currentSlide]);this.divSlides[this.currentSlide].innerHTML=c}this.doms[b]?this.slimey.editor.setDOM(this.doms[b]):this.slimey.editor.setHTML(this.slides[b]);
this.currentSlide=b;this.divSlides[this.currentSlide].className="slidePreviewSel";this.divSlides[this.currentSlide].parentNode.className="slideBorderSel";return false}};a.saveCurrentSlide=function(){var b=this.slimey.editor.getHTML();this.slides[this.currentSlide]=b;var c=this.divSlides[this.currentSlide];if(c)c.innerHTML=b};
a.insertNewSlide=function(b,c,e){c||(c='<div style="font-size: 200%; font-weight: bold; font-family: sans-serif; position: absolute; left: 33%; top: 0%;">'+lang("some text")+"</div>");var d=this.divSpacers[b];for(i=this.divSlides.length-1;i>=b;i--){this.divSlides[i+1]=this.divSlides[i];this.divSlides[i+1].title=lang("Slide")+" "+(i+1);this.divSlides[i+1].slideNumber=i+1}for(i=this.divSpacers.length-1;i>=b;i--){this.divSpacers[i+1]=this.divSpacers[i];this.divSpacers[i+1].spacerNumber=i+1}for(i=this.slides.length-
1;i>=b;i--){this.slides[i+1]=this.slides[i];this.doms[i+1]=this.doms[i]}this.slides[b]=c;this.doms[b]=e;c=d.parentNode;e=this.createSpacerDiv(b);c.insertBefore(e,d);e=this.createSlideDiv(b);c.insertBefore(e,d);this.currentSlide>=b&&this.currentSlide++;this.getSlide(b)};
a.deleteSlide=function(b){if(b<1||b>this.slides.length)alert("No slide to delete!");else{var c=this.divSlides[b];c.parentNode.parentNode.removeChild(c.parentNode);c=this.divSpacers[b];c.parentNode.removeChild(c);for(i=b;i<this.divSlides.length-1;i++){this.divSlides[i]=this.divSlides[i+1];this.divSlides[i].slideNumber=i;this.divSlides[i].title="Slide"+i}this.divSlides.length--;for(i=b;i<this.divSpacers.length-1;i++){this.divSpacers[i]=this.divSpacers[i+1];this.divSpacers[i].spacerNumber=i}this.divSpacers.length--;
for(i=b;i<this.slides.length-1;i++){this.slides[i]=this.slides[i+1];this.doms[i]=this.doms[i+1]}this.slides.length--;this.doms.length--;this.currentSlide=0;if(b<this.slides.length&&b>0)this.getSlide(b);else this.slides.length>1?this.getSlide(this.slides.length-1):this.slimey.editor.setHTML('<h1 align="center" style="color: #999999"><i>Click "Add New" to add a slide.</i><h1>')}};
a.moveSlide=function(b,c){if(b<1||b>this.slides.length||b==c)alert("No slide to move!");else{var e=c>b?1:-1,d=this.divSlides[b],f=d.parentNode.parentNode;f.removeChild(d.parentNode);var g=this.divSpacers[b];f.removeChild(g);b<c?f.insertBefore(g,this.divSlides[c].parentNode.nextSibling):f.insertBefore(g,this.divSlides[c].parentNode.previousSibling);f.insertBefore(d.parentNode,g.nextSibling);d=this.divSlides[b];for(i=b;i!=c;i+=e){this.divSlides[i]=this.divSlides[i+e];this.divSlides[i].slideNumber=i;
this.divSlides[i].title=lang("Slide")+" "+i}this.divSlides[c]=d;d.slideNumber=c;d.title=lang("Slide")+" "+c;d=this.divSpacers[b];for(i=b;i!=c;i+=e){this.divSpacers[i]=this.divSpacers[i+e];this.divSpacers[i].spacerNumber=i}this.divSpacers[c]=d;d.spacerNumber=c;d=this.slides[b];f=this.doms[b];for(i=b;i!=c;i+=e){this.slides[i]=this.slides[i+e];this.doms[i]=this.doms[i+e]}this.slides[c]=d;this.doms[c]=f;this.currentSlide=c}};
a.getSLIMContent=function(){this.slides[this.currentSlide]=this.slimey.editor.getHTML();var b="";for(i=1;i<this.slides.length;i++)b+='<div class="slide">'+this.slides[i]+"</div>";return b};
a.createSlideDiv=function(b){var c=document.createElement("div");c.slideNumber=b;c.slimey=this.slimey;c.className="slidePreview";c.title=lang("Slide")+" "+b;c.style.position="relative";c.innerHTML=this.slides[b];setEventHandler(c,"click",function(){this.slimey.editor.performAction(new SlimeyChangeSlideAction(this.slimey,this.slideNumber))});setEventHandler(c,"mouseover",function(){this.className="slidePreviewH";this.parentNode.className="slideBorderH"});setEventHandler(c,"mouseout",function(){var d=
this.slideNumber==this.slimey.navigation.currentSlide?"Sel":"";this.className="slidePreview"+d;this.parentNode.className="slideBorder"+d});var e=document.createElement("div");e.className="slideBorder";e.appendChild(c);this.divSlides[b]=c;return e};
a.createSpacerDiv=function(b){var c=document.createElement("div");c.spacerNumber=b;c.slimey=this.slimey;c.className="previewSpacer";c.title=lang("Click to insert a new slide");setEventHandler(c,"click",function(){this.slimey.editor.performAction(new SlimeyInsertSlideAction(this.slimey,this.spacerNumber));this.className="previewSpacer"});setEventHandler(c,"mouseover",function(){this.className="previewSpacerH"});setEventHandler(c,"mouseout",function(){this.className="previewSpacer"});return this.divSpacers[b]=
c};a.addNewSlide=function(){this.slimey.editor.performAction(new SlimeyInsertSlideAction(this.slimey,this.currentSlide+1))};a.deleteCurrentSlide=function(){this.currentSlide>0&&this.slimey.editor.performAction(new SlimeyDeleteSlideAction(this.slimey,this.currentSlide))};a.moveSlideDown=function(){this.currentSlide<this.slides.length-1&&this.slimey.editor.performAction(new SlimeyMoveSlideAction(this.slimey,this.currentSlide,this.currentSlide+1))};
a.moveSlideUp=function(){this.currentSlide>1&&this.slimey.editor.performAction(new SlimeyMoveSlideAction(this.slimey,this.currentSlide,this.currentSlide-1))};
