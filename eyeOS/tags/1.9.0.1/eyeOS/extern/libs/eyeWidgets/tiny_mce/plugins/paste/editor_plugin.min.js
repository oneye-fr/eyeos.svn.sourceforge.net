(function(){var n=tinymce.each;tinymce.create("tinymce.plugins.PastePlugin",{init:function(c,e){function f(b){var a=c.dom;d.onPreProcess.dispatch(d,b);b.node=a.create("div",0,b.content);d.onPostProcess.dispatch(d,b);b.content=c.serializer.serialize(b.node,{getInner:1});/<(p|h[1-6]|ul|ol)/.test(b.content)?d._insertBlockContent(c,a,b.content):d._insert(b.content)}function i(b){var a,j,g,k=c.selection,h=c.dom;g=c.getBody();if(!h.get("_mcePaste")){a=h.add(g,"div",{id:"_mcePaste"},"\ufeff");g=g!=c.getDoc().body?
h.getPos(c.selection.getStart(),g).y:g.scrollTop;h.setStyles(a,{position:"absolute",left:-10000,top:g,width:1,height:1,overflow:"hidden"});if(tinymce.isIE){g=h.doc.body.createTextRange();g.moveToElementText(a);g.execCommand("Paste");h.remove(a);if(a.innerHTML==="\ufeff"){c.execCommand("mcePasteWord");b.preventDefault()}else{f({content:a.innerHTML});return tinymce.dom.Event.cancel(b)}}else{j=c.selection.getRng();a=a.firstChild;g=c.getDoc().createRange();g.setStart(a,0);g.setEnd(a,1);k.setRng(g);window.setTimeout(function(){var l=
"",m=h.select("div[id=_mcePaste]");n(m,function(o){l+=(h.select("> span.Apple-style-span div",o)[0]||h.select("> span.Apple-style-span",o)[0]||o).innerHTML});n(m,function(o){h.remove(o)});j&&k.setRng(j);f({content:l})},0)}}}var d=this;d.editor=c;d.url=e;d.onPreProcess=new tinymce.util.Dispatcher(d);d.onPostProcess=new tinymce.util.Dispatcher(d);d.onPreProcess.add(d._preProcess);d.onPostProcess.add(d._postProcess);d.onPreProcess.add(function(b,a){c.execCallback("paste_preprocess",b,a)});d.onPostProcess.add(function(b,
a){c.execCallback("paste_postprocess",b,a)});c.addCommand("mceInsertClipboardContent",function(b,a){f(a)});if(c.getParam("paste_auto_cleanup_on_paste",true))tinymce.isOpera||/Firefox\/2/.test(navigator.userAgent)?c.onKeyDown.add(function(b,a){if((tinymce.isMac?a.metaKey:a.ctrlKey)&&a.keyCode==86||a.shiftKey&&a.keyCode==45)i(a)}):c.onPaste.addToTop(function(b,a){return i(a)});c.getParam("paste_block_drop")&&c.onInit.add(function(){c.dom.bind(c.getBody(),["dragend","dragover","draggesture","dragdrop",
"drop","drag"],function(b){b.preventDefault();b.stopPropagation();return false})});d._legacySupport()},getInfo:function(){return{longname:"Paste text/word",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/paste",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_preProcess:function(c,e){function f(a){n(a,function(j){i=j.constructor==RegExp?i.replace(j,""):i.replace(j[0],j[1])})}c=this.editor;var i=e.content,d;
if(/(class=\"?Mso|style=\"[^\"]*\bmso\-|w:WordDocument)/.test(i)||e.wordContent){e.wordContent=true;f([/^\s*(&nbsp;)+/g,/(&nbsp;|<br[^>]*>)+\s*$/g]);c.getParam("paste_convert_middot_lists",true)&&f([[/<!--\[if !supportLists\]--\>/gi,"$&__MCE_ITEM__"],[/(<span[^>]+:\s*symbol[^>]+>)/gi,"$1__MCE_ITEM__"],[/(<span[^>]+mso-list:[^>]+>)/gi,"$1__MCE_ITEM__"]]);f([/<!--[\s\S]+?--\>/gi,/<\/?(img|font|meta|link|style|div|v:\w+)[^>]*>/gi,/<\\?\?xml[^>]*>/gi,/<\/?o:[^>]*>/gi,/ (id|name|language|type|on\w+|v:\w+)=\"([^\"]*)\"/gi,
/ (id|name|language|type|on\w+|v:\w+)=(\w+)/gi,[/<(\/?)s>/gi,"<$1strike>"],/<script[^>]+>[\s\S]*?<\/script>/gi,[/&nbsp;/g,"\u00a0"]]);c.getParam("paste_retain_style_properties")||f([/<\/?(span)[^>]*>/gi])}d=c.getParam("paste_strip_class_attributes");if(d!="none"){function b(a,j){var g="";if(d=="all")return"";j=tinymce.explode(j," ");for(a=j.length-1;a>=0;a--)/^(Mso)/i.test(j[a])||(g+=(!g?"":" ")+j[a]);return' class="'+g+'"'}f([[/ class=\"([^\"]*)\"/gi,b],[/ class=(\w+)/gi,b]])}c.getParam("paste_remove_spans")&&
f([/<\/?(span)[^>]*>/gi]);e.content=i},_postProcess:function(c,e){var f=this,i=f.editor,d=i.dom,b;if(e.wordContent){n(d.select("a",e.node),function(a){if(!a.href||a.href.indexOf("#_Toc")!=-1)d.remove(a,1)});f.editor.getParam("paste_convert_middot_lists",true)&&f._convertLists(c,e);b=i.getParam("paste_retain_style_properties");if(tinymce.is(b,"string"))b=tinymce.explode(b);n(d.select("*",e.node),function(a){var j={},g=0,k,h,l;if(b)for(k=0;k<b.length;k++){h=b[k];if(l=d.getStyle(a,h)){j[h]=l;g++}}d.setAttrib(a,
"style","");if(b&&g>0)d.setStyles(a,j);else a.nodeName=="SPAN"&&!a.className&&d.remove(a,true)})}if(i.getParam("paste_remove_styles")||i.getParam("paste_remove_styles_if_webkit")&&tinymce.isWebKit)n(d.select("*[style]",e.node),function(a){a.removeAttribute("style");a.removeAttribute("mce_style")});else tinymce.isWebKit&&n(d.select("*",e.node),function(a){a.removeAttribute("mce_style")})},_convertLists:function(c,e){var f=c.editor.dom,i,d,b=-1,a,j=[],g;n(f.select("p",e.node),function(k){var h,l="",
m;for(h=k.firstChild;h&&h.nodeType==3;h=h.nextSibling)l+=h.nodeValue;l=k.innerHTML.replace(/<\/?\w+[^>]*>/gi,"").replace(/&nbsp;/g,"\u00a0");if(/^(__MCE_ITEM__)+[\u2022\u00b7\u00a7\u00d8o]\s*\u00a0*/.test(l))m="ul";if(/^__MCE_ITEM__\s*\w+\.\s*\u00a0{2,}/.test(l))m="ol";if(m){a=parseFloat(k.style.marginLeft||0);a>b&&j.push(a);if(!i||m!=g){i=f.create(m);f.insertAfter(i,k)}else if(a>b)i=d.appendChild(f.create(m));else if(a<b){h=tinymce.inArray(j,a);l=f.getParents(i.parentNode,m);i=l[l.length-1-h]||i}n(f.select("span",
k),function(o){var p=o.innerHTML.replace(/<\/?\w+[^>]*>/gi,"");if(m=="ul"&&/^[\u2022\u00b7\u00a7\u00d8o]/.test(p))f.remove(o);else/^[\s\S]*\w+\.(&nbsp;|\u00a0)*\s*/.test(p)&&f.remove(o)});h=k.innerHTML;h=m=="ul"?k.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^[\u2022\u00b7\u00a7\u00d8o]\s*(&nbsp;|\u00a0)+\s*/,""):k.innerHTML.replace(/__MCE_ITEM__/g,"").replace(/^\s*\w+\.(&nbsp;|\u00a0)+\s*/,"");d=i.appendChild(f.create("li",0,h));f.remove(k);b=a;g=m}else i=b=0});c=e.node.innerHTML;if(c.indexOf("__MCE_ITEM__")!=
-1)e.node.innerHTML=c.replace(/__MCE_ITEM__/g,"")},_insertBlockContent:function(c,e,f){function i(g){var k;if(tinymce.isIE){k=c.getDoc().body.createTextRange();k.moveToElementText(g);k.collapse(false);k.select()}else{a.select(g,1);a.collapse(false)}}var d,b,a=c.selection,j;this._insert('<span id="_marker">&nbsp;</span>',1);b=e.get("_marker");if((d=e.getParent(b,"p,h1,h2,h3,h4,h5,h6,ul,ol,th,td"))&&!/TD|TH/.test(d.nodeName)){b=e.split(d,b);n(e.create("div",0,f).childNodes,function(g){j=b.parentNode.insertBefore(g.cloneNode(true),
b)});i(j)}else{e.setOuterHTML(b,f);a.select(c.getBody(),1);a.collapse(0)}e.remove("_marker");f=a.getStart();e=e.getViewPort(c.getWin());d=c.dom.getPos(f).y;f=f.clientHeight;if(d<e.y||d+f>e.y+e.h)c.getDoc().body.scrollTop=d<e.y?d:d-e.h+25},_insert:function(c,e){var f=this.editor;f.selection.isCollapsed()||f.getDoc().execCommand("Delete",false,null);f.execCommand(tinymce.isGecko?"insertHTML":"mceInsertContent",false,c,{skip_undo:e})},_legacySupport:function(){var c=this,e=c.editor;n(["mcePasteText",
"mcePasteWord"],function(f){e.addCommand(f,function(){e.windowManager.open({file:c.url+(f=="mcePasteText"?"/pastetext.htm":"/pasteword.htm"),width:parseInt(e.getParam("paste_dialog_width","450")),height:parseInt(e.getParam("paste_dialog_height","400")),inline:1})})});e.addButton("pastetext",{title:"paste.paste_text_desc",cmd:"mcePasteText"});e.addButton("pasteword",{title:"paste.paste_word_desc",cmd:"mcePasteWord"});e.addButton("selectall",{title:"paste.selectall_desc",cmd:"selectall"})}});tinymce.PluginManager.add("paste",
tinymce.plugins.PastePlugin)})();
