(function(){var k=tinymce.each;tinymce.create("tinymce.plugins.MediaPlugin",{init:function(b,f){function d(e){return/^(mceItemFlash|mceItemShockWave|mceItemWindowsMedia|mceItemQuickTime|mceItemRealMedia)$/.test(e.className)}function c(e,g){return(g=(new RegExp(g+'="([^"]+)"',"g")).exec(e))?b.dom.decode(g[1]):""}var a=this;a.editor=b;a.url=f;b.onPreInit.add(function(){b.serializer.addRules("param[name|value|_mce_value]")});b.addCommand("mceMedia",function(){b.windowManager.open({file:f+"/media.htm",
width:430+parseInt(b.getLang("media.delta_width",0)),height:470+parseInt(b.getLang("media.delta_height",0)),inline:1},{plugin_url:f})});b.addButton("media",{title:"media.desc",cmd:"mceMedia"});b.onNodeChange.add(function(e,g,h){g.setActive("media",h.nodeName=="IMG"&&d(h))});b.onInit.add(function(){var e={mceItemFlash:"flash",mceItemShockWave:"shockwave",mceItemWindowsMedia:"windowsmedia",mceItemQuickTime:"quicktime",mceItemRealMedia:"realmedia"};b.selection.onSetContent.add(function(){a._spansToImgs(b.getBody())});
b.selection.onBeforeSetContent.add(a._objectsToSpans,a);b.settings.content_css!==false&&b.dom.loadCSS(f+"/css/content.css");b.theme&&b.theme.onResolveName&&b.theme.onResolveName.add(function(g,h){h.name=="img"&&k(e,function(i,j){if(b.dom.hasClass(h.node,j)){h.name=i;h.title=b.dom.getAttrib(h.node,"title");return false}})});b&&b.plugins.contextmenu&&b.plugins.contextmenu.onContextMenu.add(function(g,h,i){i.nodeName=="IMG"&&/mceItem(Flash|ShockWave|WindowsMedia|QuickTime|RealMedia)/.test(i.className)&&
h.add({title:"media.edit",icon:"media",cmd:"mceMedia"})})});b.onBeforeSetContent.add(a._objectsToSpans,a);b.onSetContent.add(function(){a._spansToImgs(b.getBody())});b.onPreProcess.add(function(e,g){var h=e.dom;if(g.set){a._spansToImgs(g.node);k(h.select("IMG",g.node),function(i){var j;if(d(i)){j=a._parse(i.title);h.setAttrib(i,"width",h.getAttrib(i,"width",j.width||100));h.setAttrib(i,"height",h.getAttrib(i,"height",j.height||100))}})}g.get&&k(h.select("IMG",g.node),function(i){var j,l,m;if(e.getParam("media_use_script")){if(d(i))i.className=
i.className.replace(/mceItem/g,"mceTemp")}else{switch(i.className){case "mceItemFlash":j="d27cdb6e-ae6d-11cf-96b8-444553540000";l="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0";m="application/x-shockwave-flash";break;case "mceItemShockWave":j="166b1bca-3f9c-11cf-8075-444553540000";l="http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0";m="application/x-director";break;case "mceItemWindowsMedia":j=e.getParam("media_wmp6_compatible")?
"05589fa1-c356-11ce-bf01-00aa0055595a":"6bf52a52-394a-11d3-b153-00c04f79faa6";l="http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701";m="application/x-mplayer2";break;case "mceItemQuickTime":j="02bf25d5-8c17-4b23-bc80-d3488abddc6b";l="http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0";m="video/quicktime";break;case "mceItemRealMedia":j="cfcdaa03-8be4-11cf-b84b-0020afbbccfa";l="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0";
m="audio/x-pn-realaudio-plugin";break}j&&h.replace(a._buildObj({classid:j,codebase:l,type:m},i),i)}})});b.onPostProcess.add(function(e,g){g.content=g.content.replace(/_mce_value=/g,"value=")});b.onPostProcess.add(function(e,g){if(e.getParam("media_use_script"))g.content=g.content.replace(/<img[^>]+>/g,function(h){var i=c(h,"class");if(/^(mceTempFlash|mceTempShockWave|mceTempWindowsMedia|mceTempQuickTime|mceTempRealMedia)$/.test(i)){at=a._parse(c(h,"title"));at.width=c(h,"width");at.height=c(h,"height");
h='<script type="text/javascript">write'+i.substring(7)+"({"+a._serialize(at)+"});<\/script>"}return h})})},getInfo:function(){return{longname:"Media",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/media",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_objectsToSpans:function(b,f){var d=this,c=f.content;c=c.replace(/<script[^>]*>\s*write(Flash|ShockWave|WindowsMedia|QuickTime|RealMedia)\(\{([^\)]*)\}\);\s*<\/script>/gi,
function(a,e,g){a=d._parse(g);return'<img class="mceItem'+e+'" title="'+b.dom.encode(g)+'" src="'+d.url+'/img/trans.gif" width="'+a.width+'" height="'+a.height+'" />'});c=c.replace(/<object([^>]*)>/gi,'<span class="mceItemObject" $1>');c=c.replace(/<embed([^>]*)\/?>/gi,'<span class="mceItemEmbed" $1></span>');c=c.replace(/<embed([^>]*)>/gi,'<span class="mceItemEmbed" $1>');c=c.replace(/<\/(object)([^>]*)>/gi,"</span>");c=c.replace(/<\/embed>/gi,"");c=c.replace(/<param([^>]*)>/gi,function(a,e){return"<span "+
e.replace(/value=/gi,"_mce_value=")+' class="mceItemParam"></span>'});c=c.replace(/\/ class=\"mceItemParam\"><\/span>/gi,'class="mceItemParam"></span>');f.content=c},_buildObj:function(b,f){var d,c=this.editor,a=c.dom,e=this._parse(f.title),g;g=c.getParam("media_strict",true)&&b.type=="application/x-shockwave-flash";e.width=b.width=a.getAttrib(f,"width")||100;e.height=b.height=a.getAttrib(f,"height")||100;if(e.src)e.src=c.convertURL(e.src,"src",f);d=g?a.create("span",{id:e.id,mce_name:"object",type:"application/x-shockwave-flash",
data:e.src,style:a.getAttrib(f,"style"),width:b.width,height:b.height}):a.create("span",{id:e.id,mce_name:"object",classid:"clsid:"+b.classid,style:a.getAttrib(f,"style"),codebase:b.codebase,width:b.width,height:b.height});k(e,function(h,i){if(!/^(width|height|codebase|classid|id|_cx|_cy)$/.test(i)){if(b.type=="application/x-mplayer2"&&i=="src"&&!e.url)i="url";h&&a.add(d,"span",{mce_name:"param",name:i,_mce_value:h})}});g||a.add(d,"span",tinymce.extend({mce_name:"embed",type:b.type,style:a.getAttrib(f,
"style")},e));return d},_spansToImgs:function(b){var f=this,d=f.editor.dom,c;k(d.select("span",b),function(a){if(d.getAttrib(a,"class")=="mceItemObject"){c=d.getAttrib(a,"classid").toLowerCase().replace(/\s+/g,"");switch(c){case "clsid:d27cdb6e-ae6d-11cf-96b8-444553540000":d.replace(f._createImg("mceItemFlash",a),a);break;case "clsid:166b1bca-3f9c-11cf-8075-444553540000":d.replace(f._createImg("mceItemShockWave",a),a);break;case "clsid:6bf52a52-394a-11d3-b153-00c04f79faa6":case "clsid:22d6f312-b0f6-11d0-94ab-0080c74c7e95":case "clsid:05589fa1-c356-11ce-bf01-00aa0055595a":d.replace(f._createImg("mceItemWindowsMedia",
a),a);break;case "clsid:02bf25d5-8c17-4b23-bc80-d3488abddc6b":d.replace(f._createImg("mceItemQuickTime",a),a);break;case "clsid:cfcdaa03-8be4-11cf-b84b-0020afbbccfa":d.replace(f._createImg("mceItemRealMedia",a),a);break;default:d.replace(f._createImg("mceItemFlash",a),a)}}else if(d.getAttrib(a,"class")=="mceItemEmbed")switch(d.getAttrib(a,"type")){case "application/x-shockwave-flash":d.replace(f._createImg("mceItemFlash",a),a);break;case "application/x-director":d.replace(f._createImg("mceItemShockWave",
a),a);break;case "application/x-mplayer2":d.replace(f._createImg("mceItemWindowsMedia",a),a);break;case "video/quicktime":d.replace(f._createImg("mceItemQuickTime",a),a);break;case "audio/x-pn-realaudio-plugin":d.replace(f._createImg("mceItemRealMedia",a),a);break;default:d.replace(f._createImg("mceItemFlash",a),a)}})},_createImg:function(b,f){var d=this.editor.dom,c={},a;a=["id","name","width","height","bgcolor","align","flashvars","src","wmode","allowfullscreen","quality","data"];b=d.create("img",
{src:this.url+"/img/trans.gif",width:d.getAttrib(f,"width")||100,height:d.getAttrib(f,"height")||100,style:d.getAttrib(f,"style"),"class":b});k(a,function(e){var g=d.getAttrib(f,e);if(g)c[e]=g});k(d.select("span",f),function(e){if(d.hasClass(e,"mceItemParam"))c[d.getAttrib(e,"name")]=d.getAttrib(e,"_mce_value")});if(c.movie){c.src=c.movie;delete c.movie}if(!c.src){c.src=c.data;delete c.data}(f=d.select(".mceItemEmbed",f)[0])&&k(a,function(e){var g=d.getAttrib(f,e);if(g&&!c[e])c[e]=g});delete c.width;
delete c.height;b.title=this._serialize(c);return b},_parse:function(b){return tinymce.util.JSON.parse("{"+b+"}")},_serialize:function(b){return tinymce.util.JSON.serialize(b).replace(/[{}]/g,"")}});tinymce.PluginManager.add("media",tinymce.plugins.MediaPlugin)})();
