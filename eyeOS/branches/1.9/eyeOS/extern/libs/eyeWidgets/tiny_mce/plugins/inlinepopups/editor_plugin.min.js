(function(){var a=tinymce.DOM,b=tinymce.dom.Element,c=tinymce.dom.Event,d=tinymce.each,e=tinymce.is;tinymce.create("tinymce.plugins.InlinePopups",{init:function(b){b.onBeforeRenderUI.add(function(){b.windowManager=new tinymce.InlineWindowManager(b),a.loadCSS("index.php?theme=1&extern=css/tiny_mce/inlinepopup.css")})},getInfo:function(){return{longname:"InlinePopups",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/inlinepopups",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.create("tinymce.InlineWindowManager:tinymce.WindowManager",{InlineWindowManager:function(a){var b=this;b.parent(a),b.zIndex=3e5,b.count=0,b.windows={}},open:function(d,e){var f,g,h,i,j,k,l,m=this,n="",o=m.editor,p=0,q=0;return d=d||{},e=e||{},d.inline?(l=m._frontWindow(),l&&a.get(l.id+"_ifr")&&(l.focussedElement=a.get(l.id+"_ifr").contentWindow.document.activeElement),d.type||(m.bookmark=o.selection.getBookmark(1)),f=a.uniqueId(),g=a.getViewPort(),d.width=parseInt(d.width||320),d.height=parseInt(d.height||240)+(tinymce.isIE?8:0),d.min_width=parseInt(d.min_width||150),d.min_height=parseInt(d.min_height||100),d.max_width=parseInt(d.max_width||2e3),d.max_height=parseInt(d.max_height||2e3),d.left=d.left||Math.round(Math.max(g.x,g.x+g.w/2-d.width/2)),d.top=d.top||Math.round(Math.max(g.y,g.y+g.h/2-d.height/2)),d.movable=d.resizable=!0,e.mce_width=d.width,e.mce_height=d.height,e.mce_inline=!0,e.mce_window_id=f,e.mce_auto_focus=d.auto_focus,m.features=d,m.params=e,m.onOpen.dispatch(m,d,e),d.type&&(n+=" mceModal",d.type&&(n+=" mce"+d.type.substring(0,1).toUpperCase()+d.type.substring(1)),d.resizable=!1),d.statusbar&&(n+=" mceStatusbar"),d.resizable&&(n+=" mceResizable"),d.minimizable&&(n+=" mceMinimizable"),d.maximizable&&(n+=" mceMaximizable"),d.movable&&(n+=" mceMovable"),m._addAll(a.doc.body,["div",{id:f,role:"dialog","aria-labelledby":d.type?f+"_content":f+"_title","class":(o.settings.inlinepopups_skin||"clearlooks2")+(tinymce.isIE&&window.getSelection?" ie9":""),style:"width:100px;height:100px"},["div",{id:f+"_wrapper","class":"mceWrapper"+n},["div",{id:f+"_top","class":"mceTop"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:f+"_title"},d.title||""]],["div",{id:f+"_middle","class":"mceMiddle"},["div",{id:f+"_left","class":"mceLeft",tabindex:"0"}],["span",{id:f+"_content"}],["div",{id:f+"_right","class":"mceRight",tabindex:"0"}]],["div",{id:f+"_bottom","class":"mceBottom"},["div",{"class":"mceLeft"}],["div",{"class":"mceCenter"}],["div",{"class":"mceRight"}],["span",{id:f+"_status"},"Content"]],["a",{"class":"mceMove",tabindex:"-1",href:"javascript:;"}],["a",{"class":"mceMin",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMax",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceMed",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{"class":"mceClose",tabindex:"-1",href:"javascript:;",onmousedown:"return false;"}],["a",{id:f+"_resize_n","class":"mceResize mceResizeN",tabindex:"-1",href:"javascript:;"}],["a",{id:f+"_resize_s","class":"mceResize mceResizeS",tabindex:"-1",href:"javascript:;"}],["a",{id:f+"_resize_w","class":"mceResize mceResizeW",tabindex:"-1",href:"javascript:;"}],["a",{id:f+"_resize_e","class":"mceResize mceResizeE",tabindex:"-1",href:"javascript:;"}],["a",{id:f+"_resize_nw","class":"mceResize mceResizeNW",tabindex:"-1",href:"javascript:;"}],["a",{id:f+"_resize_ne","class":"mceResize mceResizeNE",tabindex:"-1",href:"javascript:;"}],["a",{id:f+"_resize_sw","class":"mceResize mceResizeSW",tabindex:"-1",href:"javascript:;"}],["a",{id:f+"_resize_se","class":"mceResize mceResizeSE",tabindex:"-1",href:"javascript:;"}]]]),a.setStyles(f,{top:-1e4,left:-1e4}),tinymce.isGecko&&a.setStyle(f,"overflow","auto"),d.type||(p+=a.get(f+"_left").clientWidth,p+=a.get(f+"_right").clientWidth,q+=a.get(f+"_top").clientHeight,q+=a.get(f+"_bottom").clientHeight),a.setStyles(f,{top:d.top,left:d.left,width:d.width+p,height:d.height+q}),k=d.url||d.file,k&&(tinymce.relaxedDomain&&(k+=(k.indexOf("?")==-1?"?":"&")+"mce_rdomain="+tinymce.relaxedDomain),k=tinymce._addVer(k)),d.type?(a.add(f+"_wrapper","a",{id:f+"_ok","class":"mceButton mceOk",href:"javascript:;",onmousedown:"return false;"},"Ok"),d.type=="confirm"&&a.add(f+"_wrapper","a",{"class":"mceButton mceCancel",href:"javascript:;",onmousedown:"return false;"},"Cancel"),a.add(f+"_middle","div",{"class":"mceIcon"}),a.setHTML(f+"_content",d.content.replace("\n","<br />")),c.add(f,"keyup",function(a){var b=27;if(a.keyCode===b)return d.button_func(!1),c.cancel(a)}),c.add(f,"keydown",function(b){var d,e=9;if(b.keyCode===e)return d=a.select("a.mceCancel",f+"_wrapper")[0],d&&d!==b.target?d.focus():a.get(f+"_ok").focus(),c.cancel(b)})):(a.add(f+"_content","iframe",{id:f+"_ifr",src:'javascript:""',frameBorder:0,style:"border:0;width:10px;height:10px"}),a.setStyles(f+"_ifr",{width:d.width,height:d.height}),a.setAttrib(f+"_ifr","src",k)),h=c.add(f,"mousedown",function(b){var d,e=b.target,g=m.windows[f];m.focus(f);if(e.nodeName=="A"||e.nodeName=="a"){if(e.className=="mceClose")return m.close(null,f),c.cancel(b);if(e.className=="mceMax")g.oldPos=g.element.getXY(),g.oldSize=g.element.getSize(),d=a.getViewPort(),d.w-=2,d.h-=2,g.element.moveTo(d.x,d.y),g.element.resizeTo(d.w,d.h),a.setStyles(f+"_ifr",{width:d.w-g.deltaWidth,height:d.h-g.deltaHeight}),a.addClass(f+"_wrapper","mceMaximized");else if(e.className=="mceMed")g.element.moveTo(g.oldPos.x,g.oldPos.y),g.element.resizeTo(g.oldSize.w,g.oldSize.h),g.iframeElement.resizeTo(g.oldSize.w-g.deltaWidth,g.oldSize.h-g.deltaHeight),a.removeClass(f+"_wrapper","mceMaximized");else{if(e.className=="mceMove")return m._startDrag(f,b,e.className);if(a.hasClass(e,"mceResize"))return m._startDrag(f,b,e.className.substring(13))}}}),i=c.add(f,"click",function(a){var b=a.target;m.focus(f);if(b.nodeName=="A"||b.nodeName=="a")switch(b.className){case"mceClose":return m.close(null,f),c.cancel(a);case"mceButton mceOk":case"mceButton mceCancel":return d.button_func(b.className=="mceButton mceOk"),c.cancel(a)}}),c.add([f+"_left",f+"_right"],"focus",function(b){var c,d,e=a.get(f+"_ifr");e?(c=e.contentWindow.document.body,d=a.select(":input:enabled,*[tabindex=0]",c),b.target.id===f+"_left"?d[d.length-1].focus():d[0].focus()):a.get(f+"_ok").focus()}),j=m.windows[f]={id:f,mousedown_func:h,click_func:i,element:new b(f,{blocker:1,container:o.getContainer()}),iframeElement:new b(f+"_ifr"),features:d,deltaWidth:p,deltaHeight:q},j.iframeElement.on("focus",function(){m.focus(f)}),m.count==0&&m.editor.getParam("dialog_type","modal")=="modal"?(a.add(a.doc.body,"div",{id:"mceModalBlocker","class":(m.editor.settings.inlinepopups_skin||"clearlooks2")+"_modalBlocker",style:{zIndex:m.zIndex-1}}),a.show("mceModalBlocker"),a.setAttrib(a.doc.body,"aria-hidden","true")):a.setStyle("mceModalBlocker","z-index",m.zIndex-1),(tinymce.isIE6||/Firefox\/2\./.test(navigator.userAgent)||tinymce.isIE&&!a.boxModel)&&a.setStyles("mceModalBlocker",{position:"absolute",left:g.x,top:g.y,width:g.w-2,height:g.h-2}),a.setAttrib(f,"aria-hidden","false"),m.focus(f),m._fixIELayout(f,1),a.get(f+"_ok")&&a.get(f+"_ok").focus(),m.count++,j):m.parent(d,e)},focus:function(b){var c,d=this;if(c=d.windows[b])c.zIndex=this.zIndex++,c.element.setStyle("zIndex",c.zIndex),c.element.update(),b+="_wrapper",a.removeClass(d.lastId,"mceFocus"),a.addClass(b,"mceFocus"),d.lastId=b,c.focussedElement?c.focussedElement.focus():a.get(b+"_ok")?a.get(c.id+"_ok").focus():a.get(c.id+"_ifr")&&a.get(c.id+"_ifr").focus()},_addAll:function(a,b){var c,d=this,f=tinymce.DOM;if(e(b,"string"))a.appendChild(f.doc.createTextNode(b));else if(b.length){a=a.appendChild(f.create(b[0],b[1]));for(c=2;c<b.length;c++)d._addAll(a,b[c])}},_startDrag:function(d,e,f){function B(){if(i)return;u._fixIELayout(d,0),a.add(v.body,"div",{id:"mceEventBlocker","class":"mceEventBlocker "+(u.editor.settings.inlinepopups_skin||"clearlooks2"),style:{zIndex:u.zIndex+1}}),(tinymce.isIE6||tinymce.isIE&&!a.boxModel)&&a.setStyles("mceEventBlocker",{position:"absolute",left:A.x,top:A.y,width:A.w-2,height:A.h-2}),i=new b("mceEventBlocker"),i.update(),j=x.getXY(),k=x.getSize(),m=z.x+j.x-A.x,n=z.y+j.y-A.y,a.add(i.get(),"div",{id:"mcePlaceHolder","class":"mcePlaceHolder",style:{left:m,top:n,width:k.w,height:k.h}}),l=new b("mcePlaceHolder")}var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=this,v=a.doc,w=u.windows[d],x=w.element,y=x.getXY(),z={x:0,y:0},A=a.getViewPort();return A.w-=2,A.h-=2,o=e.screenX,p=e.screenY,q=r=s=t=0,g=c.add(v,"mouseup",function(b){return c.remove(v,"mouseup",g),c.remove(v,"mousemove",h),i&&i.remove(),x.moveBy(q,r),x.resizeBy(s,t),k=x.getSize(),a.setStyles(d+"_ifr",{width:k.w-w.deltaWidth,height:k.h-w.deltaHeight}),u._fixIELayout(d,1),c.cancel(b)}),f!="Move"&&B(),h=c.add(v,"mousemove",function(a){var b,d,e;B(),b=a.screenX-o,d=a.screenY-p;switch(f){case"ResizeW":q=b,s=0-b;break;case"ResizeE":s=b;break;case"ResizeN":case"ResizeNW":case"ResizeNE":f=="ResizeNW"?(q=b,s=0-b):f=="ResizeNE"&&(s=b),r=d,t=0-d;break;case"ResizeS":case"ResizeSW":case"ResizeSE":f=="ResizeSW"?(q=b,s=0-b):f=="ResizeSE"&&(s=b),t=d;break;case"mceMove":q=b,r=d}return s<(e=w.features.min_width-k.w)&&(q!==0&&(q+=s-e),s=e),t<(e=w.features.min_height-k.h)&&(r!==0&&(r+=t-e),t=e),s=Math.min(s,w.features.max_width-k.w),t=Math.min(t,w.features.max_height-k.h),q=Math.max(q,A.x-(m+A.x)),r=Math.max(r,A.y-(n+A.y)),q=Math.min(q,A.w+A.x-(m+k.w+A.x)),r=Math.min(r,A.h+A.y-(n+k.h+A.y)),q+r!==0&&(m+q<0&&(q=0),n+r<0&&(r=0),l.moveTo(m+q,n+r)),s+t!==0&&l.resizeTo(k.w+s,k.h+t),c.cancel(a)}),c.cancel(e)},resizeBy:function(a,b,c){var d=this.windows[c];d&&(d.element.resizeBy(a,b),d.iframeElement.resizeBy(a,b))},close:function(b,d){var e,f,g=this,h=a.doc,d=g._findId(d||b);if(!g.windows[d]){g.parent(b);return}g.count--,g.count==0&&(a.remove("mceModalBlocker"),a.setAttrib(a.doc.body,"aria-hidden","false"),g.editor.focus());if(e=g.windows[d])g.onClose.dispatch(g),c.remove(h,"mousedown",e.mousedownFunc),c.remove(h,"click",e.clickFunc),c.clear(d),c.clear(d+"_ifr"),a.setAttrib(d+"_ifr","src",'javascript:""'),e.element.remove(),delete g.windows[d],f=g._frontWindow(),f&&g.focus(f.id)},_frontWindow:function(){var a,b=0;return d(this.windows,function(c){c.zIndex>b&&(a=c,b=c.zIndex)}),a},setTitle:function(b,c){var d;b=this._findId(b);if(d=a.get(b+"_title"))d.innerHTML=a.encode(c)},alert:function(b,c){var d=this,e=d.open({title:d,type:"alert",button_func:function(a){c&&c.call(a||d,a),d.close(null,e.id)},content:a.encode(d.editor.getLang(b,b)),inline:1,width:400,height:130})},confirm:function(b,c){var d=this,e=d.open({title:d,type:"confirm",button_func:function(a){c&&c.call(a||d,a),d.close(null,e.id)},content:a.encode(d.editor.getLang(b,b)),inline:1,width:400,height:130})},_findId:function(b){var c=this;return typeof b=="string"?b:(d(c.windows,function(c){var d=a.get(c.id+"_ifr");if(d&&b==d.contentWindow)return b=c.id,!1}),b)},_fixIELayout:function(b,c){var e,f;if(!tinymce.isIE6)return;d(["n","s","w","e","nw","ne","sw","se"],function(d){var e=a.get(b+"_resize_"+d);a.setStyles(e,{width:c?e.clientWidth:"",height:c?e.clientHeight:"",cursor:a.getStyle(e,"cursor",1)}),a.setStyle(b+"_bottom","bottom","-1px"),e=0});if(e=this.windows[b])e.element.hide(),e.element.show(),d(a.select("div,a",b),function(a){a.currentStyle.backgroundImage!="none"&&(f=new Image,f.src=a.currentStyle.backgroundImage.replace(/url\(\"(.+)\"\)/,"$1"))}),a.get(b).style.filter=""}}),tinymce.PluginManager.add("inlinepopups",tinymce.plugins.InlinePopups)})();