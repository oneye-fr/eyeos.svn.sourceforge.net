(function(){function b(a){return document.getElementById(a)}function c(a){var b,d,e,f;if(null==a||"object"!=typeof a)return a;if("length"in a){e=[];for(b=0,d=a.length;b<d;++b)e[b]=c(a[b]);return e}e={};for(f in a)a.hasOwnProperty(f)&&(e[f]=c(a[f]));return e}function d(a){var c=b(a);return c.nodeName=="SELECT"?c.options[c.selectedIndex].value:c.type=="checkbox"?c.checked:c.value}function e(a,c,d){var e;typeof c!="undefined"&&c!=null&&(e=b(a),e.nodeName=="SELECT"?selectByValue(document.forms[0],a,c):e.type=="checkbox"?(typeof c=="string"&&(c=c.toLowerCase(),c=!d&&c==="true"||d&&c===d.toLowerCase()),e.checked=!!c):e.value=c)}var a;(a=tinyMCEPopup.getParam("media_external_list_url"))&&document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(a)+'"></script>'),window.Media={init:function(){var a,d,e=this;e.editor=d=tinyMCEPopup.editor,b("filebrowsercontainer").innerHTML=getBrowserHTML("filebrowser","src","media","media"),b("qtsrcfilebrowsercontainer").innerHTML=getBrowserHTML("qtsrcfilebrowser","quicktime_qtsrc","media","media"),b("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor"),b("video_altsource1_filebrowser").innerHTML=getBrowserHTML("video_filebrowser_altsource1","video_altsource1","media","media"),b("video_altsource2_filebrowser").innerHTML=getBrowserHTML("video_filebrowser_altsource2","video_altsource2","media","media"),b("audio_altsource1_filebrowser").innerHTML=getBrowserHTML("audio_filebrowser_altsource1","audio_altsource1","media","media"),b("audio_altsource2_filebrowser").innerHTML=getBrowserHTML("audio_filebrowser_altsource2","audio_altsource2","media","media"),b("video_poster_filebrowser").innerHTML=getBrowserHTML("filebrowser_poster","video_poster","media","image"),a=e.getMediaListHTML("medialist","src","media","media"),a==""?b("linklistrow").style.display="none":b("linklistcontainer").innerHTML=a,isVisible("filebrowser")&&(b("src").style.width="230px"),isVisible("video_filebrowser_altsource1")&&(b("video_altsource1").style.width="220px"),isVisible("video_filebrowser_altsource2")&&(b("video_altsource2").style.width="220px"),isVisible("audio_filebrowser_altsource1")&&(b("audio_altsource1").style.width="220px"),isVisible("audio_filebrowser_altsource2")&&(b("audio_altsource2").style.width="220px"),isVisible("filebrowser_poster")&&(b("video_poster").style.width="220px"),d.dom.setOuterHTML(b("media_type"),e.getMediaTypeHTML(d)),e.setDefaultDialogSettings(d),e.data=c(tinyMCEPopup.getWindowArg("data")),e.dataToForm(),e.preview(),updateColor("bgcolor_pick","bgcolor")},insert:function(){var a=tinyMCEPopup.editor;this.formToData(),a.execCommand("mceRepaint"),tinyMCEPopup.restoreSelection(),a.selection.setNode(a.plugins.media.dataToImg(this.data)),tinyMCEPopup.close()},preview:function(){b("prev").innerHTML=this.editor.plugins.media.dataToHtml(this.data,!0)},moveStates:function(a,c){function m(a){var b={};return a&&tinymce.each(a.split("&"),function(a){var c=a.split("=");b[unescape(c[0])]=unescape(c[1])}),b}function n(b,c){var f,g,h,j,k;if(b==i.type||b=="global"){c=tinymce.explode(c);for(f=0;f<c.length;f++)g=c[f],h=b=="global"?g:b+"_"+g,b=="global"?k=i:b=="video"||b=="audio"?(k=i.video.attrs,!k&&!a&&(i.video.attrs=k={})):k=i.params,k&&(a?e(h,k[g],b=="video"||b=="audio"?g:""):(delete k[g],j=d(h),(b=="video"||b=="audio")&&j===!0&&(j=g),l[h]?j!==l[h]&&(j=""+j,k[g]=j):j&&(j=""+j,k[g]=j)))}}var f,g,h,i=this.data,j=this.editor,k=j.plugins.media,l={quicktime_autoplay:!0,quicktime_controller:!0,flash_play:!0,flash_loop:!0,flash_menu:!0,windowsmedia_autostart:!0,windowsmedia_enablecontextmenu:!0,windowsmedia_invokeurls:!0,realmedia_autogotourl:!0,realmedia_imagestatus:!0};if(!a){i.type=b("media_type").options[b("media_type").selectedIndex].value,i.width=d("width"),i.height=d("height"),g=d("src");if(c=="src"){f=g.replace(/^.*\.([^.]+)$/,"$1");if(h=k.getType(f))i.type=h.name.toLowerCase();e("media_type",i.type)}if(i.type=="video"||i.type=="audio")i.video.sources||(i.video.sources=[]),i.video.sources[0]={src:d("src")}}b("video_options").style.display="none",b("audio_options").style.display="none",b("flash_options").style.display="none",b("quicktime_options").style.display="none",b("shockwave_options").style.display="none",b("windowsmedia_options").style.display="none",b("realmedia_options").style.display="none",b("embeddedaudio_options").style.display="none",b(i.type+"_options")&&(b(i.type+"_options").style.display="block"),e("media_type",i.type),n("flash","play,loop,menu,swliveconnect,quality,scale,salign,wmode,base,flashvars"),n("quicktime","loop,autoplay,cache,controller,correction,enablejavascript,kioskmode,autohref,playeveryframe,targetcache,scale,starttime,endtime,target,qtsrcchokespeed,volume,qtsrc"),n("shockwave","sound,progress,autostart,swliveconnect,swvolume,swstretchstyle,swstretchhalign,swstretchvalign"),n("windowsmedia","autostart,enabled,enablecontextmenu,fullscreen,invokeurls,mute,stretchtofit,windowlessvideo,balance,baseurl,captioningid,currentmarker,currentposition,defaultframe,playcount,rate,uimode,volume"),n("realmedia","autostart,loop,autogotourl,center,imagestatus,maintainaspect,nojava,prefetch,shuffle,console,controls,numloop,scriptcallbacks"),n("video","poster,autoplay,loop,muted,preload,controls"),n("audio","autoplay,loop,preload,controls"),n("embeddedaudio","autoplay,loop,controls"),n("global","id,name,vspace,hspace,bgcolor,align,width,height"),a?i.type=="video"?(i.video.sources[0]&&e("src",i.video.sources[0].src),g=i.video.sources[1],g&&e("video_altsource1",g.src),g=i.video.sources[2],g&&e("video_altsource2",g.src)):i.type=="audio"?(i.video.sources[0]&&e("src",i.video.sources[0].src),g=i.video.sources[1],g&&e("audio_altsource1",g.src),g=i.video.sources[2],g&&e("audio_altsource2",g.src)):(i.type=="flash"&&tinymce.each(j.getParam("flash_video_player_flashvars",{url:"$url",poster:"$poster"}),function(a,b){a=="$url"&&(i.params.src=m(i.params.flashvars)[b]||i.params.src||"")}),e("src",i.params.src)):(g=d("src"),g.match(/youtu.be\/[a-z1-9.-_]+/)&&(i.width=425,i.height=350,i.params.frameborder="0",i.type="iframe",g="http://www.youtube.com/embed/"+g.match(/youtu.be\/([a-z1-9.-_]+)/)[1],e("src",g),e("media_type",i.type)),g.match(/youtube.com(.+)v=([^&]+)/)&&(i.width=425,i.height=350,i.params.frameborder="0",i.type="iframe",g="http://www.youtube.com/embed/"+g.match(/v=([^&]+)/)[1],e("src",g),e("media_type",i.type)),g.match(/video.google.com(.+)docid=([^&]+)/)&&(i.width=425,i.height=326,i.type="flash",g="http://video.google.com/googleplayer.swf?docId="+g.match(/docid=([^&]+)/)[1]+"&hl=en",e("src",g),e("media_type",i.type)),i.type=="video"?(i.video.sources||(i.video.sources=[]),i.video.sources[0]={src:g},g=d("video_altsource1"),g&&(i.video.sources[1]={src:g}),g=d("video_altsource2"),g&&(i.video.sources[2]={src:g})):i.type=="audio"?(i.video.sources||(i.video.sources=[]),i.video.sources[0]={src:g},g=d("audio_altsource1"),g&&(i.video.sources[1]={src:g}),g=d("audio_altsource2"),g&&(i.video.sources[2]={src:g})):i.params.src=g,e("width",i.width||(i.type=="audio"?300:320)),e("height",i.height||(i.type=="audio"?32:240)))},dataToForm:function(){this.moveStates(!0)},formToData:function(a){(a=="width"||a=="height")&&this.changeSize(a),a=="source"?(this.moveStates(!1,a),e("source",this.editor.plugins.media.dataToHtml(this.data)),this.panel="source"):(this.panel=="source"&&(this.data=c(this.editor.plugins.media.htmlToData(d("source"))),this.dataToForm(),this.panel=""),this.moveStates(!1,a),this.preview())},beforeResize:function(){this.width=parseInt(d("width")||(this.data.type=="audio"?"300":"320"),10),this.height=parseInt(d("height")||(this.data.type=="audio"?"32":"240"),10)},changeSize:function(a){var c,f;b("constrain").checked&&(c=parseInt(d("width")||(this.data.type=="audio"?"300":"320"),10),f=parseInt(d("height")||(this.data.type=="audio"?"32":"240"),10),a=="width"?(this.height=Math.round(c/this.width*f),e("height",this.height)):(this.width=Math.round(f/this.height*c),e("width",this.width)))},getMediaListHTML:function(){var a,b;if(typeof tinyMCEMediaList!="undefined"&&tinyMCEMediaList.length>0){a="",a+='<select id="linklist" name="linklist" style="width: 250px" onchange="this.form.src.value=this.options[this.selectedIndex].value;Media.formToData(\'src\');">',a+='<option value="">---</option>';for(b=0;b<tinyMCEMediaList.length;b++)a+='<option value="'+tinyMCEMediaList[b][1]+'">'+tinyMCEMediaList[b][0]+"</option>";return a+="</select>",a}return""},getMediaTypeHTML:function(a){function c(b,c){return a.schema.getElementRule(c||b)?'<option value="'+b+'">'+tinyMCEPopup.editor.translate("media_dlg."+b)+"</option>":""}var b;return b="",b+='<select id="media_type" name="media_type" onchange="Media.formToData(\'type\');">',b+=c("video"),b+=c("audio"),b+=c("flash","object"),b+=c("quicktime","object"),b+=c("shockwave","object"),b+=c("windowsmedia","object"),b+=c("realmedia","object"),b+=c("iframe"),a.getParam("media_embedded_audio",!1)&&(b+=c("embeddedaudio","object")),b+="</select>",b},setDefaultDialogSettings:function(a){var b=a.getParam("media_dialog_defaults",{});tinymce.each(b,function(a,b){e(b,a)})}},tinyMCEPopup.requireLangPack(),tinyMCEPopup.onInit.add(function(){Media.init()})})();