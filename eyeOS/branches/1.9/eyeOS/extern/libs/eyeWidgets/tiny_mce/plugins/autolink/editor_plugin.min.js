(function(){tinymce.create("tinymce.plugins.AutolinkPlugin",{init:function(a){var b=this;if(tinyMCE.isIE)return;a.onKeyDown.add(function(a,c){if(c.keyCode==13)return b.handleEnter(a)}),a.onKeyPress.add(function(a,c){if(c.which==41)return b.handleEclipse(a)}),a.onKeyUp.add(function(a,c){if(c.keyCode==32)return b.handleSpacebar(a)})},handleEclipse:function(a){this.parseCurrentLine(a,-1,"(",!0)},handleSpacebar:function(a){this.parseCurrentLine(a,0,"",!0)},handleEnter:function(a){this.parseCurrentLine(a,-1,"",!1)},parseCurrentLine:function(a,b,c){var d,e,f,g,h,i,j,k,l,m=a.selection.getRng().cloneRange();if(m.startOffset<5){j=m.endContainer.previousSibling;if(j==null){if(m.endContainer.firstChild==null||m.endContainer.firstChild.nextSibling==null)return;j=m.endContainer.firstChild.nextSibling}k=j.length,m.setStart(j,k),m.setEnd(j,k);if(m.endOffset<5)return;d=m.endOffset,f=j}else{f=m.endContainer;if(f.nodeType!=3&&f.firstChild){while(f.nodeType!=3&&f.firstChild)f=f.firstChild;m.setStart(f,0),m.setEnd(f,f.nodeValue.length)}m.endOffset==1?d=2:d=m.endOffset-1-b}e=d;do m.setStart(f,d-2),m.setEnd(f,d-1),d-=1;while(m+""!=" "&&m+""!=""&&(m+"").charCodeAt(0)!=160&&d-2>=0&&m+""!=c);m+""==c||(m+"").charCodeAt(0)==160?(m.setStart(f,d),m.setEnd(f,e),d+=1):m.startOffset==0?(m.setStart(f,0),m.setEnd(f,e)):(m.setStart(f,d),m.setEnd(f,e)),h=m+"",i=h.match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)(.+)$/i),i&&(i[1]=="www."&&(i[1]="http://www."),g=a.selection.getBookmark(),a.selection.setRng(m),tinyMCE.execCommand("createlink",!1,i[1]+i[2]),a.selection.moveToBookmark(g),tinyMCE.isWebKit&&(a.selection.collapse(!1),l=Math.min(f.length,e+1),m.setStart(f,l),m.setEnd(f,l),a.selection.setRng(m)))},getInfo:function(){return{longname:"Autolink",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/autolink",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("autolink",tinymce.plugins.AutolinkPlugin)})();