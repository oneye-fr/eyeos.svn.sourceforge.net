(function(){var a=tinymce.each;tinymce.create("tinymce.plugins.TemplatePlugin",{init:function(b,c){var d=this;d.editor=b,b.addCommand("mceTemplate",function(){b.windowManager.open({file:c+"/template.htm",width:b.getParam("template_popup_width",750),height:b.getParam("template_popup_height",600),inline:1},{plugin_url:c})}),b.addCommand("mceInsertTemplate",d._insertTemplate,d),b.addButton("template",{title:"template.desc",cmd:"mceTemplate"}),b.onPreProcess.add(function(b,c){var e=b.dom;a(e.select("div",c.node),function(c){e.hasClass(c,"mceTmpl")&&(a(e.select("*",c),function(a){e.hasClass(a,b.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(a.innerHTML=d._getDateTime(new Date,b.getParam("template_mdate_format",b.getLang("template.mdate_format"))))}),d._replaceVals(c))})})},getInfo:function(){return{longname:"Template plugin",author:"Moxiecode Systems AB",authorurl:"http://www.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/template",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_insertTemplate:function(b,c){function j(a,b){return RegExp("\\b"+b+"\\b","g").test(a.className)}var d,e=this,f=e.editor,g=f.dom,h=f.selection.getContent(),i=c.content;a(e.editor.getParam("template_replace_values"),function(a,b){typeof a!="function"&&(i=i.replace(RegExp("\\{\\$"+b+"\\}","g"),a))}),d=g.create("div",null,i),n=g.select(".mceTmpl",d),n&&n.length>0&&(d=g.create("div",null),d.appendChild(n[0].cloneNode(!0))),a(g.select("*",d),function(a){j(a,f.getParam("template_cdate_classes","cdate").replace(/\s+/g,"|"))&&(a.innerHTML=e._getDateTime(new Date,f.getParam("template_cdate_format",f.getLang("template.cdate_format")))),j(a,f.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(a.innerHTML=e._getDateTime(new Date,f.getParam("template_mdate_format",f.getLang("template.mdate_format")))),j(a,f.getParam("template_selected_content_classes","selcontent").replace(/\s+/g,"|"))&&(a.innerHTML=h)}),e._replaceVals(d),f.execCommand("mceInsertContent",!1,d.innerHTML),f.addVisual()},_replaceVals:function(b){var c=this.editor.dom,d=this.editor.getParam("template_replace_values");a(c.select("*",b),function(b){a(d,function(a,f){c.hasClass(b,f)&&typeof d[f]=="function"&&d[f](b)})})},_getDateTime:function(a,b){function c(a,b){var c;a=""+a;if(a.length<b)for(c=0;c<b-a.length;c++)a="0"+a;return a}return b?(b=b.replace("%D","%m/%d/%y"),b=b.replace("%r","%I:%M:%S %p"),b=b.replace("%Y",""+a.getFullYear()),b=b.replace("%y",""+a.getYear()),b=b.replace("%m",c(a.getMonth()+1,2)),b=b.replace("%d",c(a.getDate(),2)),b=b.replace("%H",""+c(a.getHours(),2)),b=b.replace("%M",""+c(a.getMinutes(),2)),b=b.replace("%S",""+c(a.getSeconds(),2)),b=b.replace("%I",""+((a.getHours()+11)%12+1)),b=b.replace("%p",""+(a.getHours()<12?"AM":"PM")),b=b.replace("%B",""+this.editor.getLang("template_months_long").split(",")[a.getMonth()]),b=b.replace("%b",""+this.editor.getLang("template_months_short").split(",")[a.getMonth()]),b=b.replace("%A",""+this.editor.getLang("template_day_long").split(",")[a.getDay()]),b=b.replace("%a",""+this.editor.getLang("template_day_short").split(",")[a.getDay()]),b=b.replace("%%","%"),b):""}}),tinymce.PluginManager.add("template",tinymce.plugins.TemplatePlugin)})();