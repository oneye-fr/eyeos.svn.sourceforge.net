function insertTable(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=document.forms[0],q=tinyMCEPopup.editor,r=q.dom,s=2,t=2,u=0,v=-1,w=-1,x="";tinyMCEPopup.restoreSelection();if(!AutoValidator.validate(p))return tinyMCEPopup.alert(AutoValidator.getErrorMessages(p).join(". ")+"."),!1;i=r.getParent(q.selection.getNode(),"table"),s=p.elements.cols.value,t=p.elements.rows.value,u=p.elements["border"].value!=""?p.elements.border.value:0,v=p.elements["cellpadding"].value!=""?p.elements.cellpadding.value:"",w=p.elements["cellspacing"].value!=""?p.elements.cellspacing.value:"",a=getSelectValue(p,"align"),f=getSelectValue(p,"tframe"),g=getSelectValue(p,"rules"),b=p.elements.width.value,c=p.elements.height.value,bordercolor=p.elements.bordercolor.value,bgcolor=p.elements.bgcolor.value,d=getSelectValue(p,"class"),id=p.elements.id.value,summary=p.elements.summary.value,style=p.elements.style.value,dir=p.elements.dir.value,lang=p.elements.lang.value,background=p.elements.backgroundimage.value,e=p.elements.caption.checked,j=tinyMCEPopup.getParam("table_cell_limit",!1),k=tinyMCEPopup.getParam("table_row_limit",!1),l=tinyMCEPopup.getParam("table_col_limit",!1);if(l&&s>l)return tinyMCEPopup.alert(q.getLang("table_dlg.col_limit").replace(/\{\$cols\}/g,l)),!1;if(k&&t>k)return tinyMCEPopup.alert(q.getLang("table_dlg.row_limit").replace(/\{\$rows\}/g,k)),!1;if(j&&s*t>j)return tinyMCEPopup.alert(q.getLang("table_dlg.cell_limit").replace(/\{\$cells\}/g,j)),!1;if(action=="update")return r.setAttrib(i,"cellPadding",v,!0),r.setAttrib(i,"cellSpacing",w,!0),isCssSize(u)?r.setAttrib(i,"border",""):r.setAttrib(i,"border",u),u==""&&(r.setStyle(i,"border-width",""),r.setStyle(i,"border",""),r.setAttrib(i,"border","")),r.setAttrib(i,"align",a),r.setAttrib(i,"frame",f),r.setAttrib(i,"rules",g),r.setAttrib(i,"class",d),r.setAttrib(i,"style",style),r.setAttrib(i,"id",id),r.setAttrib(i,"summary",summary),r.setAttrib(i,"dir",dir),r.setAttrib(i,"lang",lang),h=q.dom.select("caption",i)[0],h&&!e&&h.parentNode.removeChild(h),!h&&e&&(h=i.ownerDocument.createElement("caption"),tinymce.isIE||(h.innerHTML='<br data-mce-bogus="1"/>'),i.insertBefore(h,i.firstChild)),b&&q.settings.inline_styles?(r.setStyle(i,"width",b),r.setAttrib(i,"width","")):(r.setAttrib(i,"width",b,!0),r.setStyle(i,"width","")),r.setAttrib(i,"borderColor",""),r.setAttrib(i,"bgColor",""),r.setAttrib(i,"background",""),c&&q.settings.inline_styles?(r.setStyle(i,"height",c),r.setAttrib(i,"height","")):(r.setAttrib(i,"height",c,!0),r.setStyle(i,"height","")),background!=""?i.style.backgroundImage="url('"+background+"')":i.style.backgroundImage="",bordercolor!=""?(i.style.borderColor=bordercolor,i.style.borderStyle=i.style.borderStyle==""?"solid":i.style.borderStyle,i.style.borderWidth=cssSize(u)):i.style.borderColor="",i.style.backgroundColor=bgcolor,i.style.height=getCSSSize(c),q.addVisual(),q.nodeChanged(),q.execCommand("mceEndUndoLevel",!1,{},{skip_undo:!0}),(p.width.value!=orgTableWidth||p.height.value!=orgTableHeight)&&q.execCommand("mceRepaint"),tinyMCEPopup.close(),!0;x+="<table",x+=makeAttrib("id",id),isCssSize(u)||(x+=makeAttrib("border",u)),x+=makeAttrib("cellpadding",v),x+=makeAttrib("cellspacing",w),x+=makeAttrib("data-mce-new","1"),b&&q.settings.inline_styles?(style&&(style+="; "),/^[0-9\.]+$/.test(b)&&(b+="px"),style+="width: "+b):x+=makeAttrib("width",b),x+=makeAttrib("align",a),x+=makeAttrib("frame",f),x+=makeAttrib("rules",g),x+=makeAttrib("class",d),x+=makeAttrib("style",style),x+=makeAttrib("summary",summary),x+=makeAttrib("dir",dir),x+=makeAttrib("lang",lang),x+=">",e&&(tinymce.isIE?x+="<caption></caption>":x+='<caption><br data-mce-bogus="1"/></caption>');for(m=0;m<t;m++){x+="<tr>";for(n=0;n<s;n++)tinymce.isIE?x+="<td></td>":x+='<td><br data-mce-bogus="1"/></td>';x+="</tr>"}x+="</table>",q.settings.fix_table_elements?(o="",q.focus(),q.selection.setContent('<br class="_mce_marker" />'),tinymce.each("h1,h2,h3,h4,h5,h6,p".split(","),function(a){o&&(o+=","),o+=a+" ._mce_marker"}),tinymce.each(q.dom.select(o),function(a){q.dom.split(q.dom.getParent(a,"h1,h2,h3,h4,h5,h6,p"),a)}),r.setOuterHTML(r.select("br._mce_marker")[0],x)):q.execCommand("mceInsertContent",!1,x),tinymce.each(r.select("table[data-mce-new]"),function(a){var b;tinymce.isIE&&a.nextSibling==null&&r.insertAfter(r.create("p"),a),b=r.select("td,th",a);try{q.selection.setCursorLocation(b[0],0)}catch(c){}r.setAttrib(a,"data-mce-new","")}),q.addVisual(),q.execCommand("mceEndUndoLevel",!1,{},{skip_undo:!0}),tinyMCEPopup.close()}function makeAttrib(a,b){var c=document.forms[0],d=c.elements[a];if(typeof b=="undefined"||b==null)b="",d&&(b=d.value);return b==""?"":(b=b.replace(/&/g,"&amp;"),b=b.replace(/\"/g,"&quot;"),b=b.replace(/</g,"&lt;"),b=b.replace(/>/g,"&gt;")," "+a+'="'+b+'"')}function init(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;tinyMCEPopup.resizeToInnerSize(),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("bordercolor_pickcontainer").innerHTML=getColorPickerHTML("bordercolor_pick","bordercolor"),document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor"),a=2,b=2,c=tinyMCEPopup.getParam("table_default_border","0"),d=tinyMCEPopup.getParam("table_default_cellpadding",""),e=tinyMCEPopup.getParam("table_default_cellspacing",""),f="",g="",h="",i="",j="",k="",l="",m="",n="",o="",p="",q="",j="",i="",r="",s="",t=tinyMCEPopup.editor,u=t.dom,v=document.forms[0],w=u.getParent(t.selection.getNode(),"table"),action=tinyMCEPopup.getWindowArg("action"),action||(action=w?"update":"insert");if(w&&action!="insert"){x=w.rows,a=0;for(y=0;y<x.length;y++)x[y].cells.length>a&&(a=x[y].cells.length);a=a,b=x.length,st=u.parseStyle(u.getAttrib(w,"style")),c=trimSize(getStyle(w,"border","borderWidth")),d=u.getAttrib(w,"cellpadding",""),e=u.getAttrib(w,"cellspacing",""),g=trimSize(getStyle(w,"width","width")),h=trimSize(getStyle(w,"height","height")),i=convertRGBToHex(getStyle(w,"bordercolor","borderLeftColor")),j=convertRGBToHex(getStyle(w,"bgcolor","backgroundColor")),f=u.getAttrib(w,"align",f),s=u.getAttrib(w,"frame"),r=u.getAttrib(w,"rules"),k=tinymce.trim(u.getAttrib(w,"class").replace(/mceItem.+/g,"")),l=u.getAttrib(w,"id"),m=u.getAttrib(w,"summary"),n=u.serializeStyle(st),o=u.getAttrib(w,"dir"),p=u.getAttrib(w,"lang"),q=getStyle(w,"background","backgroundImage").replace(RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"),v.caption.checked=w.getElementsByTagName("caption").length>0,orgTableWidth=g,orgTableHeight=h,action="update",v.insert.value=t.getLang("update")}addClassesToList("class","table_styles"),TinyMCE_EditableSelects.init(),selectByValue(v,"align",f),selectByValue(v,"tframe",s),selectByValue(v,"rules",r),selectByValue(v,"class",k,!0,!0),v.cols.value=a,v.rows.value=b,v.border.value=c,v.cellpadding.value=d,v.cellspacing.value=e,v.width.value=g,v.height.value=h,v.bordercolor.value=i,v.bgcolor.value=j,v.id.value=l,v.summary.value=m,v.style.value=n,v.dir.value=o,v.lang.value=p,v.backgroundimage.value=q,updateColor("bordercolor_pick","bordercolor"),updateColor("bgcolor_pick","bgcolor"),isVisible("backgroundimagebrowser")&&(document.getElementById("backgroundimage").style.width="180px"),action=="update"&&(v.cols.disabled=!0,v.rows.disabled=!0)}function changedSize(){var a=document.forms[0],b=dom.parseStyle(a.style.value),c=a.height.value;c!=""?b.height=getCSSSize(c):b.height="",a.style.value=dom.serializeStyle(b)}function isCssSize(a){return/^[0-9.]+(%|in|cm|mm|em|ex|pt|pc|px)$/.test(a)}function cssSize(a,b){return a=tinymce.trim(a||b),isCssSize(a)?a:parseInt(a,10)+"px"}function changedBackgroundImage(){var a=document.forms[0],b=dom.parseStyle(a.style.value);b["background-image"]="url('"+a.backgroundimage.value+"')",a.style.value=dom.serializeStyle(b)}function changedBorder(){var a=document.forms[0],b=dom.parseStyle(a.style.value);a.border.value==""||!isCssSize(a.border.value)&&a.bordercolor.value==""?a.border.value||(b.border="",b["border-width"]=""):b["border-width"]=cssSize(a.border.value),a.style.value=dom.serializeStyle(b)}function changedColor(){var a=document.forms[0],b=dom.parseStyle(a.style.value);b["background-color"]=a.bgcolor.value,a.bordercolor.value!=""&&(b["border-color"]=a.bordercolor.value,b["border-width"]||(b["border-width"]=cssSize(a.border.value,1))),a.style.value=dom.serializeStyle(b)}function changedStyle(){var a=document.forms[0],b=dom.parseStyle(a.style.value);b["background-image"]?a.backgroundimage.value=b["background-image"].replace(RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"):a.backgroundimage.value="",b.width&&(a.width.value=trimSize(b.width)),b.height&&(a.height.value=trimSize(b.height)),b["background-color"]&&(a.bgcolor.value=b["background-color"],updateColor("bgcolor_pick","bgcolor")),b["border-color"]&&(a.bordercolor.value=b["border-color"],updateColor("bordercolor_pick","bordercolor"))}var action,orgTableWidth,orgTableHeight,dom;tinyMCEPopup.requireLangPack(),dom=tinyMCEPopup.editor.dom,tinyMCEPopup.onInit.add(init);