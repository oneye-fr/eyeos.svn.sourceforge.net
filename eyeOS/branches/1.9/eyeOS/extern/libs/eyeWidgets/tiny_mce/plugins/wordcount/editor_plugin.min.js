(function(){tinymce.create("tinymce.plugins.WordCount",{block:0,id:null,countre:null,cleanre:null,init:function(a){function e(a){return a!==c&&(a===d.ENTER||c===d.SPACEBAR||f(c))}function f(a){return a===d.DELETE||a===d.BACKSPACE}var b=this,c=0,d=tinymce.VK;b.countre=a.getParam("wordcount_countregex",/[\w\u2019\'-]+/g),b.cleanre=a.getParam("wordcount_cleanregex",/[0-9.(),;:!?%#$?\'\"_+=\\\/-]*/g),b.update_rate=a.getParam("wordcount_update_rate",2e3),b.update_on_delete=a.getParam("wordcount_update_on_delete",!1),b.id=a.id+"-word-count",a.onPostRender.add(function(a){var c,d=a.getParam("wordcount_target_id");d?tinymce.DOM.add(d,"span",{},'<span id="'+b.id+'">0</span>'):(c=tinymce.DOM.get(a.id+"_path_row"),c&&tinymce.DOM.add(c.parentNode,"div",{style:"float: right"},a.getLang("wordcount.words","Words: ")+'<span id="'+b.id+'">0</span>'))}),a.onInit.add(function(a){a.selection.onSetContent.add(function(){b._count(a)}),b._count(a)}),a.onSetContent.add(function(a){b._count(a)}),a.onKeyUp.add(function(a,d){(e(d.keyCode)||b.update_on_delete&&f(d.keyCode))&&b._count(a),c=d.keyCode})},_getCount:function(a){var b,c=0,d=a.getContent({format:"raw"});return d&&(d=d.replace(/\.\.\./g," "),d=d.replace(/<.[^<>]*?>/g," ").replace(/&nbsp;|&#160;/gi," "),d=d.replace(/(\w+)(&.+?;)+(\w+)/,"$1$3").replace(/&.+?;/g," "),d=d.replace(this.cleanre,""),b=d.match(this.countre),b&&(c=b.length)),c},_count:function(a){var b=this;if(b.block)return;b.block=1,setTimeout(function(){var c;a.destroyed||(c=b._getCount(a),tinymce.DOM.setHTML(b.id,c+""),setTimeout(function(){b.block=0},b.update_rate))},1)},getInfo:function(){return{longname:"Word Count plugin",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/wordcount",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("wordcount",tinymce.plugins.WordCount)})();