(function(){function d(a,b){while(a&&(a.nodeType===8||a.nodeType===3&&/^[ \t\n\r]*$/.test(a.nodeValue)))a=b(a);return a}function e(a){return d(a,function(a){return a.previousSibling})}function f(a){return d(a,function(a){return a.nextSibling})}function g(a,b,c){return a.dom.getParent(b,function(a){return tinymce.inArray(c,a)!==-1})}function h(a){return a&&(a.tagName==="OL"||a.tagName==="UL")}function i(a,b){var c,d,f=e(a.lastChild);while(h(f))c=f,f=e(c.previousSibling);return c&&(d=b.create("li",{style:"list-style-type: none;"}),b.split(a,c),b.insertAfter(d,c),d.appendChild(c),d.appendChild(c),a=d.previousSibling),a}function j(a,b,c){return a=k(a,b,c),l(a,b,c)}function k(a,b,c){var d=e(a.previousSibling);return d?m(d,a,b?d:!1,c):a}function l(a,b,c){var d=f(a.nextSibling);return d?m(a,d,b?d:!1,c):a}function m(a,b,c,d){return n(a,b,!!c,d)?q(a,b,c):(a&&a.tagName==="LI"&&h(b)&&a.appendChild(b),b)}function n(a,b,c,d){return!a||!b?!1:a.tagName==="LI"&&b.tagName==="LI"?b.style.listStyleType==="none"||p(b):h(a)?a.tagName===b.tagName&&(c||a.style.listStyleType===b.style.listStyleType)||o(b):d&&a.tagName==="P"&&b.tagName==="P"}function o(a){var b=f(a.firstChild),c=e(a.lastChild);return b&&c&&h(a)&&b===c&&(h(b)||b.style.listStyleType==="none"||p(b))}function p(a){var b=f(a.firstChild),c=e(a.lastChild);return b&&c&&b===c&&h(b)}function q(a,b,c){var d=e(a.lastChild),g=f(b.firstChild);a.tagName==="P"&&a.appendChild(a.ownerDocument.createElement("br"));while(b.firstChild)a.appendChild(b.firstChild);return c&&(a.style.listStyleType=c.style.listStyleType),b.parentNode.removeChild(b),m(d,g,!1),a}function r(a,b){var c;return b.is(a,"li,ol,ul")||(c=b.getParent(a,"li"),c&&(a=c)),a}var a,b=tinymce.each,c=tinymce.dom.Event;tinymce.create("tinymce.plugins.Lists",{init:function(a){function j(b){return b.keyCode===tinymce.VK.TAB&&!b.altKey&&!b.ctrlKey&&(a.queryCommandState("InsertUnorderedList")||a.queryCommandState("InsertOrderedList"))}function k(){var a=n(),b=a.parentNode.parentNode,c=a.parentNode.lastChild===a;return c&&!l(b)&&o(a)}function l(a){return h(a)?a.parentNode&&a.parentNode.tagName==="LI":a.tagName==="LI"}function m(){return a.selection.isCollapsed()&&o(n())}function n(){var b=a.selection.getStart();return b.tagName!="BR"&&b.tagName!=""||b.parentNode.tagName!="LI"?b:b.parentNode}function o(a){var b=a.childNodes.length;return a.tagName==="LI"?b==0?!0:b==1&&(a.firstChild.tagName==""||a.firstChild.tagName=="BR"||p(a)):!1}function p(a){var b=tinymce.grep(a.parentNode.childNodes,function(a){return a.tagName=="LI"}),c=a==b[b.length-1],d=a.firstChild;return tinymce.isIE9&&c&&(d.nodeValue==String.fromCharCode(160)||d.nodeValue==String.fromCharCode(32))}function q(a){return a.keyCode===tinymce.VK.ENTER}function r(a){return q(a)&&!a.shiftKey}function s(a){return j(a)?b:r(a)&&k()?e:r(a)&&m()?d:g}function t(a,f){(i==b||i==d||tinymce.isGecko&&i==e)&&c.cancel(f)}function u(){var b,c=a.selection.getRng(!0),d=c.startContainer;return d.nodeType==3?(b=d.nodeValue,tinymce.isIE9&&b.length>1&&b.charCodeAt(b.length-1)==32?c.endOffset==b.length-1:c.endOffset==b.length):d.nodeType==1?c.endOffset==d.childNodes.length:!1}function v(){var b=a.selection.getNode(),c="h1,h2,h3,h4,h5,h6,p,div",d=a.dom.is(b,c)&&b.parentNode.tagName==="LI"&&b.parentNode.lastChild===b;return a.selection.isCollapsed()&&d&&u()}function w(a,b){var c,d,e;r(b)&&v()&&(c=a.selection.getNode(),d=a.dom.create("li"),e=a.dom.getParent(c,"li"),a.dom.insertAfter(d,e),tinymce.isIE6||tinymce.isIE7||tinyMCE.isIE8?(d.appendChild(a.dom.create("&nbsp;")),a.selection.setCursorLocation(d,1)):tinyMCE.isGecko?setTimeout(function(){var b=a.getDoc().createTextNode("﻿");d.appendChild(b),a.selection.setCursorLocation(d,0)},0):a.selection.setCursorLocation(d,0),b.preventDefault())}function x(a,b){function j(a){var b=a.firstChild,c=null;do{if(!b)break;b.tagName==="LI"&&(c=b)}while(b=b.nextSibling);return c}function k(a,b){while(a.childNodes.length>0)b.appendChild(a.childNodes[0])}var c,d,e,f,g,h,i;if(!tinymce.isGecko)return;d=a.selection.getStart();if(b.keyCode!=tinymce.VK.BACKSPACE||d.tagName!=="IMG")return;c=d.parentNode.previousSibling;if(!c)return;if(c.tagName==="UL"||c.tagName==="OL")e=c;else{if(!c.previousSibling||c.previousSibling.tagName!=="UL"&&c.previousSibling.tagName!=="OL")return;e=c.previousSibling}f=j(e),g=a.dom.createRng(),g.setStart(f,1),g.setEnd(f,1),a.selection.setRng(g),a.selection.collapse(!0),h=a.selection.getBookmark(),i=d.parentNode.cloneNode(!0),i.tagName==="P"||i.tagName==="DIV"?k(i,f):f.appendChild(i),d.parentNode.parentNode.removeChild(d.parentNode),a.selection.moveToBookmark(h)}function y(b){var c,d=a.dom.getParent(b,"ol,ul");d!=null&&(c=d.lastChild,c.appendChild(a.getDoc().createElement("")),a.selection.setCursorLocation(c,0))}function z(b,c){var d=a.getDoc().createTextNode("﻿");b.insertBefore(d,c),a.selection.setCursorLocation(d,0),a.execCommand("mceRepaint")}function A(a,b){var c,d,e;q(b)&&(c=n(),c&&(d=c.parentNode,e=d&&d.parentNode,e&&e.nodeName=="LI"&&e.firstChild==d&&c==d.firstChild&&z(e,d)))}function B(a,b){var c,d;q(b)&&(c=n(),a.dom.select("ul li",c).length===1&&(d=c.firstChild,z(c,d)))}function C(a,b){function g(b,c){var d,e=[],f=new tinymce.dom.TreeWalker(c,b);for(d=f.current();d;d=f.next())a.dom.is(d,"ol,ul,li")&&e.push(d);return e}var d,e,f;if(b.keyCode==tinymce.VK.BACKSPACE){d=n();if(d){e=a.dom.getParent(d,"ol,ul");if(e&&e.firstChild===d)return f=g(e,d),a.execCommand("Outdent",!1,f),a.undoManager.add(),c.cancel(b)}}}function D(a,b){var d,e,f,g=n();if(b.keyCode===tinymce.VK.BACKSPACE&&a.dom.is(g,"li")&&g.parentNode.firstChild!==g&&a.dom.select("ul,ol",g).length===1)return d=g.previousSibling,a.dom.remove(a.dom.select("br",g)),a.dom.remove(g,!0),e=tinymce.grep(d.childNodes,function(a){return a.nodeType===3}),e.length===1&&(f=e[0],a.selection.setCursorLocation(f,f.length)),a.undoManager.add(),c.cancel(b)}var b="TABBING",d="EMPTY",e="ESCAPE",f="PARAGRAPH",g="UNKNOWN",i=g;this.ed=a,a.addCommand("Indent",this.indent,this),a.addCommand("Outdent",this.outdent,this),a.addCommand("InsertUnorderedList",function(){this.applyList("UL","OL")},this),a.addCommand("InsertOrderedList",function(){this.applyList("OL","UL")},this),a.onInit.add(function(){a.editorCommands.addCommands({outdent:function(){function d(b){return b=c.getParent(b,c.isBlock),b&&parseInt(a.dom.getStyle(b,"margin-left")||0,10)+parseInt(a.dom.getStyle(b,"padding-left")||0,10)>0}var b=a.selection,c=a.dom;return d(b.getStart())||d(b.getEnd())||a.queryCommandState("InsertOrderedList")||a.queryCommandState("InsertUnorderedList")}},"state")}),a.onKeyUp.add(function(a,f){var h,j,k;if(i==b)return a.execCommand(f.shiftKey?"Outdent":"Indent",!0,null),i=g,c.cancel(f);if(i==d)return h=n(),j=a.settings.list_outdent_on_enter===!0||f.shiftKey,a.execCommand(j?"Outdent":"Indent",!0,null),tinymce.isIE&&y(h),c.cancel(f);if(i==e)if(tinymce.isIE6||tinymce.isIE7||tinymce.isIE8)k=a.getDoc().createTextNode("﻿"),a.selection.getNode().appendChild(k);else if(tinymce.isIE9||tinymce.isGecko)return a.execCommand("Outdent"),c.cancel(f)}),a.onKeyDown.add(function(a,b){i=s(b)}),a.onKeyDown.add(t),a.onKeyDown.add(x),a.onKeyDown.add(w),tinymce.isGecko&&a.onKeyUp.add(A),tinymce.isIE8&&a.onKeyUp.add(B),(tinymce.isGecko||tinymce.isWebKit)&&a.onKeyDown.add(C),tinymce.isWebKit&&a.onKeyDown.add(D)},applyList:function(c,d){function q(a){a&&a.tagName==="BR"&&h.remove(a)}function s(a){function e(a){(a.style.marginLeft||a.style.paddingLeft)&&f.adjustPaddingFunction(!1)(a)}var b,d=h.create(c);if(a.tagName!=="LI"){if(a.tagName==="P"||a.tagName==="DIV"||a.tagName==="BODY"){u(a,function(c,d){t(c,d,a.tagName==="BODY"?null:c.parentNode),b=c.parentNode,e(b),q(d)}),b&&(b.tagName==="LI"&&(a.tagName==="P"||p.length>1)&&h.split(b.parentNode.parentNode,b.parentNode),j(b.parentNode,!0));return}b=h.create("li"),h.insertAfter(b,a),b.appendChild(a),e(a),a=b}h.insertAfter(d,a),d.appendChild(a),j(d,!0),k.push(a)}function t(a,b,c){var d,e,f=a;while(!h.isBlock(a.parentNode)&&a.parentNode!==h.getRoot())a=h.split(a.parentNode,a.previousSibling),a=a.nextSibling,f=a;if(c){d=c.cloneNode(!0),a.parentNode.insertBefore(d,a);while(d.firstChild)h.remove(d.firstChild);d=h.rename(d,"li")}else d=h.create("li"),a.parentNode.insertBefore(d,a);while(f&&f!=b)e=f.nextSibling,d.appendChild(f),f=e;d.childNodes.length===0&&(d.innerHTML='<br _mce_bogus="1" />'),s(d)}function u(c,d){function m(b,c){var d,e=h.createRng();return a.keep=!0,g.selection.moveToBookmark(a),a.keep=!1,d=g.selection.getRng(!0),c||(c=b.parentNode.lastChild),e.setStartBefore(b),e.setEndAfter(c),e.compareBoundaryPoints(j,d)<=0&&e.compareBoundaryPoints(k,d)>0}function n(a){if(a.nextSibling)return a.nextSibling;if(!h.isBlock(a.parentNode)&&a.parentNode!==h.getRoot())return n(a.parentNode)}var e,f,i,j=3,k=1,l="br,ul,ol,p,div,h1,h2,h3,h4,h5,h6,table,blockquote,address,pre,form,center,dl";e=c.firstChild,i=!1,b(h.select(l,c),function(a){if(a.hasAttribute&&a.hasAttribute("_mce_bogus"))return!0;m(e,a)&&(h.addClass(a,"_mce_tagged_br"),e=n(a))}),i=e&&m(e,undefined),e=c.firstChild,b(h.select(l,c),function(a){var b=n(a);if(a.hasAttribute&&a.hasAttribute("_mce_bogus"))return!0;h.hasClass(a,"_mce_tagged_br")?(d(e,a,f),f=null):f=a,e=b}),i&&d(e,undefined,f)}function v(a){u(a,function(a,b,c){t(a,b),q(b),q(c)})}function w(a){if(tinymce.inArray(k,a)!==-1)return;a.parentNode.tagName===d&&(h.split(a.parentNode,a),s(a),l(a.parentNode,!1)),k.push(a)}function x(a){var b,c,d,e;if(tinymce.inArray(k,a)!==-1)return;a=i(a,h);while(h.is(a.parentNode,"ol,ul,li"))h.split(a.parentNode,a);k.push(a),a=h.rename(a,"p"),d=j(a,!1,g.settings.force_br_newlines);if(d===a){b=a.firstChild;while(b)h.isBlock(b)?(b=h.split(b.parentNode,b),e=!0,c=b.nextSibling&&b.nextSibling.firstChild):(c=b.nextSibling,e&&b.tagName==="BR"&&h.remove(b),e=!1),b=c}}var e,f=this,g=f.ed,h=g.dom,k=[],m=!1,n=!1,o=!1,p=g.selection.getSelectedBlocks();b(p,function(a){a=r(a,h),a.tagName===d||a.tagName==="LI"&&a.parentNode.tagName===d?n=!0:a.tagName===c||a.tagName==="LI"&&a.parentNode.tagName===c?m=!0:o=!0}),o&&!m||n||p.length===0?e={LI:w,H1:s,H2:s,H3:s,H4:s,H5:s,H6:s,P:s,BODY:s,DIV:p.length>1?s:v,defaultAction:v,elements:this.selectedBlocks()}:e={defaultAction:x,elements:this.selectedBlocks()},this.process(e)},indent:function(){function d(a){var c=b.create("li",{style:"list-style-type: none;"});return b.insertAfter(c,a),c}function e(a){var c,e=d(a),f=b.getParent(a,"ol,ul"),g=f.tagName,h=b.getStyle(f,"list-style-type"),i={};return h!==""&&(i.style="list-style-type: "+h+";"),c=b.create(g,i),e.appendChild(c),c}function f(d){var f;g(a,d,c)||(d=i(d,b),f=e(d),f.appendChild(d),j(f.parentNode,!1),j(f,!1),c.push(d))}var a=this.ed,b=a.dom,c=[];this.process({LI:f,defaultAction:this.adjustPaddingFunction(!0),elements:this.selectedBlocks()})},outdent:function(a,c){function l(a){var b,c,d;if(!g(f,a,k)){if(h.getStyle(a,"margin-left")!==""||h.getStyle(a,"padding-left")!=="")return e.adjustPaddingFunction(!1)(a);d=h.getStyle(a,"text-align",!0);if(d==="center"||d==="right"){h.setStyle(a,"text-align","left");return}a=i(a,h),b=a.parentNode,c=a.parentNode.parentNode,c.tagName==="P"?h.split(c,a.parentNode):(h.split(b,a),c.tagName==="LI"?h.split(c,a):h.is(c,"ol,ul")||h.rename(a,"p")),k.push(a)}}var d,e=this,f=e.ed,h=f.dom,k=[];d=c&&tinymce.is(c,"array")?c:this.selectedBlocks(),this.process({LI:l,defaultAction:this.adjustPaddingFunction(!1),elements:d}),b(k,j)},process:function(b){function j(a){var b=tinymce.grep(a.childNodes,function(a){return a.nodeName!=="BR"&&(a.nodeName!=="SPAN"||i.getAttrib(a,"data-mce-type")!="bookmark")&&(a.nodeType!=3||a.nodeValue!=String.fromCharCode(160)&&a.nodeValue!="")});return b.length===0}function k(a){var d;i.removeClass(a,"_mce_act_on");if(!a||a.nodeType!==1||c.length>1&&j(a))return;a=r(a,i),d=b[a.tagName],d||(d=b.defaultAction),d(a)}function l(a){g.splitSafeEach(a.childNodes,k)}function m(a,b){return b>=0&&a.hasChildNodes()&&b<a.childNodes.length&&a.childNodes[b].tagName==="BR"}function n(){var a=h.getNode(),b=i.getParent(a,"td");return b!==null}var c,d,e,f,g=this,h=g.ed.selection,i=g.ed.dom;c=b.elements,d=h.getRng(!0),d.collapsed||(m(d.endContainer,d.endOffset-1)&&(d.setEnd(d.endContainer,d.endOffset-1),h.setRng(d)),m(d.startContainer,d.startOffset)&&(d.setStart(d.startContainer,d.startOffset+1),h.setRng(d))),tinymce.isIE8&&(e=g.ed.selection.getNode(),e.tagName==="LI"&&e.parentNode.lastChild!==e&&(f=g.ed.getDoc().createTextNode("﻿"),e.appendChild(f))),a=h.getBookmark(),b.OL=b.UL=l,g.splitSafeEach(c,k),h.moveToBookmark(a),a=null,n()||g.ed.execCommand("mceRepaint")},splitSafeEach:function(a,c){tinymce.isGecko&&(/Firefox\/[12]\.[0-9]/.test(navigator.userAgent)||/Firefox\/3\.[0-4]/.test(navigator.userAgent))?this.classBasedEach(a,c):b(a,c)},classBasedEach:function(a,c){var d,e,f=this.ed.dom;b(a,function(a){f.addClass(a,"_mce_act_on")}),d=f.select("._mce_act_on");while(d.length>0)e=d.shift(),f.removeClass(e,"_mce_act_on"),c(e),d=f.select("._mce_act_on")},adjustPaddingFunction:function(a){var b=this.ed,c=b.settings.indentation,d=/[a-z%]+/i.exec(c);return c=parseInt(c,10),function(e){var f,g=parseInt(b.dom.getStyle(e,"margin-left")||0,10)+parseInt(b.dom.getStyle(e,"padding-left")||0,10);a?f=g+c:f=g-c,b.dom.setStyle(e,"padding-left",""),b.dom.setStyle(e,"margin-left",f>0?f+d:"")}},selectedBlocks:function(){var a=this.ed,b=a.selection.getSelectedBlocks();return b.length==0?[a.dom.getRoot()]:b},getInfo:function(){return{longname:"Lists",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/lists",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("lists",tinymce.plugins.Lists)})();