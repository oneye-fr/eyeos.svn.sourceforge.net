function init(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;ed=tinyMCEPopup.editor,tinyMCEPopup.resizeToInnerSize(),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("bordercolor_pickcontainer").innerHTML=getColorPickerHTML("bordercolor_pick","bordercolor"),document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor"),a=ed,b=ed.dom.getParent(ed.selection.getStart(),"td,th"),c=document.forms[0],d=ed.dom.parseStyle(ed.dom.getAttrib(b,"style")),e=b.nodeName.toLowerCase(),f=ed.dom.getAttrib(b,"align"),g=ed.dom.getAttrib(b,"valign"),h=trimSize(getStyle(b,"width","width")),i=trimSize(getStyle(b,"height","height")),j=convertRGBToHex(getStyle(b,"bordercolor","borderLeftColor")),k=convertRGBToHex(getStyle(b,"bgcolor","backgroundColor")),l=ed.dom.getAttrib(b,"class"),m=getStyle(b,"background","backgroundImage").replace(RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"),n=ed.dom.getAttrib(b,"id"),o=ed.dom.getAttrib(b,"lang"),p=ed.dom.getAttrib(b,"dir"),q=ed.dom.getAttrib(b,"scope"),addClassesToList("class","table_cell_styles"),TinyMCE_EditableSelects.init(),ed.dom.hasClass(b,"mceSelected")?tinyMCEPopup.dom.hide("action"):(c.bordercolor.value=j,c.bgcolor.value=k,c.backgroundimage.value=m,c.width.value=h,c.height.value=i,c.id.value=n,c.lang.value=o,c.style.value=ed.dom.serializeStyle(d),selectByValue(c,"align",f),selectByValue(c,"valign",g),selectByValue(c,"class",l,!0,!0),selectByValue(c,"celltype",e),selectByValue(c,"dir",p),selectByValue(c,"scope",q),isVisible("backgroundimagebrowser")&&(document.getElementById("backgroundimage").style.width="180px"),updateColor("bordercolor_pick","bordercolor"),updateColor("bgcolor_pick","bgcolor"))}function updateAction(){var a,b,c,d,e,f,g,h,i,j,k,l=ed,m=document.forms[0];if(!AutoValidator.validate(m))return tinyMCEPopup.alert(AutoValidator.getErrorMessages(m).join(". ")+"."),!1;tinyMCEPopup.restoreSelection(),a=ed.selection.getStart(),b=ed.dom.getParent(a,"td,th"),c=ed.dom.getParent(a,"tr"),d=ed.dom.getParent(a,"table");if(ed.dom.hasClass(b,"mceSelected")){tinymce.each(ed.dom.select("td.mceSelected,th.mceSelected"),function(a){updateCell(a)}),ed.addVisual(),ed.nodeChanged(),l.execCommand("mceEndUndoLevel"),tinyMCEPopup.close();return}switch(getSelectValue(m,"action")){case"cell":e=getSelectValue(m,"celltype"),f=getSelectValue(m,"scope");function n(a){a&&(updateCell(b),ed.addVisual(),ed.nodeChanged(),l.execCommand("mceEndUndoLevel"),tinyMCEPopup.close())}if(ed.getParam("accessibility_warnings",1)){e=="th"&&f==""?tinyMCEPopup.confirm(ed.getLang("table_dlg.missing_scope","",!0),n):n(1);return}updateCell(b);break;case"row":g=c.firstChild,g.nodeName!="TD"&&g.nodeName!="TH"&&(g=nextCell(g));do g=updateCell(g,!0);while((g=nextCell(g))!=null);break;case"col":i=0,g=c.firstChild,j=d.getElementsByTagName("tr"),g.nodeName!="TD"&&g.nodeName!="TH"&&(g=nextCell(g));do{if(g==b)break;i+=g.getAttribute("colspan")}while((g=nextCell(g))!=null);for(k=0;k<j.length;k++){g=j[k].firstChild,g.nodeName!="TD"&&g.nodeName!="TH"&&(g=nextCell(g)),h=0;do{if(h==i){g=updateCell(g,!0);break}h+=g.getAttribute("colspan")}while((g=nextCell(g))!=null)}break;case"all":j=d.getElementsByTagName("tr");for(k=0;k<j.length;k++){g=j[k].firstChild,g.nodeName!="TD"&&g.nodeName!="TH"&&(g=nextCell(g));do g=updateCell(g,!0);while((g=nextCell(g))!=null)}}ed.addVisual(),ed.nodeChanged(),l.execCommand("mceEndUndoLevel"),tinyMCEPopup.close()}function nextCell(a){while((a=a.nextSibling)!=null)if(a.nodeName=="TD"||a.nodeName=="TH")return a;return null}function updateCell(a,b){var c,d,e,f=ed,g=document.forms[0],h=a.nodeName.toLowerCase(),i=getSelectValue(g,"celltype"),j=f.getDoc(),k=ed.dom;b||k.setAttrib(a,"id",g.id.value),k.setAttrib(a,"align",g.align.value),k.setAttrib(a,"vAlign",g.valign.value),k.setAttrib(a,"lang",g.lang.value),k.setAttrib(a,"dir",getSelectValue(g,"dir")),k.setAttrib(a,"style",ed.dom.serializeStyle(ed.dom.parseStyle(g.style.value))),k.setAttrib(a,"scope",g.scope.value),k.setAttrib(a,"class",getSelectValue(g,"class")),ed.dom.setAttrib(a,"width",""),ed.dom.setAttrib(a,"height",""),ed.dom.setAttrib(a,"bgColor",""),ed.dom.setAttrib(a,"borderColor",""),ed.dom.setAttrib(a,"background",""),a.style.width=getCSSSize(g.width.value),a.style.height=getCSSSize(g.height.value),g.bordercolor.value!=""?(a.style.borderColor=g.bordercolor.value,a.style.borderStyle=a.style.borderStyle==""?"solid":a.style.borderStyle,a.style.borderWidth=a.style.borderWidth==""?"1px":a.style.borderWidth):a.style.borderColor="",a.style.backgroundColor=g.bgcolor.value,g.backgroundimage.value!=""?a.style.backgroundImage="url('"+g.backgroundimage.value+"')":a.style.backgroundImage="";if(h!=i){c=j.createElement(i);for(d=0;d<a.childNodes.length;d++)c.appendChild(a.childNodes[d].cloneNode(1));for(e=0;e<a.attributes.length;e++)ed.dom.setAttrib(c,a.attributes[e].name,ed.dom.getAttrib(a,a.attributes[e].name));a.parentNode.replaceChild(c,a),a=c}return k.setAttrib(a,"style",k.serializeStyle(k.parseStyle(a.style.cssText))),a}function changedBackgroundImage(){var a=document.forms[0],b=ed.dom.parseStyle(a.style.value);b["background-image"]="url('"+a.backgroundimage.value+"')",a.style.value=ed.dom.serializeStyle(b)}function changedSize(){var a,b=document.forms[0],c=ed.dom.parseStyle(b.style.value),d=b.width.value;d!=""?c.width=getCSSSize(d):c.width="",a=b.height.value,a!=""?c.height=getCSSSize(a):c.height="",b.style.value=ed.dom.serializeStyle(c)}function changedColor(){var a=document.forms[0],b=ed.dom.parseStyle(a.style.value);b["background-color"]=a.bgcolor.value,b["border-color"]=a.bordercolor.value,a.style.value=ed.dom.serializeStyle(b)}function changedStyle(){var a=document.forms[0],b=ed.dom.parseStyle(a.style.value);b["background-image"]?a.backgroundimage.value=b["background-image"].replace(RegExp("url\\('?([^']*)'?\\)","gi"),"$1"):a.backgroundimage.value="",b.width&&(a.width.value=trimSize(b.width)),b.height&&(a.height.value=trimSize(b.height)),b["background-color"]&&(a.bgcolor.value=b["background-color"],updateColor("bgcolor_pick","bgcolor")),b["border-color"]&&(a.bordercolor.value=b["border-color"],updateColor("bordercolor_pick","bordercolor"))}var ed;tinyMCEPopup.requireLangPack(),tinyMCEPopup.onInit.add(init);