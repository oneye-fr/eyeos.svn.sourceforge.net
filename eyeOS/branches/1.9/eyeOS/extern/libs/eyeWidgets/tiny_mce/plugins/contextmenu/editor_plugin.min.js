(function(){var a=tinymce.dom.Event,b=tinymce.each,c=tinymce.DOM;tinymce.create("tinymce.plugins.ContextMenu",{init:function(b){function g(b,c){e=0;if(c&&c.button==2){e=c.ctrlKey;return}f._menu&&(f._menu.removeAll(),f._menu.destroy(),a.remove(b.getDoc(),"click",g),f._menu=null)}var c,d,e,f=this;f.editor=b,d=b.settings.contextmenu_never_use_native,f.onContextMenu=new tinymce.util.Dispatcher(this),c=b.onContextMenu.add(function(b,c){if((e!==0?e:c.ctrlKey)&&!d)return;a.cancel(c),c.target.nodeName=="IMG"&&b.selection.select(c.target),f._getMenu(b).showMenu(c.clientX||c.pageX,c.clientY||c.pageY),a.add(b.getDoc(),"click",function(a){g(b,a)}),b.nodeChanged()}),b.onRemove.add(function(){f._menu&&f._menu.removeAll()}),b.onMouseDown.add(g),b.onKeyDown.add(g),b.onKeyDown.add(function(b,d){d.shiftKey&&!d.ctrlKey&&!d.altKey&&d.keyCode===121&&(a.cancel(d),c(b,d))})},getInfo:function(){return{longname:"Contextmenu",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/contextmenu",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_getMenu:function(a){var b,d,e=this,f=e._menu,g=a.selection,h=g.isCollapsed(),i=g.getNode()||a.getBody();f&&(f.removeAll(),f.destroy()),d=c.getPos(a.getContentAreaContainer()),f=a.controlManager.createDropMenu("contextmenu",{offset_x:d.x+a.getParam("contextmenu_offset_x",0),offset_y:d.y+a.getParam("contextmenu_offset_y",0),constrain:1,keyboard_focus:!0}),e._menu=f,f.add({title:"advanced.cut_desc",icon:"cut",cmd:"Cut"}).setDisabled(h),f.add({title:"advanced.copy_desc",icon:"copy",cmd:"Copy"}).setDisabled(h),f.add({title:"advanced.paste_desc",icon:"paste",cmd:"Paste"});if(i.nodeName=="A"&&!a.dom.getAttrib(i,"name")||!h)f.addSeparator(),f.add({title:"advanced.link_desc",icon:"link",cmd:a.plugins.advlink?"mceAdvLink":"mceLink",ui:!0}),f.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"});return f.addSeparator(),f.add({title:"advanced.image_desc",icon:"image",cmd:a.plugins.advimage?"mceAdvImage":"mceImage",ui:!0}),f.addSeparator(),b=f.addMenu({title:"contextmenu.align"}),b.add({title:"contextmenu.left",icon:"justifyleft",cmd:"JustifyLeft"}),b.add({title:"contextmenu.center",icon:"justifycenter",cmd:"JustifyCenter"}),b.add({title:"contextmenu.right",icon:"justifyright",cmd:"JustifyRight"}),b.add({title:"contextmenu.full",icon:"justifyfull",cmd:"JustifyFull"}),e.onContextMenu.dispatch(e,f,i,h),f}}),tinymce.PluginManager.add("contextmenu",tinymce.plugins.ContextMenu)})();