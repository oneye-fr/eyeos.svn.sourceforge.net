function Z(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s=-1,c=-c,t=8-b,u=Al,v=R,w=v[e];if(c<-400)return[c,d,e];v[e]=i=v[d],v[d]=0,i&&(G[t][G[t].length]=[i,e]),i-b==1&&v[e+Ds[b>>3]]>15&&(v[e]+=4),i-b==6&&(d-e==2||e-d==2)&&(j=d-4+(d<e)*7,k=d+e>>1,v[j]=0,v[k]=b+2),l=Pz(b,h,c),m=l.length;if(m)if(a){l.sort(cp),a--,o=l[0],p=o[1],q=o[2],u=-Z(a,t,o[0],p,q,-g,-f,o[3])[0];for(s=1;s<m;s++){u>f&&(f=u),n=l[s],r=-Z(a,t,n[0],n[1],n[2],-f-1,-f,n[3])[0],r>f&&r<g&&(r=-Z(a,t,n[0],n[1],n[2],-g,-r,n[3])[0]);if(r>u){u=r,p=n[1],q=n[2],r>f&&(f=r);if(u>g)break}}}else{u=Al;while(--m&&g>u)l[m][0]>u&&(u=l[m][0])}else fy(0);return j&&(v[j]=b+2,v[k]=0),v[d]=i,v[e]=w,G[t].length--,[u,p,q]}function Sf(a,b,c,d,e){var f=R[d],g=R[d]=R[c];return R[c]=0,H(),b=Z(a,b,0,BE,BE,Al,Bt,e),R[c]=g,R[d]=f,b[0]}function mv(a,b,c){var d,e,f,g,h,i,j=R[b],k=R[a],l=k&7,m=M>>3,n=0,o=0,p=0;if(M==P){H(),d=Pz(M,K,0);for(;p<d.length;p++)o=o||a==d[p][1]&&b==d[p][2];if(!o)return 0;if(Sf(0,8-M,a,b,K)>400)return 0}Sf(0,M,a,b,K)>400&&(n=1),e=a%10,f=b-a,g=Ds[m],o=b%10,h=1+(N>>1),i="abcdefgh",Df((M?"     ":(h<10?" ":"")+h+".  ")+i.charAt(e-1)+((a-e)/10-1)+(j?"x":"-")+i.charAt(o-1)+((b-o)/10-1)+(n?"+":" ")),Sf(1,8-M,a,b,K)<-400&&fy(n);if((j&7)==6)return fy(1),0;Rh[N]=[R+"",KL+"",K],K=0,l==1&&(R[b+g]>15&&(R[a]+=4-c),f==2*g&&(R[b-1]&1||R[b+1]&1)&&(K=a+g),!j&&f%10&&Sh(b,b-g));if(a==21+m*70||a==28+m*70)KL[m]&=(e<5)+1;if(b==21+m*70||b==28+m*70)KL[!m]&=(e<5)+1;return l==6&&(f*f==4&&Sh(a-4+(a<b)*7,a+f/2),KL[m]=0),Sh(a,b),H(),N++,M=8-M,1}function fy(a){Df(a?"checkmate!":"stalemate!"),J=a++}function H(){var b,c=99;s0=N<32?4-(N>>3):N>64,G[0]=[],G[8]=[],kY=[],pY=[[],[]];for(;c>20;c--)a=R[c],a&7&&(G[a&8][G[a&8].length]=[a,c]),Y[c]=bY[c]*s0,kY[c]=N>40||(10-2*bY[c])*s0,b=pY[1][119-c]=pY[0][c]=PY[c],N<7&&c>40&&(pY[0][c]=pY[1][119-c]=b+Math.random()*Y[c]|1,Y[24]=Y[94]=29)}function Pz(a,b,c){var d,e,f,g,h,i,k,l,m,n,o,p,q,r=-1,s=a>>3,t=a^8,u=Ds[s],v=[],w=pY[s],x=KL[s],y=G[a],z=y.length,A=R,B=j;for(o=0;o<z;o++){d=y[o][1],h=A[d];if(y[o][0]==h){h&=7;if(h>1){p=h==6,n=p?kY:Y,m=c-n[d],k=MV[h];if(h==3||p){for(i=0;i<8;){e=d+k[i++],g=A[e];if(!g||(g&24)==t)v[++r]=[m+B[g]+n[e],d,e]}p&&x&&(x&1&&!(A[d-1]+A[d-2]+A[d-3])&&CH(d-2,t,u,-1)&&(v[++r]=[m+11,d,d-2]),x&2&&!(A[d+1]+A[d+2])&&CH(d,t,u,1)&&(v[++r]=[m+12,d,d+2]))}else{q=k.length;for(i=0;i<q;){g=0,l=k[i++],e=d;while(!g){e+=l,g=A[e];if(!g||(g&24)==t)v[++r]=[m+B[g]+n[e],d,e]}}}}else{m=c-w[d],e=d+u,A[e]||(v[++r]=[m+w[e],d,e],!w[d]&&!A[e+u]&&(v[++r]=[m+w[e+u],d,e+u,e])),b&&(b==e+1||b==e-1)&&(v[++r]=[m+w[e],d,b]);for(f=e-1;f<e+2;f+=2)g=A[f]+a,g&7&&g&8&&(v[++r]=[m+B[g]+w[f],d,f])}}}return v}function CH(a,b,c,d){var e,f,g,h=a+3,i=c+2,j=MV[3],k=R;for(;a<h;a++){for(g=c-2;++g<i;){f=k[a+g];if(!(!f||(f&8)!=b||(f&8)!=1&&(f&7)!=6))return 0;f=0,e=a;while(!f){e+=g,f=k[e];if(f==b+2+(g!=c)*2||f==b+5)return 0}}for(z=0;z<8;)if(k[a+j[z++]]-b==3)return 0}f=0,a-=3;while(!f){a-=d,f=k[a];if(f==b+2||f==b+5)return 0}return 1}function B(a){var b,c=R[a],e="PI";if(J)return;if(q==a&&I){O(e,0),O(q,I,1),I=0;return}if(c&&M==(c&8)){I&&O(q,I,1),I=c,q=a,O(q,0,1),O(e,c),E&&dr(),d.onmousemove=dr;return}I&&mv(q,a,d.FF.h.selectedIndex,y)&&(O(e,0),d.onmousemove=null,A&&(Ic.top=Ic.left="0px"),I=0,J||(b=Z(d.FF.i.selectedIndex+1,M,0,BE,BE,Al,Bt,K),mv(b[1],b[2],0)))}function Sh(a,b){var c=R[a];R[b]=c,R[a]=0,O(a,0,1),O(b,c,1)}function Df(a){d.FF.b.value+="\n "+a}function Rf(a){var b;P=a;for(b=0;b<BE;b++)R[b]<16&&O(b,R[b],1);P!=M&&(Tt=Z(d.FF.i.selectedIndex+1,M,0,BE,BE,Al,Bt,K),mv(Tt[1],Tt[2],0))}function Gb(){var b;if(!N)return;N-=2,b=Rh[N],R=eval("["+b[0]+"]"),KL=eval("["+b[1]+"]"),Df(" --undo--"),K=b[2],M=N%2,Rf(M),H()}function dr(a){a=a||event,Ic.left=a.clientX+1+"px",Ic.top=a.clientY-4+"px"}function O(a,b,c){(A||a!="PI")&&c&&(a="i"+(P?119-a:a)),d.images[a].src="index.php?theme="+USERTHEME+"&extern=$imagesDir/"+b+".png"}var windowd=document.getElementById("$myPid_eyeChess_Window_Content");M=I=P=N=q=K=J=Btime=0,Bt=1999,Al=-Bt,Ds=[10,-10],BE=120,Rh=[],G=[],R=[],KL=[3,3],j=[0,1,5,3,3,9,63,0],MV=[0,0,[1,10],[21,19,12,8],[11,9],[1,10,11,9],[1,10,11,9],0];for(z=0;z<8;){j[z+8]=j[z]<<=4,m=MV[z++];if(m){s=m.length;for(x=0;x<s;)m[s+x]=-m[x++]}}x="g00000000g",y="gggggggggg",b=y+y+"g23456432gg11111111g"+x+x+x+x+"g99999999ggABCDECBAg"+y+y,w=x+x+x+"000111100000123321000123553210",a="000012346900",Y=[],PY=[],bY=[];for(y=0;y<12;y++)for(x=0;x<10;x++)z=y*10+x,PY[z]=parseInt(a.charAt(y)),bY[z]=parseInt(w.charAt(z<60?z:119-z),35)&7,R[z]=parseInt(b.charAt(z),35);R[BE]=0,d=document,A=E=d.all,E||(event=0),DM=d.getElementsByTagName||null;if(DM||E)windowd.innerHTML+='<img src="index.php?theme='+USERTHEME+'&extern=$imagesDir/0.png" id="PI" name="PI" width="47" height="48" />',A=E||d.getElementsByTagName("img"),Ic=A.PI.style;cp=function(a,b){return b[0]-a[0]},h='<table cellpadding="4" class="eyeChess_t">';for(y=90;y>10;y-=10){h+="<tr>";for(x=0;x<10;x++)z=y+x,x&&x<9&&(h+='<td class="'+(x+y/10&1?"eyeChess_b":"eyeChess_w")+'"><span onclick="B(P?119-'+z+":"+z+');" style="cursor: pointer;"><img src="index.php?theme='+USERTHEME+'&extern=$imagesDir/0.png" width="0" height="48" border="0"><img src="index.php?theme='+USERTHEME+'&extern=$imagesDir/0.png" width="47" height="48" name="i'+z+'" border="0" /><img src="index.php?theme='+USERTHEME+'&extern=$imagesDir/0.png" width="0" height="48" border="0" /></span></td>\n');h+="</tr>\n"}h+="</table>",windowd.innerHTML+=h,Rf(0),windowd.innerHTML+='<form name="FF"><div style="text-align: center;"><table class="eyeChess_Table" border="0"><tr><td></td><td><textarea name="b" style="margin-top:5px;margin-left:5px;height:457px;" cols="12" rows="24" class="eyeTextarea">$lang:Movements:</textarea></td></tr></table><input type="button" class="eyeButtonClass" value="$lang:Undo" class="eyeButton" style="margin-top: 6px; position:absolute; top:475px; left:400px;" onclick="Gb();" /><div class="eyeChess_Text" style="margin-top: 15px;">$lang:Next pawn becomes: <select name="h" class="eyeSelect"><option selected="selected">$lang:Queen</option><option>$lang:Bishop</option><option>$lang:Knight</option><option>$lang:Rook</option></select> &nbsp; $lang:Computer level: <select class="eyeSelect" name="i"><option>$lang:Easy</option><option selected="selected">$lang:Middling</option><option>$lang:Slow</option></select></div></div></form>',H();