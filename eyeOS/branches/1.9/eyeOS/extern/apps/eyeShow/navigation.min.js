var SlimeyNavigation=function(a){this.slimey=a,this.slimey.editor.addEventListener("actionPerformed",this.saveCurrentSlide,this),this.container=document.createElement("div"),this.container.className="slimeyNavigation",this.container.style.position="absolute",this.container.style.left="0px",this.container.style.top="59px",this.container.style.width="195px",this.container.style.cssFloat="left",this.slides=[],this.doms=[],this.divSlides=[],this.divSpacers=[];var b=unescapeSLIM(this.slimey.slimContent),c=b.split('<div class="slide">');this.slides[0]="";for(var d=1;d<c.length;d++)this.slides[d]=c[d].substr(0,c[d].lastIndexOf("</div>"));var e=this.createSpacerDiv(1);this.container.appendChild(e);for(d=1;d<this.slides.length;d++){var f=this.createSlideDiv(d);this.container.appendChild(f);var e=this.createSpacerDiv(d+1);this.container.appendChild(e)}this.currentSlide=0,this.slides.length>1&&this.getSlide(1)};SlimeyNavigation.prototype.getContainer=function(){return this.container},SlimeyNavigation.prototype.getSlide=function(a){var b;if(a==this.currentSlide)return;return this.currentSlide!=0&&(b=this.slimey.editor.getHTML(),this.divSlides[this.currentSlide].className="slidePreview",this.divSlides[this.currentSlide].parentNode.className="slideBorder",this.slides[this.currentSlide]=b,this.doms[this.currentSlide]=document.createElement("div"),this.slimey.editor.getDOM(this.doms[this.currentSlide]),this.divSlides[this.currentSlide].innerHTML=b),this.doms[a]?this.slimey.editor.setDOM(this.doms[a]):this.slimey.editor.setHTML(this.slides[a]),this.currentSlide=a,this.divSlides[this.currentSlide].className="slidePreviewSel",this.divSlides[this.currentSlide].parentNode.className="slideBorderSel",!1},SlimeyNavigation.prototype.saveCurrentSlide=function(){var a,b=this.slimey.editor.getHTML();this.slides[this.currentSlide]=b,a=this.divSlides[this.currentSlide],a&&(a.innerHTML=b)},SlimeyNavigation.prototype.insertNewSlide=function(a,b,c){var d,e,f,g;b||(b='<div style="font-size: 200%; font-weight: bold; font-family: sans-serif; position: absolute; left: 33%; top: 0%;">'+lang("some text")+"</div>"),d=this.divSpacers[a];for(i=this.divSlides.length-1;i>=a;i--)this.divSlides[i+1]=this.divSlides[i],this.divSlides[i+1].title=lang("Slide")+" "+(i+1),this.divSlides[i+1].slideNumber=i+1;for(i=this.divSpacers.length-1;i>=a;i--)this.divSpacers[i+1]=this.divSpacers[i],this.divSpacers[i+1].spacerNumber=i+1;for(i=this.slides.length-1;i>=a;i--)this.slides[i+1]=this.slides[i],this.doms[i+1]=this.doms[i];this.slides[a]=b,this.doms[a]=c,e=d.parentNode,f=this.createSpacerDiv(a),e.insertBefore(f,d),g=this.createSlideDiv(a),e.insertBefore(g,d),this.currentSlide>=a&&this.currentSlide++,this.getSlide(a)},SlimeyNavigation.prototype.deleteSlide=function(a){var b,c,d;if(a<1||a>this.slides.length){alert("No slide to delete!");return}b=this.divSpacers[a],c=this.divSlides[a],c.parentNode.parentNode.removeChild(c.parentNode),d=this.divSpacers[a],d.parentNode.removeChild(d);for(i=a;i<this.divSlides.length-1;i++)this.divSlides[i]=this.divSlides[i+1],this.divSlides[i].slideNumber=i,this.divSlides[i].title="Slide"+i;this.divSlides.length--;for(i=a;i<this.divSpacers.length-1;i++)this.divSpacers[i]=this.divSpacers[i+1],this.divSpacers[i].spacerNumber=i;this.divSpacers.length--;for(i=a;i<this.slides.length-1;i++)this.slides[i]=this.slides[i+1],this.doms[i]=this.doms[i+1];this.slides.length--,this.doms.length--,this.currentSlide=0,a<this.slides.length&&a>0?this.getSlide(a):this.slides.length>1?this.getSlide(this.slides.length-1):this.slimey.editor.setHTML('<h1 align="center" style="color: #999999"><i>Click "Add New" to add a slide.</i><h1>')},SlimeyNavigation.prototype.moveSlide=function(a,b){var c,d,e,f,g,h,j;if(a<1||a>this.slides.length||a==b){alert("No slide to move!");return}c=b>a?1:-1,d=this.divSlides[a],e=d.parentNode.parentNode,e.removeChild(d.parentNode),f=this.divSpacers[a],e.removeChild(f),a<b?e.insertBefore(f,this.divSlides[b].parentNode.nextSibling):e.insertBefore(f,this.divSlides[b].parentNode.previousSibling),e.insertBefore(d.parentNode,f.nextSibling),g=this.divSlides[a];for(i=a;i!=b;i+=c)this.divSlides[i]=this.divSlides[i+c],this.divSlides[i].slideNumber=i,this.divSlides[i].title=lang("Slide")+" "+i;this.divSlides[b]=g,g.slideNumber=b,g.title=lang("Slide")+" "+b,g=this.divSpacers[a];for(i=a;i!=b;i+=c)this.divSpacers[i]=this.divSpacers[i+c],this.divSpacers[i].spacerNumber=i;this.divSpacers[b]=g,g.spacerNumber=b,h=this.slides[a],j=this.doms[a];for(i=a;i!=b;i+=c)this.slides[i]=this.slides[i+c],this.doms[i]=this.doms[i+c];this.slides[b]=h,this.doms[b]=j,this.currentSlide=b},SlimeyNavigation.prototype.getSLIMContent=function(){var a,b=this.slimey.editor.getHTML();this.slides[this.currentSlide]=b,a="";for(i=1;i<this.slides.length;i++)a+='<div class="slide">'+this.slides[i]+"</div>";return a},SlimeyNavigation.prototype.createSlideDiv=function(a){var b,c=document.createElement("div");return c.slideNumber=a,c.slimey=this.slimey,c.className="slidePreview",c.title=lang("Slide")+" "+a,c.style.position="relative",c.innerHTML=this.slides[a],setEventHandler(c,"click",function(){var a=this.slideNumber,b=new SlimeyChangeSlideAction(this.slimey,a);this.slimey.editor.performAction(b)}),setEventHandler(c,"mouseover",function(){this.className="slidePreviewH",this.parentNode.className="slideBorderH"}),setEventHandler(c,"mouseout",function(){var a=this.slideNumber,b=a==this.slimey.navigation.currentSlide?"Sel":"";this.className="slidePreview"+b,this.parentNode.className="slideBorder"+b}),b=document.createElement("div"),b.className="slideBorder",b.appendChild(c),this.divSlides[a]=c,b},SlimeyNavigation.prototype.createSpacerDiv=function(a){var b=document.createElement("div");return b.spacerNumber=a,b.slimey=this.slimey,b.className="previewSpacer",b.title=lang("Click to insert a new slide"),setEventHandler(b,"click",function(){var a=new SlimeyInsertSlideAction(this.slimey,this.spacerNumber);this.slimey.editor.performAction(a),this.className="previewSpacer"}),setEventHandler(b,"mouseover",function(){this.className="previewSpacerH"}),setEventHandler(b,"mouseout",function(){this.className="previewSpacer"}),this.divSpacers[a]=b,b},SlimeyNavigation.prototype.addNewSlide=function(){var a=new SlimeyInsertSlideAction(this.slimey,this.currentSlide+1);this.slimey.editor.performAction(a)},SlimeyNavigation.prototype.deleteCurrentSlide=function(){var a;this.currentSlide>0&&(a=new SlimeyDeleteSlideAction(this.slimey,this.currentSlide),this.slimey.editor.performAction(a))},SlimeyNavigation.prototype.moveSlideDown=function(){var a;this.currentSlide<this.slides.length-1&&(a=new SlimeyMoveSlideAction(this.slimey,this.currentSlide,this.currentSlide+1),this.slimey.editor.performAction(a))},SlimeyNavigation.prototype.moveSlideUp=function(){var a;this.currentSlide>1&&(a=new SlimeyMoveSlideAction(this.slimey,this.currentSlide,this.currentSlide-1),this.slimey.editor.performAction(a))};