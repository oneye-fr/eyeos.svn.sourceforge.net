"use strict";function updateViewarea(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n=PDFView.getVisiblePages();for(a=0;a<n.length;a++)b=n[a],renderingQueue.enqueueDraw(PDFView.pages[b.id-1]);if(!n.length)return;updateViewarea.inProgress=!0,c=PDFView.page,d=n[0],PDFView.page=d.id,updateViewarea.inProgress=!1,e=PDFView.currentScale,f=PDFView.currentScaleValue,g=f==e?e*100:f,h=52,i=d.id,j="#page="+i,j+="&zoom="+g,k=PDFView.pages[i-1],l=k.getPagePoint(window.pageXOffset,window.pageYOffset-d.y-h),j+=","+Math.round(l.x)+","+Math.round(l.y),m=PDFView.store,m.set("exists",!0),m.set("page",i),m.set("zoom",g),m.set("scrollLeft",Math.round(l.x)),m.set("scrollTop",Math.round(l.y))}function updateThumbViewArea(){var a=50;thumbnailTimer&&clearTimeout(thumbnailTimer),thumbnailTimer=setTimeout(function(){var a,b,c=PDFView.getVisibleThumbs();for(a=0;a<c.length;a++)b=c[a],renderingQueue.enqueueDraw(PDFView.thumbnails[b.id-1])},a)}function selectScaleOption(a){var b,c,d=document.getElementById("scaleSelect").options,e=!1;for(b=0;b<d.length;b++){c=d[b];if(c.value!=a){c.selected=!1;continue}c.selected=!0,e=!0}return e}var thumbnailTimer,kDefaultScale="auto",kDefaultScaleDelta=1.1,kCacheSize=20,kCssUnits=96/72,kScrollbarPadding=40,kMinScale=.25,kMaxScale=4,kImageDirectory="index.php?extern=apps/eyePdf/pdf.js/images/",kSettingsMemory=20,Cache=function(b){var c=[];this.push=function(d){var e=c.indexOf(d);e>=0&&c.splice(e),c.push(d),c.length>b&&c.shift().update()}},RenderingQueue=function(){function b(){this.items=[]}return b.prototype={enqueueDraw:function(b){if("rendering"in b)return;b.rendering=!0,this.items.push(b);if(this.items.length>1)return;b.draw(this.continueExecution.bind(this))},continueExecution:function(){var b=this.items.shift();delete b.rendering;if(this.items.length==0)return;b=this.items[0],b.draw(this.continueExecution.bind(this))}},b}(),Settings=function(){function g(a){var f=null,g;if(e)return!1;if(d)f=Application.prefs.getValue(c+".database","{}");else{if(!b)return!1;f=localStorage.getItem("database")||"{}"}f=JSON.parse(f),"files"in f||(f.files=[]),f.files.length>=kSettingsMemory&&f.files.shift();for(var h=0,i=f.files.length;h<i;h++){var j=f.files[h];if(j.fingerprint==a){g=h;break}}typeof g!="number"&&(g=f.files.push({fingerprint:a})-1),this.file=f.files[g],this.database=f,d?Application.prefs.setValue(c+".database",JSON.stringify(f)):b&&localStorage.setItem("database",JSON.stringify(f))}var b=function(){try{localStorage}catch(b){return!1}return!0}(),c="extensions.uriloader@pdf.js",d=location.protocol=="chrome:"&&!b,e=!1;if(d){var f=Components.classes["@mozilla.org/privatebrowsing;1"].getService(Components.interfaces.nsIPrivateBrowsingService);e=f.privateBrowsingEnabled}return g.prototype={set:function(f,g){if(e)return!1;var h=this.file;h[f]=g,d?Application.prefs.setValue(c+".database",JSON.stringify(this.database)):b&&localStorage.setItem("database",JSON.stringify(this.database))},get:function(b,c){return e?c:this.file[b]||c}},g}(),cache=new Cache(kCacheSize),renderingQueue=new RenderingQueue,currentPageNumber=1,PDFView={pages:[],thumbnails:[],currentScale:0,currentScaleValue:null,initialBookmark:document.location.hash.substring(1),setScale:function(b,c){if(b==this.currentScale)return;var d=this.pages;for(var e=0;e<d.length;e++)d[e].update(b*kCssUnits);this.currentScale!=b&&this.pages[this.page-1].scrollIntoView(),this.currentScale=b;var f=document.createEvent("UIEvents");f.initUIEvent("scalechange",!1,!1,window,0),f.scale=b,f.resetAutoSettings=c,window.dispatchEvent(f)},parseScale:function(b,c){if("custom"==b)return;var d=parseFloat(b);this.currentScaleValue=b;if(d){this.setScale(d,!0);return}var e=this.pages[this.page-1],f=(window.innerWidth-kScrollbarPadding)/e.width/kCssUnits,g=(window.innerHeight-kScrollbarPadding)/e.height/kCssUnits;"page-width"==b&&this.setScale(f,c),"page-height"==b&&this.setScale(g,c),"page-fit"==b&&this.setScale(Math.min(f,g),c),"auto"==b&&this.setScale(Math.min(1,f),c),selectScaleOption(b)},zoomIn:function(){var b=Math.min(kMaxScale,this.currentScale*kDefaultScaleDelta);this.setScale(b,!0)},zoomOut:function(){var b=Math.max(kMinScale,this.currentScale/kDefaultScaleDelta);this.setScale(b,!0)},set page(a){var b=this.pages,c=document.getElementById("pageNumber");if(0>=a||a>b.length){var d=document.createEvent("UIEvents");d.initUIEvent("pagechange",!1,!1,window,0),d.pageNumber=this.page,window.dispatchEvent(d);return}currentPageNumber=a;var d=document.createEvent("UIEvents");d.initUIEvent("pagechange",!1,!1,window,0),d.pageNumber=a,window.dispatchEvent(d);if(updateViewarea.inProgress)return;if(this.loading&&a==1)return;b[a-1].scrollIntoView()},get page(){return currentPageNumber},open:function(b,c){document.title=this.url=b;var d=this;PDFJS.getPdf({url:b,progress:function(b){b.lengthComputable&&d.progress(b.loaded/b.total)},error:function(b){var c=document.getElementById("loading");c.innerHTML="Error";var e={message:"Unexpected server response of "+b.target.status+"."};d.error("An error occurred while loading the PDF.",e)}},function(b){d.loading=!0,d.load(b,c),d.loading=!1})},download:function(){window.open(this.url+"#pdfjs.action=download","_blank")},navigateTo:function(b){typeof b=="string"&&(b=this.destinations[b]);if(!(b instanceof Array))return;var c=b[0],d=c instanceof Object?this.pagesRefMap[c.num+" "+c.gen+" R"]:c+1;if(d){this.page=d;var e=this.pages[d-1];e.scrollIntoView(b)}},getDestinationHash:function(b){if(typeof b=="string")return"#"+escape(b);if(b instanceof Array){var c=b[0],d=c instanceof Object?this.pagesRefMap[c.num+" "+c.gen+" R"]:c+1;if(d){var e="#page="+d,f=b[1];if("name"in f&&f.name=="XYZ"){var g=b[4]||this.currentScale;e+="&zoom="+g*100;if(b[2]||b[3])e+=","+(b[2]||0)+","+(b[3]||0)}return e}}return""},error:function(b,c){var d=document.getElementById("errorWrapper");d.removeAttribute("hidden");var e=document.getElementById("errorMessage");e.innerHTML=b;var f=document.getElementById("errorClose");f.onclick=function(){d.setAttribute("hidden","true")};var g=document.getElementById("errorMoreInfo"),h=document.getElementById("errorShowMore"),i=document.getElementById("errorShowLess");h.onclick=function(){g.removeAttribute("hidden"),h.setAttribute("hidden","true"),i.removeAttribute("hidden")},i.onclick=function(){g.setAttribute("hidden","true"),h.removeAttribute("hidden"),i.setAttribute("hidden","true")},h.removeAttribute("hidden"),i.setAttribute("hidden","true"),g.innerHTML="PDF.JS Build: "+PDFJS.build+"\n",c&&(g.innerHTML+="Message: "+c.message,c.stack&&(g.innerHTML+="\nStack: "+c.stack))},progress:function(b){var c=Math.round(b*100),d=document.getElementById("loading");d.innerHTML="Loading... "+c+"%"},load:function(b,c){function d(a,b){a.onAfterDraw=function(){b.setImage(a.canvas)}}var e=document.getElementById("errorWrapper");e.setAttribute("hidden","true");var f=document.getElementById("loading");f.setAttribute("hidden","true");var g=document.getElementById("sidebarView");g.parentNode.scrollTop=0;while(g.hasChildNodes())g.removeChild(g.lastChild);"_loadingInterval"in g&&clearInterval(g._loadingInterval);var h=document.getElementById("viewer");while(h.hasChildNodes())h.removeChild(h.lastChild);var i;try{i=new PDFJS.PDFDoc(b)}catch(j){this.error("An error occurred while reading the PDF.",j)}var k=i.numPages,l=i.fingerprint,m=null;document.getElementById("numPages").innerHTML=k,document.getElementById("pageNumber").max=k,PDFView.documentFingerprint=l;var n=PDFView.store=new Settings(l);if(n.get("exists",!1)){var o=n.get("page","1"),p=n.get("zoom",PDFView.currentScale),q=n.get("scrollLeft","0"),r=n.get("scrollTop","0");m="page="+o+"&zoom="+p+","+q+","+r}var s=this.pages=[],t={},u=this.thumbnails=[];for(var v=1;v<=k;v++){var o=i.getPage(v),w=new PageView(h,o,v,o.width,o.height,o.stats,this.navigateTo.bind(this)),x=new ThumbnailView(g,o,v,o.width/o.height);d(w,x),s.push(w),u.push(x);var y=o.ref;t[y.num+" "+y.gen+" R"]=v}this.pagesRefMap=t,this.destinations=i.catalog.destinations;if(i.catalog.documentOutline){this.outline=new DocumentOutlineView(i.catalog.documentOutline);var z=document.getElementById("outlineSwitch");z.removeAttribute("disabled"),this.switchSidebarView("outline")}this.initialBookmark?(this.setHash(this.initialBookmark),this.initialBookmark=null):m?this.setHash(m):(this.setScale(c||kDefaultScale,!0),this.page=1)},setHash:function(b){if(!b)return;if(b.indexOf("=")<0)/^\d+$/.test(b)?this.page=b:PDFView.navigateTo(unescape(b));else{var c=b.split("&"),d={};for(var e=0;e<c.length;++e){var f=c[e].split("=");d[f[0]]=f[1]}if("nameddest"in d){PDFView.navigateTo(d.nameddest);return}if("page"in d){var g=d.page|0||1;this.page=g;if("zoom"in d){var h=d.zoom.split(","),i=h[0],j=parseFloat(i);j&&(i=j/100);var k=[null,{name:"XYZ"},h[1]|0,h[2]|0,i],l=this.pages[g-1];l.scrollIntoView(k)}else this.page=d.page;return}}},switchSidebarView:function(b){var c=document.getElementById("sidebarScrollView"),d=document.getElementById("outlineScrollView"),e=document.getElementById("thumbsSwitch"),f=document.getElementById("outlineSwitch");switch(b){case"thumbs":c.removeAttribute("hidden"),d.setAttribute("hidden","true"),e.setAttribute("data-selected",!0),f.removeAttribute("data-selected"),updateThumbViewArea();break;case"outline":c.setAttribute("hidden","true"),d.removeAttribute("hidden"),e.removeAttribute("data-selected"),f.setAttribute("data-selected",!0)}},getVisiblePages:function(){var b=this.pages,c=10,d=[],e=c,f=window.pageYOffset;for(var g=1;g<=b.length;++g){var h=b[g-1],i=h.height*h.scale+c;if(e+i>f)break;e+=i}var j=window.pageYOffset+window.innerHeight;for(;g<=b.length&&e<j;++g){var k=b[g-1];d.push({id:k.id,y:e,view:k}),e+=k.height*k.scale+c}return d},getVisibleThumbs:function(){var b=this.thumbnails,c=5,d=[],e=document.getElementById("sidebarScrollView"),f=c,g=e.scrollTop;for(var h=1;h<=b.length;++h){var i=b[h-1],j=i.height*i.scaleY+c;if(f+j>g)break;f+=j}var k=g+e.clientHeight;for(;h<=b.length&&f<k;++h){var l=b[h-1];d.push({id:l.id,y:f,view:l}),f+=l.height*l.scaleY+c}return d}},PageView=function(b,c,d,e,f,g,h){function l(a,b){function c(a,b){a.href=PDFView.getDestinationHash(b),a.onclick=function(){return b&&PDFView.navigateTo(b),!1}}function d(a,c){var d=document.createElement(a);return d.style.left=Math.floor(c.x-i.x)*b+"px",d.style.top=Math.floor(c.y-i.y)*b+"px",d.style.width=Math.ceil(c.width*b)+"px",d.style.height=Math.ceil(c.height*b)+"px",d}function e(a,c){var e=document.createElement("section");e.className="annotComment";var f=d("img",c);f.src=kImageDirectory+a.toLowerCase()+".svg";var g=document.createElement("div");g.setAttribute("hidden",!0);var h=document.createElement("h1"),j=document.createElement("p"),k=Math.floor(c.x-i.x+c.width);return g.style.left=k*b+"px",g.style.top=Math.floor(c.y-i.y)*b+"px",h.textContent=c.title,c.content?(j.innerHTML=c.content.replace("\n","<br />"),f.addEventListener("mouseover",function(){this.nextSibling.removeAttribute("hidden")},!1),f.addEventListener("mouseout",function(){this.nextSibling.setAttribute("hidden",!0)},!1)):g.setAttribute("hidden",!0),g.appendChild(h),g.appendChild(j),e.appendChild(f),e.appendChild(g),e}var f=a.getAnnotations();for(var g=0;g<f.length;g++){var h=f[g];switch(h.type){case"Link":var j=d("a",h);j.href=h.url||"",h.url||c(j,"dest"in h?h.dest:null),k.appendChild(j);break;case"Text":var l=e(h.name,h);l&&k.appendChild(l)}}}this.id=d,this.content=c;var i=this.content.view;this.x=i.x,this.y=i.y,this.width=i.width,this.height=i.height;var j=document.createElement("a");j.name=""+this.id;var k=document.createElement("div");k.id="pageContainer"+this.id,k.className="page",b.appendChild(j),b.appendChild(k),this.update=function(b){this.scale=b||this.scale,k.style.width=this.width*this.scale+"px",k.style.height=this.height*this.scale+"px";while(k.hasChildNodes())k.removeChild(k.lastChild);k.removeAttribute("data-loaded"),delete this.canvas},this.getPagePoint=function(b,c){var d=PDFView.currentScale;return this.content.rotatePoint(b/d,c/d)},this.scrollIntoView=function(b){if(!b){k.scrollIntoView(!0);return}var c=0,d=0,e=0,f=0,g,h,i=0;switch(b[1].name){case"XYZ":c=b[2],d=b[3],i=b[4];break;case"Fit":case"FitB":i="page-fit";break;case"FitH":case"FitBH":d=b[2],i="page-width";break;case"FitV":case"FitBV":c=b[2],i="page-height";break;case"FitR":c=b[2],d=b[3],e=b[4]-c,f=b[5]-d,g=(window.innerWidth-kScrollbarPadding)/e/kCssUnits,h=(window.innerHeight-kScrollbarPadding)/f/kCssUnits,i=Math.min(g,h);break;default:return}var j=[this.content.rotatePoint(c,d),this.content.rotatePoint(c+e,d+f)];i&&i!==PDFView.currentScale&&PDFView.parseScale(i,!0),setTimeout(function(){var b=PDFView.currentScale,c=Math.min(j[0].x,j[1].x),d=Math.min(j[0].y,j[1].y),e=Math.abs(j[0].x-j[1].x),f=Math.abs(j[0].y-j[1].y),g=document.createElement("div");g.style.position="absolute",g.style.left=Math.floor(c*b)+"px",g.style.top=Math.floor(d*b)+"px",g.style.width=Math.ceil(e*b)+"px",g.style.height=Math.ceil(f*b)+"px",k.appendChild(g),g.scrollIntoView(!0),k.removeChild(g)},0)},this.draw=function(b){if(k.hasChildNodes()){this.updateStats(),b();return}var c=document.createElement("canvas");c.id="page"+this.id,c.mozOpaque=!0,k.appendChild(c),this.canvas=c;var d=document.createElement("div");d.className="textLayer",k.appendChild(d);var h=this.scale;c.width=e*h,c.height=f*h;var i=c.getContext("2d");i.save(),i.fillStyle="rgb(255, 255, 255)",i.fillRect(0,0,c.width,c.height),i.restore(),i.translate(-this.x*h,-this.y*h),g.begin=Date.now(),this.content.startRendering(i,function(c){c&&PDFView.error("An error occurred while rendering the page.",c),this.updateStats(),this.onAfterDraw&&this.onAfterDraw(),cache.push(this),b()}.bind(this),d),l(this.content,this.scale),k.setAttribute("data-loaded",!0)},this.updateStats=function(){var b=g.compile,c=g.fonts,d=g.render,e="Time to compile/fonts/render: "+(b-g.begin)+"/"+(c-b)+"/"+(d-c)+" ms";document.getElementById("info").innerHTML=e}},ThumbnailView=function(b,c,d,e){function n(){var a=document.createElement("canvas");a.id="thumbnail"+d,a.mozOpaque=!0,a.width=i,a.height=j,m.setAttribute("data-loaded",!0),m.appendChild(a);var b=a.getContext("2d");b.save(),b.fillStyle="rgb(255, 255, 255)",b.fillRect(0,0,a.width,a.height),b.restore();var e=c.view;return b.translate(-e.x*k,-e.y*l),m.style.width=e.width*k+"px",m.style.height=e.height*l+"px",m.style.lineHeight=e.height*l+"px",b}var f=document.createElement("a");f.href="#"+d,f.onclick=function(){return PDFView.page=d,!1};var g=c.view;this.width=g.width,this.height=g.height,this.id=d;var h=134,i=e<1?h*e:h,j=e>1?h/e:h,k=this.scaleX=i/this.width,l=this.scaleY=j/this.height,m=document.createElement("div");m.id="thumbnailContainer"+d,m.className="thumbnail",f.appendChild(m),b.appendChild(f),this.hasImage=!1,this.draw=function(b){if(this.hasImage){b();return}var d=n();c.startRendering(d,function(){b()}),this.hasImage=!0},this.setImage=function(b){if(this.hasImage)return;var c=n();c.drawImage(b,0,0,b.width,b.height,0,0,c.canvas.width,c.canvas.height),this.hasImage=!0}},DocumentOutlineView=function(b){function d(a,b){a.href=PDFView.getDestinationHash(b.dest),a.onclick=function(c){return PDFView.navigateTo(b.dest),!1}}var c=document.getElementById("outlineView"),e=[{parent:c,items:b}];while(e.length>0){var f=e.shift(),g,h=f.items.length;for(g=0;g<h;g++){var i=f.items[g],j=document.createElement("div");j.className="outlineItem";var k=document.createElement("a");d(k,i),k.textContent=i.title,j.appendChild(k);if(i.items.length>0){var l=document.createElement("div");l.className="outlineItems",j.appendChild(l),e.push({parent:l,items:i.items})}f.parent.appendChild(j)}}};window.addEventListener("load",function(){var a,b,c,d,e=document.location.search.substring(1).split("&");for(a=0;a<e.length;a++)b=e[a].split("="),e[unescape(b[0])]=unescape(b[1]);c="scale"in e?e.scale:kDefaultScale,PDFView.open(e.file||kDefaultURL,parseFloat(c)),"disableWorker"in e&&(PDFJS.disableWorker=e.disableWorker==="true"?!0:!1),d=document.getElementById("sidebarScrollView"),d.addEventListener("scroll",updateThumbViewArea,!0)},!0),window.addEventListener("unload",function(){window.scrollTo(0,0)},!0),window.addEventListener("scroll",function(){updateViewarea()},!0),window.addEventListener("transitionend",updateThumbViewArea,!0),window.addEventListener("webkitTransitionEnd",updateThumbViewArea,!0),window.addEventListener("resize",function(){(document.getElementById("pageWidthOption").selected||document.getElementById("pageFitOption").selected||document.getElementById("pageAutoOption").selected)&&PDFView.parseScale(document.getElementById("scaleSelect").value),updateViewarea()}),window.addEventListener("hashchange",function(){PDFView.setHash(document.location.hash.substring(1))}),window.addEventListener("change",function(a){var b,c,d=a.target.files;if(!d||d.length==0)return;b=new FileReader,b.onload=function(a){var b,c=a.target.result,d=new ArrayBuffer(c.length),e=new Uint8Array(d);for(b=0;b<c.length;b++)e[b]=c.charCodeAt(b);PDFView.load(e)},c=d[0],b.readAsBinaryString(c),document.title=c.name,document.getElementById("download").setAttribute("hidden","true")},!0),window.addEventListener("scalechange",function(a){var b,c=document.getElementById("customScaleOption");c.selected=!1;if(!a.resetAutoSettings&&(document.getElementById("pageWidthOption").selected||document.getElementById("pageFitOption").selected)){updateViewarea();return}b=selectScaleOption(""+a.scale),b||(c.textContent=Math.round(a.scale*1e4)/100+"%",c.selected=!0),updateViewarea()},!0),window.addEventListener("pagechange",function(a){var b=a.pageNumber;document.getElementById("pageNumber").value!=b&&(document.getElementById("pageNumber").value=b),document.getElementById("previous").disabled=b<=1,document.getElementById("next").disabled=b>=PDFView.pages.length},!0),window.addEventListener("keydown",function(a){var b,c,d;if(a.ctrlKey||a.altKey||a.shiftKey||a.metaKey)return;b=document.activeElement;if(b&&b.tagName=="INPUT")return;c=document.getElementById("controls");while(b){if(b===c)return;b=b.parentNode}d=!1;switch(a.keyCode){case 61:case 107:case 187:PDFView.zoomIn(),d=!0;break;case 109:case 189:PDFView.zoomOut(),d=!0;break;case 48:PDFView.setScale(kDefaultScale,!0),d=!0;break;case 37:case 75:case 80:PDFView.page--,d=!0;break;case 39:case 74:case 78:PDFView.page++,d=!0}d&&a.preventDefault()});